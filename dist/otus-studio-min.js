!function(){angular.module("studio",["dependencies","studio.dashboard","studio.authenticator","editor","otusjs","preview","otusjs.studio.navigationBuilder","surveyTemplates","ui.components","utils","otusjs.player.core","otusjs.player.component","otus.validation"])}(),function(){"use strict";angular.module("studio.authenticator",[])}(),function(){"use strict";function LoginController($scope,DashboardStateService,AuthenticationService){function authenticate(user){AuthenticationService.login(user)}function visitAccess(){DashboardStateService.goToHome()}var self=this;self.authenticate=authenticate,self.visitAccess=visitAccess}angular.module("studio.authenticator").controller("LoginController",LoginController),LoginController.$inject=["$scope","DashboardStateService","AuthenticationService"]}(),function(){angular.module("dependencies",["ngMaterial","ngMessages","ngAnimate","ui.router","lokijs","indexedDB","ui.utils.masks","otus.domain.client","otus.textEdition"])}(),function(){function localeConfiguration($mdDateLocaleProvider){function _pad(n,width,z){return z=z||"0",n+="",n.length>=width?n:new Array(width-n.length+1).join(z)+n}$mdDateLocaleProvider.formatDate=function(date){if(!date)return"";var day=date.getDate(),monthIndex=date.getMonth(),year=date.getFullYear();return _pad(day,2)+"/"+_pad(monthIndex+1,2)+"/"+year},$mdDateLocaleProvider.parseDate=function(dateString){if(date=new Date(dateString),"[object Date]"!==Object.prototype.toString.call(date))return date;if(newDateString=dateString.split("/"),3===newDateString.length){var day=newDateString[0],monthIndex=newDateString[1]-1,year=newDateString[2];return date=new Date(year,monthIndex,day),date}}}angular.module("studio").config(["$mdDateLocaleProvider",localeConfiguration])}(),function(){function stateConfiguration($stateProvider,$urlRouterProvider,$locationProvider){var dashboardMenu="app/dashboard/menu/dashboard-menu.html";$stateProvider.state("login",{url:"/login",views:{"system-wrap":{templateUrl:"app/authenticator/login.html",controller:"LoginController as loginController"}}}).state("home",{url:"/home",views:{"system-wrap":{templateUrl:"app/dashboard/main-dashboard-content-template.html",controller:"DashboardMenuController as dashboardMenu"},"dashboard-menu@home":{templateUrl:dashboardMenu},"system-content@home":{templateUrl:"app/dashboard/home/layout-template.html"},"section-info@home":{templateUrl:"app/dashboard/home/home-info-section.html"},"section-view@home":{templateUrl:"app/dashboard/home/home-view-section.html"},"section-commands@home":{templateUrl:"app/dashboard/home/home-commands-section.html"}}}).state("survey-templates",{url:"/survey-templates",views:{"system-wrap":{templateUrl:"app/dashboard/main-dashboard-content-template.html",controller:"DashboardMenuController as dashboardMenu"},"dashboard-menu@survey-templates":{templateUrl:dashboardMenu},"system-content@survey-templates":{templateUrl:"app/dashboard/survey-templates/layout-template.html",controller:"SurveyFormDashboardController as surveyFormDashboard"},"section-view@survey-templates":{templateUrl:"app/dashboard/survey-templates/survey-form-view-section.html",controller:"SurveyFormDashboardController as surveyFormDashboard"},"template-menu@survey-templates":{templateUrl:"app/dashboard/survey-templates/menu/md-fab.html"}}}).state("editor",{url:"/editor",params:{template:null},views:{"system-wrap":{templateUrl:"app/dashboard/main-dashboard-content-template.html",controller:"DashboardMenuController as dashboardMenu"},"dashboard-menu@editor":{templateUrl:dashboardMenu},"system-content@editor":{templateUrl:"app/editor/ui/main/main-container.html",controller:"MainContainerController as mainContainer",resolve:{contextTemplate:function($stateParams,SurveyEditorService,CrossSessionDatabaseService,$window,$q,WorkspaceService){function _startEditor(surveyTemplate){SurveyEditorService.startEditorWithSurveyTemplate(surveyTemplate),editorStatePromisse.resolve(WorkspaceService.getSurvey())}var editorStatePromisse=$q.defer(),surveyTemplate_OID=$window.sessionStorage.getItem("surveyTemplate_OID");return $stateParams.template?_startEditor($stateParams.template):surveyTemplate_OID?function(){CrossSessionDatabaseService.findSurveyTemplateByOID(surveyTemplate_OID).then(function(result){$stateParams.template=result.template,_startEditor($stateParams.template)})}():editorStatePromisse.resolve(WorkspaceService.getSurvey()),editorStatePromisse.promise}}}}}),$urlRouterProvider.otherwise("/login")}angular.module("studio").config(["$stateProvider","$urlRouterProvider","$locationProvider",stateConfiguration]).constant("APP_STATE",{HOME:"home",SURVEY_TEMPLATES:"survey-templates",EDITOR:"editor",PREVIEW:"preview",LOGIN:"login"})}(),function(){function themeConfiguration($mdThemingProvider,$mdIconProvider){$mdThemingProvider.theme("layoutTheme").primaryPalette("blue",{default:"A200","hue-1":"200","hue-2":"50","hue-3":"700"}).accentPalette("blue-grey",{default:"900","hue-1":"50"}).warnPalette("red"),$mdThemingProvider.theme("greyTheme").primaryPalette("grey"),$mdIconProvider.defaultIconSet("app/assets/img/icons/mdi.svg",24)}angular.module("studio").config(["$mdThemingProvider","$mdIconProvider",themeConfiguration])}(),function(){"use strict";angular.module("studio.dashboard",[])}(),function(){"use strict";angular.module("editor",["editor.core","editor.database","editor.ui","editor.workspace"])}(),function(){"use strict";angular.module("otusjs.studio.navigationBuilder",["otusjs.studio.navigationBuilder.routeBuilder","otusjs.studio.navigationBuilder.navigationInspector","otusjs.studio.navigationBuilder.messenger","ngMaterial"]).constant("NBEVENTS",{NAVIGATION_BUILDER_ON:"nbevents.navigation.builder.on",NAVIGATION_UPDATED:"nbevents.navigation.updated",MAP_CONTAINER_READY:"nbevents.map.container.ready",RELOAD_MAP_DATA:"nbevents.map.data.reload",ROUTE_MODE_ON:"nbevents.route.mode.on",ROUTE_MODE_OFF:"nbevents.route.mode.off",ROUTE_DELETED:"nbevents.route.deleted",ROUTE_BUILD_STARTED:"nbevents.route.started",ROUTE_BUILD_SAVED:"nbevents.route.build.saved",ROUTE_BUILD_CANCELED:"nbevents.route.build.canceled",ORIGIN_NODE_SELECTED:"nbevents.route.node.origin.selected",ORIGIN_NODE_UNSELECTED:"nbevents.route.node.origin.unselected",DESTINATION_NODE_SELECTED:"nbevents.route.node.destination.selected",DESTINATION_NODE_UNSELECTED:"nbevents.route.node.destination.unselected",SHOW_MESSENGER:"nbevents.messenger.show",HIDE_MESSENGER:"nbevents.messenger.hide",INSPECTOR_MODE_ON:"nbevents.inspector.mode.on",NAVIGATION_SELECTED:"nbevents.inspector.navigation.selected",ORPHANS_ENCOUNTERED:"nbevents.warning.orphans.encountered"}).constant("NBMESSAGES",{ROUTE_BUILDER:{SELECT_ORIGIN:{header:"Origem da Rota",content:"Escolha o item que determinará o início da rota."},SELECT_DESTINATION:{header:"Destino da Rota",content:"Escolha o item que determinará o destino da rota."}},NAVIGATION_INSPECTOR:{SELECT_NAVIGATION:{header:"Inpecionar navegação",content:"Escolha o item que você deseja inspecionar."}}}).run(["otusjs.studio.navigationBuilder.NavigationBuilderScopeService","otusjs.studio.navigationBuilder.NavigationBuilderService","$rootScope",function(NavigationBuilderScopeService,NavigationBuilderService,$rootScope){NavigationBuilderScopeService.initialize($rootScope.$new()),NavigationBuilderScopeService.onEvent(NavigationBuilderScopeService.NBEVENTS.NAVIGATION_BUILDER_ON,function(event,survey){NavigationBuilderService.setSurvey(survey),NavigationBuilderScopeService.emit(NavigationBuilderScopeService.NBEVENTS.MAP_CONTAINER_READY)}),NavigationBuilderScopeService.onEvent(NavigationBuilderScopeService.NBEVENTS.RELOAD_MAP_DATA,function(event){NavigationBuilderService.reloadMapData(),NavigationBuilderScopeService.emit(NavigationBuilderScopeService.NBEVENTS.MAP_CONTAINER_READY)})}])}(),function(){"use strict";function otusSurveyPreviewGenerator(){return{restrict:"A",controller:Controller}}function Controller($scope,$element,$compile,WorkspaceService,ActivityFacadeService,PlayerService){function _generateOtusPreview(){_newScope=$scope.$new(!0),_newScope.surveyActivity={},_newScope.surveyActivity.template=_getSurveyTemplateObject();var content=$compile(OTUS_SHEET_COMPONENT)(_newScope);$("#survey-preview").append(content)}function _getSurveyTemplateObject(){ActivityFacadeService.createActivity(WorkspaceService.getSurvey(),_user,_participant,_activityConfigurationName)}var _newScope,OTUS_SHEET_COMPONENT='<otus-player md-theme="layoutTheme" layout="column" flex="80"></otus-player>',_user=void 0,_participant=void 0,_activityConfigurationName="C0";$element.on("click",function(){var otusSheetDOMElement=$("otus-player");otusSheetDOMElement[0]&&(otusSheetDOMElement.remove(),_newScope&&_newScope.$destroy()),_generateOtusPreview(),PlayerService.setup()})}angular.module("preview").directive("otusSurveyPreviewGenerator",otusSurveyPreviewGenerator),Controller.$inject=["$scope","$element","$compile","WorkspaceService","otusjs.model.activity.ActivityFacadeService","otusjs.player.core.player.PlayerService"]}(),function(){"use strict";angular.module("preview",[])}(),function(){"use strict";function AuthenticationService(LogoutDialogService,DashboardStateService,RestResourceService,$mdToast,$window){function logout(){LogoutDialogService.showDialog().onConfirm(function(){invalidateSession(RestResourceService)})}function invalidateSession(domainRestResourceService){var authenticatorResource=domainRestResourceService.getAuthenticatorResource();domainRestResourceService.isLogged()?invalidateSessionLoggedUser(authenticatorResource):invalidateSessionVisitant()}function invalidateSessionLoggedUser(authenticatorResource){authenticatorResource.invalidate(function(response){DashboardStateService.logout(),$window.sessionStorage.clear()})}function invalidateSessionVisitant(){$window.sessionStorage.clear(),DashboardStateService.logout()}function login(user){RestResourceService.setUrl(user.domain),RestResourceService.getAuthenticatorResource().authenticate(user,function(response){RestResourceService.setSecurityToken(response.data),response.hasErrors?$mdToast.show($mdToast.simple().textContent(LOGIN_ERROR_MESSAGE)):DashboardStateService.goToHome()})}var LOGIN_ERROR_MESSAGE="Login Inválido! Verifique os dados informados.",self=this;self.logout=logout,self.login=login}angular.module("studio.authenticator").service("AuthenticationService",AuthenticationService),AuthenticationService.$inject=["LogoutDialogService","DashboardStateService","RestResourceService","$mdToast","$window"]}(),function(){"use strict";function DashboardStateService($state,$http,APP_STATE){function goToLogin(){self.currentState="Login",$state.go(APP_STATE.LOGIN)}function goToHome(){self.currentState="Home",$state.go(APP_STATE.HOME)}function goToFormTemplates(){self.currentState="SurveyTemplates",$state.go(APP_STATE.SURVEY_TEMPLATES)}function goToEditor(){self.currentState="Edição de Formulário",$state.go(APP_STATE.EDITOR)}function goToPreview(){self.currentState="Preview de Formulário",$state.go(APP_STATE.PREVIEW)}function goToEditorWithSurveyTemplate(surveyTemplate){self.currentState="Edição de Formulário",$state.go(APP_STATE.EDITOR,{template:surveyTemplate})}function logout(){goToLogin()}var self=this;self.goToLogin=goToLogin,self.goToHome=goToHome,self.goToFormTemplates=goToFormTemplates,self.goToEditor=goToEditor,self.goToPreview=goToPreview,self.logout=logout,self.goToEditorWithSurveyTemplate=goToEditorWithSurveyTemplate,function(){self.currentState="Home"}()}angular.module("studio.dashboard").service("DashboardStateService",DashboardStateService),DashboardStateService.$inject=["$state","$http","APP_STATE"]}(),function(){"use strict";function HomeController($http,$scope,$rootScope){var $HTTP_GET_URL_LOGGED_USER=window.location.origin+"/otus-domain-rest/session/rest/register/loggedUser";$scope.loggedUser={},$http.get($HTTP_GET_URL_LOGGED_USER).then(function(response){$scope.loggedUser=response.data.data}),$scope.isAdmin=function(loggedUser){return loggedUser.admin},$scope.isNotAdmin=function(loggedUser){return!loggedUser.admin},$scope.doesNotHasRepository=function(){if($rootScope.repositories)return $rootScope.repositories.length}}angular.module("studio.dashboard").controller("HomeController",HomeController),HomeController.$inject=["$http","$scope","$rootScope"]}(),function(){"use strict";function DashboardMenuController(DashboardStateService,$mdSidenav,AuthenticationService){function getSelectedSystemArea(){return DashboardStateService.currentState}function open(){$mdSidenav("left").toggle()}function close(){$mdSidenav("left").close()}function openHome(){DashboardStateService.goToHome(),close()}function openFormTemplates(){DashboardStateService.goToFormTemplates(),close()}function logout(){AuthenticationService.logout()}var self=this;self.getSelectedSystemArea=getSelectedSystemArea,self.open=open,self.close=close,self.openHome=openHome,self.openFormTemplates=openFormTemplates,self.logout=logout}angular.module("studio.dashboard").controller("DashboardMenuController",DashboardMenuController),DashboardMenuController.$inject=["DashboardStateService","$mdSidenav","AuthenticationService"]}(),function(){"use strict";function SurveyFormDashboardController(NewSurveyFormDialogService,DashboardStateService,SurveyEditorService){function startNewSurveyForm(){NewSurveyFormDialogService.showDialog().onConfirm(function(workInitializationData){SurveyEditorService.startEditor(workInitializationData),DashboardStateService.goToEditor()})}this.startNewSurveyForm=startNewSurveyForm}angular.module("studio.dashboard").controller("SurveyFormDashboardController",SurveyFormDashboardController),SurveyFormDashboardController.$inject=["NewSurveyFormDialogService","DashboardStateService","SurveyEditorService"]}(),function(){"use strict";angular.module("surveyTemplates",[])}(),function(){"use strict";function SurveyEditorService(WorkspaceService){function startEditor(initializationData){WorkspaceService.initializeWorkspace({owner:"visitor"}),WorkspaceService.startNewWork(initializationData)}function startEditorWithSurveyTemplate(surveyTemplate){WorkspaceService.initializeWorkspace({owner:"visitor"}),WorkspaceService.loadWork(surveyTemplate)}var self=this;self.startEditor=startEditor,self.startEditorWithSurveyTemplate=startEditorWithSurveyTemplate}angular.module("editor").service("SurveyEditorService",SurveyEditorService),SurveyEditorService.$inject=["WorkspaceService"]}(),function(){"use strict";angular.module("editor.core",[])}(),function(){"use strict";angular.module("editor.database",[]).config(function($indexedDBProvider){$indexedDBProvider.connection("otus-studio").upgradeDatabase(1,function(event,db,tx){db.createObjectStore("survey_template",{keyPath:"template_oid"}).createIndex("contributor_idx","contributor",{unique:!1})})})}(),function(){"use strict";angular.module("editor.ui",["angular-bind-html-compile"])}(),function(){"use strict";angular.module("editor.workspace",[])}(),function(){"use strict";function service(moduleScope,MapFactory,RouteBuilderService,NavigationInspectorService){function nodes(ids){return _navigationMap.nodes(ids)}function edges(){return _navigationMap.edges()}function setSurvey(survey){_survey=survey,_loadTemplateNavigations(survey.NavigationManager.getNavigationList())}function activateRouteCreatorMode(){deactiveMode(),_activeServiceMode=RouteBuilderService,_activeServiceMode.activate(_survey)}function activateNavigationInspectorMode(){deactiveMode(),_activeServiceMode=NavigationInspectorService,_activeServiceMode.activate(_survey)}function deactiveMode(){if(_activeServiceMode)return _activeServiceMode.deactivate()}function reloadMapData(){_loadTemplateNavigations(_survey.NavigationManager.getNavigationList())}function _loadTemplateNavigations(templateNavigations){_navigationMap=MapFactory.create(),_addNodes(templateNavigations),_addEdges(templateNavigations),moduleScope.store("map",_navigationMap)}function getCustomIDs(){return _survey.SurveyItemManager.getItemList()}function _addNodes(templateNavigations){var items=getCustomIDs();templateNavigations.forEach(function(navigation,index){var options={};options.id=navigation.origin,index>1&&index<items.length+2&&(options.label=items[index-2].customID),options.index=navigation.index,options.isOrphan=navigation.isOrphan(),options.isMyRootOrphan=navigation.hasOrphanRoot(),_navigationMap.createNode(options)})}function _addEdges(templateNavigations){templateNavigations.forEach(function(navigation){navigation.routes.forEach(function(route){var options={};options.source=route.origin,options.target=route.destination,options.isFromOrphan=navigation.isOrphan(),route.isDefault?_navigationMap.createEdgeForDefaultPath(options):_navigationMap.createEdgeForAlterantivePath(options)})})}var self=this,_survey=null,_navigationMap={},_activeServiceMode=null;self.nodes=nodes,self.edges=edges,self.setSurvey=setSurvey,self.activateRouteCreatorMode=activateRouteCreatorMode,self.activateNavigationInspectorMode=activateNavigationInspectorMode,self.deactiveMode=deactiveMode,self.reloadMapData=reloadMapData}angular.module("otusjs.studio.navigationBuilder").service("otusjs.studio.navigationBuilder.NavigationBuilderService",service),service.$inject=["otusjs.studio.navigationBuilder.NavigationBuilderScopeService","otusjs.studio.navigationBuilder.MapFactory","otusjs.studio.navigationBuilder.routeBuilder.RouteBuilderService","otusjs.studio.navigationBuilder.navigationInspector.NavigationInspectorService"]}(),function(){"use strict";function service(NBEVENTS,NBMESSAGES){function initialize(scope){scope.events=NBEVENTS,scope.messages=NBMESSAGES,_scope=scope}function store(key,value){_moduleData[key]=value}function getData(key){return _moduleData[key]}function onEvent(event,listener){return _scope.$on(event,listener)}function broadcast(event,data){_scope.$broadcast(event,data)}function emit(event,data){_scope.$emit(event,data)}function digest(){_scope.$digest()}function apply(){_scope.$apply()}var self=this,_scope=null,_moduleData={};self.NBEVENTS=NBEVENTS,self.NBMESSAGES=NBMESSAGES,self.initialize=initialize,self.store=store,self.getData=getData,self.onEvent=onEvent,self.broadcast=broadcast,self.emit=emit,self.digest=digest,self.apply=apply}angular.module("otusjs.studio.navigationBuilder").service("otusjs.studio.navigationBuilder.NavigationBuilderScopeService",service),service.$injects=["NBEVENTS","NBMESSAGES"]}(),function(){"use strict";angular.module("otusjs.studio.navigationBuilder.navigationInspector",[])}(),function(){"use strict";angular.module("otusjs.studio.navigationBuilder.messenger",[])}(),function(){"use strict";angular.module("otusjs.studio.navigationBuilder.routeBuilder",[])}(),function(){"use strict";var __slice=[].slice;angular.module("indexedDB",[]).provider("$indexedDB",function(){var IDBKeyRange,allTransactions,apiDirection,appendResultsToPromise,applyNeededUpgrades,cursorDirection,db,dbMode,dbName,dbPromise,dbVersion,defaultQueryOptions,errorMessageFor,indexedDB,readyState,upgradesByVersion;indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,IDBKeyRange=window.IDBKeyRange||window.mozIDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange,dbMode={readonly:"readonly",readwrite:"readwrite"},readyState={pending:"pending"},cursorDirection={next:"next",nextunique:"nextunique",prev:"prev",prevunique:"prevunique"},apiDirection={ascending:cursorDirection.next,descending:cursorDirection.prev},dbName="",dbVersion=1,db=null,upgradesByVersion={},dbPromise=null,allTransactions=[],defaultQueryOptions={useIndex:void 0,keyRange:null,direction:cursorDirection.next},applyNeededUpgrades=function(oldVersion,event,db,tx,$log){var version;for(version in upgradesByVersion)!upgradesByVersion.hasOwnProperty(version)||oldVersion>=version||($log.log("$indexedDB: Running upgrade : "+version+" from "+oldVersion),upgradesByVersion[version](event,db,tx))},errorMessageFor=function(e){return e.target.readyState===readyState.pending?"Error: Operation pending":e.target.webkitErrorMessage||e.target.error.message||e.target.errorCode},appendResultsToPromise=function(promise,results){return void 0!==results?promise.then(function(){return results}):promise},this.connection=function(databaseName){return dbName=databaseName,this},this.upgradeDatabase=function(newVersion,callback){return upgradesByVersion[newVersion]=callback,dbVersion=Math.max.apply(null,Object.keys(upgradesByVersion)),this},this.$get=["$q","$rootScope","$log",function($q,$rootScope,$log){var DbQ,ObjectStore,Query,Transaction,addTransaction,closeDatabase,createDatabaseConnection,keyRangeForOptions,openDatabase,openTransaction,rejectWithError,validateStoreNames;return rejectWithError=function(deferred){return function(error){return $rootScope.$apply(function(){return deferred.reject(errorMessageFor(error))})}},createDatabaseConnection=function(){var dbReq,deferred;return deferred=$q.defer(),dbReq=indexedDB.open(dbName,parseInt(dbVersion)||1),dbReq.onsuccess=function(){db=dbReq.result,$rootScope.$apply(function(){deferred.resolve(db)})},dbReq.onblocked=dbReq.onerror=rejectWithError(deferred),dbReq.onupgradeneeded=function(event){var tx;db=event.target.result,tx=event.target.transaction,$log.log("$indexedDB: Upgrading database '"+db.name+"' from version "+event.oldVersion+" to version "+event.newVersion+" ..."),applyNeededUpgrades(event.oldVersion,event,db,tx,$log)},deferred.promise},openDatabase=function(){return dbPromise||(dbPromise=createDatabaseConnection())},closeDatabase=function(){return openDatabase().then(function(){return db.close(),db=null,dbPromise=null})},validateStoreNames=function(storeNames){var found,storeName,_i,_len;for(found=!0,_i=0,_len=storeNames.length;_len>_i;_i++)storeName=storeNames[_i],found&=db.objectStoreNames.contains(storeName);return found},openTransaction=function(storeNames,mode){return null==mode&&(mode=dbMode.readonly),openDatabase().then(function(){return validateStoreNames(storeNames)?new Transaction(storeNames,mode):$q.reject("Object stores "+storeNames+" do not exist.")})},keyRangeForOptions=function(options){return options.beginKey&&options.endKey?IDBKeyRange.bound(options.beginKey,options.endKey):void 0},addTransaction=function(transaction){return allTransactions.push(transaction.promise),transaction.promise.finally(function(){var index;return index=allTransactions.indexOf(transaction.promise),index>-1?allTransactions.splice(index,1):void 0})},Transaction=function(){function Transaction(storeNames,mode){null==mode&&(mode=dbMode.readonly),this.transaction=db.transaction(storeNames,mode),this.defer=$q.defer(),this.promise=this.defer.promise,this.setupCallbacks()}return Transaction.prototype.setupCallbacks=function(){return this.transaction.oncomplete=function(_this){return function(){return $rootScope.$apply(function(){return _this.defer.resolve("Transaction Completed")})}}(this),this.transaction.onabort=function(_this){return function(error){return $rootScope.$apply(function(){return _this.defer.reject("Transaction Aborted",error)})}}(this),this.transaction.onerror=function(_this){return function(error){return $rootScope.$apply(function(){return _this.defer.reject("Transaction Error",error)})}}(this),addTransaction(this)},Transaction.prototype.objectStore=function(storeName){return this.transaction.objectStore(storeName)},Transaction.prototype.abort=function(){return this.transaction.abort()},Transaction}(),DbQ=function(){function DbQ(){this.q=$q.defer(),this.promise=this.q.promise}return DbQ.prototype.reject=function(){var args;return args=1<=arguments.length?__slice.call(arguments,0):[],$rootScope.$apply(function(_this){return function(){var _ref;return(_ref=_this.q).reject.apply(_ref,args)}}(this))},DbQ.prototype.rejectWith=function(req){return req.onerror=req.onblocked=function(_this){return function(e){return _this.reject(errorMessageFor(e))}}(this)},DbQ.prototype.resolve=function(){var args;return args=1<=arguments.length?__slice.call(arguments,0):[],$rootScope.$apply(function(_this){return function(){var _ref;return(_ref=_this.q).resolve.apply(_ref,args)}}(this))},DbQ.prototype.notify=function(){var args;return args=1<=arguments.length?__slice.call(arguments,0):[],$rootScope.$apply(function(_this){return function(){var _ref;return(_ref=_this.q).notify.apply(_ref,args)}}(this))},DbQ.prototype.dbErrorFunction=function(){return function(_this){return function(error){return $rootScope.$apply(function(){return _this.q.reject(errorMessageFor(error))})}}(this)},DbQ.prototype.resolveWith=function(req){return this.rejectWith(req),req.onsuccess=function(_this){return function(e){return _this.resolve(e.target.result)}}(this)},DbQ}(),ObjectStore=function(){function ObjectStore(storeName,transaction){this.storeName=storeName,this.store=transaction.objectStore(storeName),this.transaction=transaction}return ObjectStore.prototype.defer=function(){return new DbQ},ObjectStore.prototype._mapCursor=function(defer,mapFunc,req){var results;return null==req&&(req=this.store.openCursor()),results=[],defer.rejectWith(req),req.onsuccess=function(e){var cursor;return(cursor=e.target.result)?(results.push(mapFunc(cursor)),defer.notify(mapFunc(cursor)),cursor.continue()):defer.resolve(results)}},ObjectStore.prototype._arrayOperation=function(data,mapFunc){var defer,item,req,results,_i,_len;for(defer=this.defer(),angular.isArray(data)||(data=[data]),_i=0,_len=data.length;_len>_i;_i++)item=data[_i],req=mapFunc(item),results=[],defer.rejectWith(req),req.onsuccess=function(e){return results.push(e.target.result),defer.notify(e.target.result),results.length>=data.length?defer.resolve(results):void 0};return 0===data.length?$q.when([]):defer.promise},ObjectStore.prototype.getAllKeys=function(){var defer,req;return defer=this.defer(),this.store.getAllKeys?(req=this.store.getAllKeys(),defer.resolveWith(req)):this._mapCursor(defer,function(cursor){return cursor.key}),defer.promise},ObjectStore.prototype.clear=function(){var defer,req;return defer=this.defer(),req=this.store.clear(),defer.resolveWith(req),defer.promise},ObjectStore.prototype.delete=function(key){var defer;return defer=this.defer(),defer.resolveWith(this.store.delete(key)),defer.promise},ObjectStore.prototype.upsert=function(data){return this._arrayOperation(data,function(_this){return function(item){return _this.store.put(item)}}(this))},ObjectStore.prototype.insert=function(data){return this._arrayOperation(data,function(_this){return function(item){return _this.store.add(item)}}(this))},ObjectStore.prototype.getAll=function(){var defer;return defer=this.defer(),this.store.getAll?defer.resolveWith(this.store.getAll()):this._mapCursor(defer,function(cursor){return cursor.value}),defer.promise},ObjectStore.prototype.eachWhere=function(query){var defer,direction,indexName,keyRange,req;return defer=this.defer(),indexName=query.indexName,keyRange=query.keyRange,direction=query.direction,req=indexName?this.store.index(indexName).openCursor(keyRange,direction):this.store.openCursor(keyRange,direction),this._mapCursor(defer,function(cursor){return cursor.value},req),defer.promise},ObjectStore.prototype.findWhere=function(query){return this.eachWhere(query)},ObjectStore.prototype.each=function(options){return null==options&&(options={}),this.eachBy(void 0,options)},ObjectStore.prototype.eachBy=function(indexName,options){var q;return null==indexName&&(indexName=void 0),null==options&&(options={}),q=new Query,q.indexName=indexName,q.keyRange=keyRangeForOptions(options),q.direction=options.direction||defaultQueryOptions.direction,this.eachWhere(q)},ObjectStore.prototype.count=function(){var defer;return defer=this.defer(),defer.resolveWith(this.store.count()),defer.promise},ObjectStore.prototype.find=function(key){var defer,req;return defer=this.defer(),req=this.store.get(key),defer.rejectWith(req),req.onsuccess=function(_this){return function(e){return e.target.result?defer.resolve(e.target.result):defer.reject(_this.storeName+":"+key+" not found.")}}(this),defer.promise},ObjectStore.prototype.findBy=function(index,key){var defer;return defer=this.defer(),defer.resolveWith(this.store.index(index).get(key)),defer.promise},ObjectStore.prototype.query=function(){return new Query},ObjectStore}(),Query=function(){function Query(){this.indexName=void 0,this.keyRange=void 0,this.direction=cursorDirection.next}return Query.prototype.$lt=function(value){return this.keyRange=IDBKeyRange.upperBound(value,!0),this},Query.prototype.$gt=function(value){return this.keyRange=IDBKeyRange.lowerBound(value,!0),this},Query.prototype.$lte=function(value){return this.keyRange=IDBKeyRange.upperBound(value),this},Query.prototype.$gte=function(value){return this.keyRange=IDBKeyRange.lowerBound(value),this},Query.prototype.$eq=function(value){return this.keyRange=IDBKeyRange.only(value),this},Query.prototype.$between=function(low,hi,exLow,exHi){return null==exLow&&(exLow=!1),null==exHi&&(exHi=!1),this.keyRange=IDBKeyRange.bound(low,hi,exLow,exHi),this},Query.prototype.$desc=function(unique){return this.direction=unique?cursorDirection.prevunique:cursorDirection.prev,this},Query.prototype.$asc=function(unique){return this.direction=unique?cursorDirection.nextunique:cursorDirection.next,this},Query.prototype.$index=function(indexName){return this.indexName=indexName,this},Query}(),{openStore:function(storeName,callBack,mode){return null==mode&&(mode=dbMode.readwrite),openTransaction([storeName],mode).then(function(transaction){var results;return results=callBack(new ObjectStore(storeName,transaction)),appendResultsToPromise(transaction.promise,results)})},openStores:function(storeNames,callback,mode){return null==mode&&(mode=dbMode.readwrite),openTransaction(storeNames,mode).then(function(transaction){var objectStores,results,storeName;return objectStores=function(){var _i,_len,_results;for(_results=[],_i=0,_len=storeNames.length;_len>_i;_i++)storeName=storeNames[_i],_results.push(new ObjectStore(storeName,transaction));return _results}(),results=callback.apply(null,objectStores),appendResultsToPromise(transaction.promise,results)})},openAllStores:function(callback,mode){return null==mode&&(mode=dbMode.readwrite),openDatabase().then(function(_this){return function(){var objectStores,results,storeName,storeNames,transaction;return storeNames=Array.prototype.slice.apply(db.objectStoreNames),transaction=new Transaction(storeNames,mode),objectStores=function(){var _i,_len,_results;for(_results=[],_i=0,_len=storeNames.length;_len>_i;_i++)storeName=storeNames[_i],_results.push(new ObjectStore(storeName,transaction));return _results}(),results=callback.apply(null,objectStores),appendResultsToPromise(transaction.promise,results)}}())},closeDatabase:function(){return closeDatabase()},deleteDatabase:function(){return closeDatabase().then(function(){var defer;return defer=new DbQ,defer.resolveWith(indexedDB.deleteDatabase(dbName)),defer.promise}).finally(function(){return $log.log("$indexedDB: "+dbName+" database deleted.")})},queryDirection:apiDirection,flush:function(){return allTransactions.length>0?$q.all(allTransactions):$q.when([])},databaseInfo:function(){return openDatabase().then(function(){var storeNames;return null,storeNames=Array.prototype.slice.apply(db.objectStoreNames),openTransaction(storeNames,dbMode.readonly).then(function(transaction){var store,storeName,stores;return stores=function(){var _i,_len,_results;for(_results=[],_i=0,_len=storeNames.length;_len>_i;_i++)storeName=storeNames[_i],store=transaction.objectStore(storeName),_results.push({name:storeName,keyPath:store.keyPath,autoIncrement:store.autoIncrement,indices:Array.prototype.slice.apply(store.indexNames)});return _results}(),transaction.promise.then(function(){return{name:db.name,version:db.version,objectStores:stores}})})})}}}]})}.call(this),function(){"use strict";function controller($scope,$mdDialog,ColorContext){function bold(){return document.execCommand("bold",!1,null),!1}function italic(){return document.execCommand("italic",!1,null),!1}function underlined(){
return document.execCommand("underline",!1,null),!1}function strikeThrough(){return document.execCommand("strikeThrough",!1,null),!1}function foreColor(){var textColor=ColorContext.textColor;return document.execCommand("ForeColor",!1,textColor),!1}function hiliteColor(){var backgroundColor=ColorContext.backgroundColor;return document.execCommand("HiliteColor",!1,backgroundColor),!1}function justifyCenter(){return document.execCommand("justifyCenter",!1,null),!1}function justifyFull(){return document.execCommand("justifyFull",!1,null),!1}function justifyLeft(){return document.execCommand("justifyLeft",!1,null),!1}function justifyRight(){return document.execCommand("justifyRight",!1,null),!1}function removeFormat(){return document.execCommand("removeFormat",!1,null),!1}function openColors(){$mdDialog.show({templateUrl:"app/shared/text-edition-menu/color/color-picker-template.html",controller:"otus.textEdition.ColorController as controller",clickOutsideToClose:!0})}var self=this;self.bold=bold,self.italic=italic,self.underlined=underlined,self.strikeThrough=strikeThrough,self.openColors=openColors,self.foreColor=foreColor,self.hiliteColor=hiliteColor,self.justifyCenter=justifyCenter,self.justifyLeft=justifyLeft,self.justifyRight=justifyRight,self.justifyFull=justifyFull,self.removeFormat=removeFormat}angular.module("otus.textEdition").controller("otus.textEdition.TextEditionMenuController",controller),controller.$inject=["$scope","$mdDialog","otus.textEdition.ColorContext"]}(),function(){"use strict";function directive(){return{templateUrl:"app/shared/text-edition-menu/text-edition-menu-template.html",retrict:"E",controller:"otus.textEdition.TextEditionMenuController as controller"}}angular.module("otus.textEdition").directive("otusTextEditionMenu",directive)}(),function(){"use strict";angular.module("otus.textEdition",["mdColorPicker"])}(),function(){angular.module("ui.components",[])}(),function(){"use strict";function LogoutDialogService($mdDialog){function showDialog(){return $mdDialog.show(self.dialogSettings).then(forwardSuccessfulExecution,forwardUnsuccessfulExecution),{onConfirm:function(callback){self.callback=callback}}}function forwardSuccessfulExecution(response){"confirm"==response.action&&self.callback&&self.callback(response.data)}function forwardUnsuccessfulExecution(){}var self=this;self.showDialog=showDialog,function(){self.dialogSettings={parent:angular.element(document.body),templateUrl:"app/dashboard/dialog/logout/logout-dialog.html",controller:DialogController,controllerAs:"controller",openFrom:"#system-toolbar",closeTo:{bottom:0}}}()}function DialogController($mdDialog){function cancel(response){$mdDialog.hide(response)}function confirm(response){$mdDialog.hide(response)}var self=this;self.cancel=cancel,self.confirm=confirm}angular.module("studio.dashboard").service("LogoutDialogService",LogoutDialogService),LogoutDialogService.$inject=["$mdDialog"]}(),function(){"use strict";function otusToolbar(){return{templateUrl:"app/dashboard/menu/toolbar/menu-toolbar.html",retrict:"E"}}angular.module("studio.dashboard").directive("otusToolbar",otusToolbar)}(),function(){"use strict";function SelectedSurveyTemplatesManagementService(){function selectSurveyTemplate(template){self.selectedSurveyTemplates.push(template)}function removeSurveyTemplate(template){self.selectedSurveyTemplates.splice(_getSelectedTemplateIndex(template),1)}function hasSelectedSurveyTemplate(){return 0!==self.selectedSurveyTemplates.length}function hasOnlyOneSelectedSurveyTemplate(){return 1===self.selectedSurveyTemplates.length}function _getSelectedTemplateIndex(template){return self.selectedSurveyTemplates.indexOf(template)}var self=this;self.selectedSurveyTemplates=[],self.selectSurveyTemplate=selectSurveyTemplate,self.removeSurveyTemplate=removeSurveyTemplate,self.hasSelectedSurveyTemplate=hasSelectedSurveyTemplate,self.hasOnlyOneSelectedSurveyTemplate=hasOnlyOneSelectedSurveyTemplate}angular.module("surveyTemplates").service("SelectedSurveyTemplatesManagementService",SelectedSurveyTemplatesManagementService)}(),function(){"use strict";function SurveyTemplateManagerService(CrossSessionDatabaseService,SurveyExportService){function initializeSurveyTemplateList(){CrossSessionDatabaseService.getAllSurveyTemplatesByContributor().then(function(value){self.surveyTemplates=value})}function deleteSurveyTemplate(template){CrossSessionDatabaseService.deleteSurveyTemplate(template.template_oid),_removeOfSurveyTemplatesList(template)}function exportSurveyTemplate(template){return SurveyExportService.exportSurvey(JSON.stringify(template.template))}function editSurveyTemplate(template){}function _getTemplateIndex(template){return self.surveyTemplates.indexOf(template)}function _removeOfSurveyTemplatesList(template){self.surveyTemplates.splice(_getTemplateIndex(template),1)}var self=this;self.surveyTemplates=[],self.initializeSurveyTemplateList=initializeSurveyTemplateList,self.deleteSurveyTemplate=deleteSurveyTemplate,self.exportSurveyTemplate=exportSurveyTemplate,self.editSurveyTemplate=editSurveyTemplate}angular.module("surveyTemplates").service("SurveyTemplateManagerService",SurveyTemplateManagerService),SurveyTemplateManagerService.$inject=["CrossSessionDatabaseService","SurveyExportService"]}(),function(){"use strict";function SurveyTemplateUpload(SurveyTemplateUploadService){function linkFunction($scope,$element,$attrs){function _uploadSurveyTemplate(fileToUpload){SurveyTemplateUploadService.upload(fileToUpload)}function _createInput(){return fileUploadElement=document.createElement("input"),fileUploadElement.setAttribute("type","file"),fileUploadElement.setAttribute("accept",".json"),fileUploadElement}var fileUploadElement;$element.on("click",function(){fileUploadElement=_createInput(),fileUploadElement.click(),fileUploadElement.addEventListener("change",function(){_uploadSurveyTemplate(this.files[0])})})}return{restrict:"A",link:linkFunction}}angular.module("surveyTemplates").directive("surveyTemplateUpload",SurveyTemplateUpload),SurveyTemplateUpload.$inject=["SurveyTemplateUploadService"]}(),function(){"use strict";function SurveyTemplateUploadService(CrossSessionDatabaseService,SurveyTemplateManagerService,$mdToast){function upload(fileSurveyTemplate){var reader=new FileReader;reader.readAsText(fileSurveyTemplate),reader.onload=function(){jsonReaded=reader.result,CrossSessionDatabaseService.insertSurveyTemplate(jsonReaded,{owner:"visitor"}).then(function(value){value&&$mdToast.show($mdToast.simple().textContent("Upload realizado com sucesso!"))},function(error){$mdToast.show($mdToast.simple().textContent(_getErrorMessage(error)))}),SurveyTemplateManagerService.initializeSurveyTemplateList()}}function _getErrorMessage(error){var message;switch(error){case"Key already exists in the object store.":message="Esse template já existe.";break;default:message="Ocorreu um erro ao realizar o upload"}return message}var jsonReaded,self=this;self.upload=upload}angular.module("surveyTemplates").service("SurveyTemplateUploadService",SurveyTemplateUploadService),SurveyTemplateUploadService.$inject=["CrossSessionDatabaseService","SurveyTemplateManagerService","$mdToast"]}(),function(){"use strict";function surveyTemplatesExport(SurveyTemplateManagerService,$mdToast,$timeout,SelectedSurveyTemplatesManagementService){return{restrict:"A",link:function(scope,element){element.on("click",function(){SelectedSurveyTemplatesManagementService.selectedSurveyTemplates.forEach(function(template){var downloadElement=document.createElement("a");downloadElement.setAttribute("href",SurveyTemplateManagerService.exportSurveyTemplate(template)),downloadElement.setAttribute("download","surveyTemplate.json"),downloadElement.setAttribute("target","_blank"),downloadElement.click()}),$timeout(function(){$mdToast.show($mdToast.simple().textContent("Template(s) exportado(s) com sucesso!"))},1e3)})}}}angular.module("surveyTemplates").directive("surveyTemplatesExport",surveyTemplatesExport),surveyTemplatesExport.$inject=["SurveyTemplateManagerService","$mdToast","$timeout","SelectedSurveyTemplatesManagementService"]}(),function(){"use strict";function AddFillingRulesEventFactory(AddFillingRulesService,WorkspaceService){function create(){return new AddFillingRulesEvent(AddFillingRulesService,WorkspaceService)}var self=this;return self.create=create,self}function AddFillingRulesEvent(AddFillingRulesService,WorkspaceService){function execute(questionReference,validator){var option=AddFillingRulesService.execute(questionReference,validator);return WorkspaceService.workspace.isdb.userEdits.store(self),WorkspaceService.saveWork(),option}var self=this;self.execute=execute}angular.module("editor.core").factory("AddFillingRulesEventFactory",AddFillingRulesEventFactory),AddFillingRulesEventFactory.$inject=["AddFillingRulesService","WorkspaceService"]}(),function(){"use strict";function AddOptionItemEventFactory(AddOptionItemService,WorkspaceService){function create(){return new AddOptionItemEvent(AddOptionItemService,WorkspaceService)}var self=this;return self.create=create,self}function AddOptionItemEvent(AddOptionItemService,WorkspaceService){function execute(questionReference,optionName,optionValue){var option=AddOptionItemService.execute(questionReference,optionName,optionValue);return WorkspaceService.workspace.isdb.userEdits.store(self),WorkspaceService.saveWork(),option}var self=this;self.execute=execute}angular.module("editor.core").factory("AddOptionItemEventFactory",AddOptionItemEventFactory),AddOptionItemEventFactory.$inject=["AddOptionItemService","WorkspaceService"]}(),function(){"use strict";function AddRouteConditionEventFactory(AddRouteConditionService,WorkspaceService){function create(){return new AddRouteConditionEvent(AddRouteConditionService,WorkspaceService)}var self=this;return self.create=create,self}function AddRouteConditionEvent(AddRouteConditionService,WorkspaceService){function execute(conditionName,route){var routeCondition=AddRouteConditionService.execute(conditionName,route);return WorkspaceService.workspace.isdb.userEdits.store(self),WorkspaceService.saveWork(),routeCondition}var self=this;self.execute=execute}angular.module("editor.core").factory("AddRouteConditionEventFactory",AddRouteConditionEventFactory),AddRouteConditionEventFactory.$inject=["AddRouteConditionService","WorkspaceService"]}(),function(){"use strict";function AddRouteEventFactory(AddRouteService,WorkspaceService){function create(){return new AddRouteEvent(AddRouteService,WorkspaceService)}var self=this;return self.create=create,self}function AddRouteEvent(AddRouteService,WorkspaceService){function execute(routeData){var route=AddRouteService.execute(routeData);return WorkspaceService.workspace.isdb.userEdits.store(self),WorkspaceService.saveWork(),route}var self=this;self.execute=execute}angular.module("editor.core").factory("AddRouteEventFactory",AddRouteEventFactory),AddRouteEventFactory.$inject=["AddRouteService","WorkspaceService"]}(),function(){"use strict";function AddRuleEventFactory(AddRuleService,WorkspaceService){function create(){return new AddRuleEvent(AddRuleService,WorkspaceService)}var self=this;return self.create=create,self}function AddRuleEvent(AddRuleService,WorkspaceService){function execute(ruleData,route){var rule=AddRuleService.execute(ruleData,route);return WorkspaceService.workspace.isdb.userEdits.store(self),WorkspaceService.saveWork(),rule}var self=this;self.execute=execute}angular.module("editor.core").factory("AddRuleEventFactory",AddRuleEventFactory),AddRuleEventFactory.$inject=["AddRuleService","WorkspaceService"]}(),function(){"use strict";function AddSurveyItemEventFactory($rootScope,WorkspaceService,AddSurveyItemService,PageAnchorService){function create(){return new AddSurveyItemEvent($rootScope,WorkspaceService,AddSurveyItemService,PageAnchorService)}var self=this;return self.create=create,self}function AddSurveyItemEvent($rootScope,WorkspaceService,AddSurveyItemService,PageAnchorService){function execute(itemType){var item=AddSurveyItemService.execute(itemType,WorkspaceService.getSurvey());$rootScope.$broadcast("item.add",item),WorkspaceService.workspace.currentItem=item,WorkspaceService.workspace.isdb.userEdits.store(self),WorkspaceService.saveWork(),PageAnchorService.sheetAutoFocus()}var self=this;self.execute=execute}angular.module("editor.core").factory("AddSurveyItemEventFactory",AddSurveyItemEventFactory),AddSurveyItemEventFactory.$inject=["$rootScope","WorkspaceService","AddSurveyItemService","PageAnchorService"]}(),function(){"use strict";function RemoveFillingRulesEventFactory(RemoveFillingRulesWorkService,WorkspaceService){function create(){return new RemoveFillingRulesEvent(RemoveFillingRulesWorkService,WorkspaceService)}var self=this;return self.create=create,self}function RemoveFillingRulesEvent(RemoveFillingRulesWorkService,WorkspaceService){function execute(questionSource,fillingRuleType){RemoveFillingRulesWorkService.execute(questionSource.getItem(),fillingRuleType),WorkspaceService.workspace.isdb.userEdits.store(self),WorkspaceService.saveWork()}var self=this;self.execute=execute}angular.module("editor.core").factory("RemoveFillingRulesEventFactory",RemoveFillingRulesEventFactory),RemoveFillingRulesEventFactory.$inject=["RemoveFillingRulesWorkService","WorkspaceService"]}(),function(){"use strict";function RemoveOptionItemEventFactory(RemoveOptionItemService,WorkspaceService){function create(){return new RemoveOptionItemEvent(RemoveOptionItemService,WorkspaceService)}var self=this;return self.create=create,self}function RemoveOptionItemEvent(RemoveOptionItemService,WorkspaceService){function execute(questionReference,optionName){RemoveOptionItemService.execute(questionReference,optionName),WorkspaceService.workspace.isdb.userEdits.store(self),WorkspaceService.saveWork()}var self=this;self.execute=execute}angular.module("editor.core").factory("RemoveOptionItemEventFactory",RemoveOptionItemEventFactory),RemoveOptionItemEventFactory.$inject=["RemoveOptionItemService","WorkspaceService"]}(),function(){"use strict";function RemoveRouteEventFactory(RemoveRouteService,WorkspaceService){function create(){return new RemoveRouteEvent(RemoveRouteService,WorkspaceService)}var self=this;return self.create=create,self}function RemoveRouteEvent(RemoveRouteService,WorkspaceService){function execute(routeData){RemoveRouteService.execute(routeData),WorkspaceService.workspace.isdb.userEdits.store(self),WorkspaceService.saveWork()}var self=this;self.execute=execute}angular.module("editor.core").factory("RemoveRouteEventFactory",RemoveRouteEventFactory),RemoveRouteEventFactory.$inject=["RemoveRouteService","WorkspaceService"]}(),function(){"use strict";function RemoveRuleEventFactory(RemoveRuleService,WorkspaceService){function create(){return new RemoveRuleEvent(RemoveRuleService,WorkspaceService)}var self=this;return self.create=create,self}function RemoveRuleEvent(RemoveRuleService,WorkspaceService){function execute(rule,route){RemoveRuleService.execute(rule,route),WorkspaceService.workspace.isdb.userEdits.store(self),WorkspaceService.saveWork()}var self=this;self.execute=execute}angular.module("editor.core").factory("RemoveRuleEventFactory",RemoveRuleEventFactory),RemoveRuleEventFactory.$inject=["RemoveRuleService","WorkspaceService"]}(),function(){"use strict";function RemoveSurveyItemEventFactory($rootScope,WorkspaceService,RemoveSurveyItemService){function create(){return new RemoveSurveyItemEvent($rootScope,WorkspaceService,RemoveSurveyItemService)}var self=this;return self.create=create,self}function RemoveSurveyItemEvent($rootScope,WorkspaceService,RemoveSurveyItemService){function execute(item){RemoveSurveyItemService.execute(item,WorkspaceService.getSurvey()),$rootScope.$broadcast("item.remove."+item.templateID,item),WorkspaceService.workspace.isdb.userEdits.store(self),WorkspaceService.saveWork()}var self=this;self.execute=execute}angular.module("editor.core").factory("RemoveSurveyItemEventFactory",RemoveSurveyItemEventFactory),RemoveSurveyItemEventFactory.$inject=["$rootScope","WorkspaceService","RemoveSurveyItemService"]}(),function(){"use strict";function UpdateFillingRulesEventFactory(WorkspaceService){function create(){return new UpdateFillingRulesEvent(WorkspaceService)}var self=this;return self.create=create,self}function UpdateFillingRulesEvent(WorkspaceService){function execute(){WorkspaceService.workspace.isdb.userEdits.store(self),WorkspaceService.saveWork()}var self=this;self.execute=execute}angular.module("editor.core").factory("UpdateFillingRulesEventFactory",UpdateFillingRulesEventFactory),UpdateFillingRulesEventFactory.$inject=["WorkspaceService"]}(),function(){"use strict";function UpdateOptionItemEventFactory(WorkspaceService){function create(){return new UpdateOptionItemEvent(WorkspaceService)}var self=this;return self.create=create,self}function UpdateOptionItemEvent(WorkspaceService){function execute(){WorkspaceService.workspace.isdb.userEdits.store(self),WorkspaceService.saveWork()}var self=this;self.execute=execute}angular.module("editor.core").factory("UpdateOptionItemEventFactory",UpdateOptionItemEventFactory),UpdateOptionItemEventFactory.$inject=["WorkspaceService"]}(),function(){"use strict";function UpdateQuestionEventFactory(WorkspaceService){function create(){return new UpdateQuestionEvent(WorkspaceService)}var self=this;return self.create=create,self}function UpdateQuestionEvent(WorkspaceService){function execute(data){WorkspaceService.workspace.isdb.userEdits.store(self),WorkspaceService.saveWork()}var self=this;self.execute=execute}angular.module("editor.core").factory("UpdateQuestionEventFactory",UpdateQuestionEventFactory),UpdateQuestionEventFactory.$inject=["WorkspaceService"]}(),function(){"use strict";function UpdateRouteEventFactory(WorkspaceService){function create(){return new UpdateRouteEvent(WorkspaceService)}var self=this;return self.create=create,self}function UpdateRouteEvent(WorkspaceService){function execute(eventSource){WorkspaceService.workspace.isdb.userEdits.store(self),WorkspaceService.saveWork()}var self=this;self.execute=execute}angular.module("editor.core").factory("UpdateRouteEventFactory",UpdateRouteEventFactory),UpdateRouteEventFactory.$inject=["WorkspaceService"]}(),function(){"use strict";function UpdateRuleEventFactory(WorkspaceService){function create(){return new UpdateRuleEvent(WorkspaceService)}var self=this;return self.create=create,self}function UpdateRuleEvent(WorkspaceService){function execute(eventSource){WorkspaceService.workspace.isdb.userEdits.store(self),WorkspaceService.saveWork()}var self=this;self.execute=execute}angular.module("editor.core").factory("UpdateRuleEventFactory",UpdateRuleEventFactory),UpdateRuleEventFactory.$inject=["WorkspaceService"]}(),function(){"use strict";function CrossSessionDatabaseService($q,$indexedDB){function saveSurveyTemplateRevision(template,session){$indexedDB.openStore(STORE_NAME,function(store){var entry={};entry.template_oid=template.oid,entry.contributor=session.owner,entry.template=_removeInternalFunctions(template),store.upsert(entry).then(function(e){})})}function insertSurveyTemplate(template,session){var defer=$q.defer();return $indexedDB.openStore(STORE_NAME,function(store){var parsedTemplate=JSON.parse(template),entry={};entry.template_oid=parsedTemplate.oid,entry.contributor=session.owner,entry.template=parsedTemplate,store.insert(entry).then(function(success){defer.resolve(success)},function(error){defer.reject(error)})}),defer.promise}function getAllSurveyTemplates(){var defer=$q.defer();return $indexedDB.openStore(STORE_NAME,function(store){store.getAll().then(function(templates){defer.resolve(templates)})}),defer.promise}function getAllSurveyTemplatesByContributor(){var defer=$q.defer();return $indexedDB.openStore(STORE_NAME,function(store){var criteria=store.query();criteria=criteria.$eq("visitor"),criteria=criteria.$index(INDEX),store.eachWhere(criteria).then(function(templates){defer.resolve(templates)})}),defer.promise}function deleteSurveyTemplate(templateOID){var defer=$q.defer();return $indexedDB.openStore(STORE_NAME,function(store){store.delete(templateOID).then(function(){defer.resolve(!0)})}),defer.promise}function findSurveyTemplateByOID(oid){var defer=$q.defer();return $indexedDB.openStore(STORE_NAME,function(store){store.find(oid).then(function(template){defer.resolve(template)})}),defer.promise}function _removeInternalFunctions(template){return JSON.parse(JSON.stringify(template))}var self=this,STORE_NAME="survey_template",INDEX="contributor_idx";self.saveSurveyTemplateRevision=saveSurveyTemplateRevision,self.getAllSurveyTemplates=getAllSurveyTemplates,self.getAllSurveyTemplatesByContributor=getAllSurveyTemplatesByContributor,self.deleteSurveyTemplate=deleteSurveyTemplate,self.insertSurveyTemplate=insertSurveyTemplate,self.findSurveyTemplateByOID=findSurveyTemplateByOID}angular.module("editor.database").service("CrossSessionDatabaseService",CrossSessionDatabaseService),CrossSessionDatabaseService.$inject=["$q","$indexedDB"]}(),function(){"use strict";function InSessionDatabaseFactory(Loki){function create(){return new InSessionDatabase(Loki)}var self=this;return self.create=create,self}function InSessionDatabase(Loki){var self=this,instance=null,USER_EDITS_COLLECTION="userEdits",DATA_POOL_COLLECTION="dataPool";!function(){instance=new Loki("in-session-db.json"),self[USER_EDITS_COLLECTION]=new CollectionFacade(instance.addCollection(USER_EDITS_COLLECTION)),self[DATA_POOL_COLLECTION]=new CollectionFacade(instance.addCollection(DATA_POOL_COLLECTION))}()}function CollectionFacade(collectionReference){function store(data){self.collection.insert(data)}function storeUnique(data){var event=fetchEventBy("id",data.source.id);event?(remove(event),store(data)):self.collection.insert(data)}function fetchEventBy(attribute,value){return self.collection.chain().where(function(obj){return getModelValue(attribute,obj)===value}).simplesort("$loki","isdesc").data()}function fetchLastSelectEvent(){return self.collection.chain().where(function(event){return event.type.isSelectData()}).simplesort("$loki","isdesc").data()[0]}function fetchLastAddedData(){return self.collection.chain().simplesort("$loki","isdesc").data()[0]}function remove(data){self.collection.remove(data)}function getModelValue(modelpath,model){var pathArray=modelpath.split("."),modelValue=model;return pathArray.forEach(function(path){modelValue=modelValue[path]}),modelValue}var self=this;self.store=store,self.fetchEventBy=fetchEventBy,self.fetchLastSelectEvent=fetchLastSelectEvent,self.fetchLastAddedData=fetchLastAddedData,self.storeUnique=storeUnique,function(){Object.defineProperty(self,"collection",{value:collectionReference,writable:!1})}()}angular.module("editor.database").factory("InSessionDatabaseFactory",InSessionDatabaseFactory),InSessionDatabaseFactory.$inject=["Loki"]}(),function(){function EditorToolbarController(WorkspaceService){function saveOfflineWork(){WorkspaceService.saveWork()}function isSurveyEmpty(){return 0===WorkspaceService.getSurvey().SurveyItemManager.getItemListSize()}var self=this;self.saveOfflineWork=saveOfflineWork,self.isSurveyEmpty=isSurveyEmpty}angular.module("editor.ui").controller("EditorToolbarController",EditorToolbarController),EditorToolbarController.$inject=["WorkspaceService"]}(),function(){"use strict";function MainContainerContentService(){function init(cotroller){controllerReference=cotroller}function showQuestionDataEditor(data){}var self=this,controllerReference=null;self.showQuestionDataEditor=showQuestionDataEditor,self.init=init}angular.module("editor.ui").service("MainContainerContentService",MainContainerContentService)}(),function(){function MainContainerController($window,$mdBottomSheet,NBEVENTS,MainContainerContentService,NavigationBuilderScopeService,WorkspaceService,contextTemplate){function showQuestionsMenu(){$mdBottomSheet.show({templateUrl:"app/editor/ui/survey-item-palette/bottom-sheet.html",disableParentScroll:!1})}function startNavigationBuilder(){var $navContainer=$("#navigation-preview-container"),$tabContainer=$navContainer.parent().parent().parent();$navContainer.css("margin-top","10px"),$navContainer.css("height",$tabContainer.height()-10+"px"),$window.addEventListener("resize",function(){$navContainer.css("height",$tabContainer.height()-10+"px")}),NavigationBuilderScopeService.broadcast(NBEVENTS.NAVIGATION_BUILDER_ON,WorkspaceService.getSurvey()),NavigationBuilderScopeService.onEvent(NBEVENTS.NAVIGATION_UPDATED,WorkspaceService.saveWork)}var self=this;self.showQuestionsMenu=showQuestionsMenu,self.startNavigationBuilder=startNavigationBuilder,function(){MainContainerContentService.init(self),self.template=contextTemplate}()}angular.module("editor.ui").controller("MainContainerController",MainContainerController),MainContainerController.$inject=["$window","$mdBottomSheet","NBEVENTS","MainContainerContentService","otusjs.studio.navigationBuilder.NavigationBuilderScopeService","WorkspaceService","contextTemplate"]}(),function(){"use strict";function AnchorController($element,PageAnchorService){this.$onInit=function(){$element.attr("tabindex",-1),PageAnchorService.anchorRegistry($element)}}angular.module("editor.ui").component("otusPageAnchor",{templateUrl:"app/editor/ui/page-anchor-item/page-anchor-template.html",controller:AnchorController,bindings:{id:"<"}}),AnchorController.$inject=["$element","PageAnchorService"]}(),function(){function PageAnchorService(){function setUp(itemManager){_itemManager=itemManager}function anchorRegistry(anchorElement){_anchorList[anchorElement[0].id]=anchorElement}function sheetAutoFocus(){_itemManager.getItemListSize()>6?_focusOnBottom():_focusOnTop()}function _focusOnTop(){_anchorList["top-anchor"]&&_anchorList["top-anchor"].focus()}function _focusOnBottom(){_anchorList["bottom-anchor"]&&_anchorList["bottom-anchor"].focus()}var _itemManager,self=this,_anchorList={};self.setUp=setUp,self.sheetAutoFocus=sheetAutoFocus,self.anchorRegistry=anchorRegistry}angular.module("editor.ui").service("PageAnchorService",PageAnchorService)}(),function(){"use strict";function Controller(WorkspaceService,$window,PageAnchorService){var self=this;self.$onInit=function(){PageAnchorService.setUp(self.template.SurveyItemManager),$window.sessionStorage.setItem("surveyTemplate_OID",WorkspaceService.getSurvey().oid)},self.$onDestroy=function(){WorkspaceService.closeWork(),$window.sessionStorage.removeItem("surveyTemplate_OID")}}angular.module("editor.ui").component("studioSheet",{templateUrl:"app/editor/ui/sheet/sheet.html",controller:Controller,bindings:{template:"<"}}),Controller.$inject=["WorkspaceService","$window","PageAnchorService"]}(),function(){"use strict";angular.module("editor.ui").component("otusStage",{templateUrl:"app/editor/ui/stage/stage.html",bindings:{template:"<"}})}(),function(){"use strict";function SurveyItemMapFactory(){return{CalendarQuestion:'<calendar-question item="$ctrl.item"></calendar-question>',IntegerQuestion:'<integer-question item="$ctrl.item"></integer-question>',DecimalQuestion:'<decimal-question item="$ctrl.item"></decimal-question>',SingleSelectionQuestion:'<single-selection-question item="$ctrl.item"></single-selection-question>',CheckboxQuestion:'<checkbox-question item="$ctrl.item"></checkbox-question>',AutocompleteQuestion:'<autocomplete-question item="$ctrl.item"></autocomplete-question>',FileUploadQuestion:'<file-upload-question item="$ctrl.item"></file-upload-question>',GridTextQuestion:'<grid-text-question item="$ctrl.item"></grid-text-question>',GridIntegerQuestion:'<grid-integer-question item="$ctrl.item"></grid-integer-question>',PhoneQuestion:"<phone-question></phone-question>",EmailQuestion:"<email-question></email-question>",TimeQuestion:'<time-question item="$ctrl.item"></time-question>',TextQuestion:"<text-question></text-question>",TextItem:'<text-item item="$ctrl.item"></text-item>',ImageItem:'<image-item item="$ctrl.item"></image-item>'}}angular.module("editor.ui").factory("SurveyItemMapFactory",SurveyItemMapFactory)}(),function(){"use strict";function Controller(RemoveSurveyItemEventFactory){function onInit(){}function getItem(){return self.item}function getQuestionId(){return self.getItem().templateID}function deleteSurveyItem(){RemoveSurveyItemEventFactory.create().execute(self.item)}var self=this;self.$onInit=onInit,self.getItem=getItem,self.deleteSurveyItem=deleteSurveyItem,self.getQuestionId=getQuestionId}angular.module("editor.ui").component("otusSurveyItemEditor",{templateUrl:"app/editor/ui/survey-item-editor/survey-item-editor.html",controller:Controller,bindings:{item:"<"}}),Controller.$inject=["RemoveSurveyItemEventFactory"]}(),function(){"use strict";function directive(OtusSurveyItemPaletteWidgetFactory){return{scope:{label:"@",ariaLabel:"@",leftIcon:"@"},transclude:!0,templateUrl:"app/editor/ui/survey-item-palette/survey-item-palette.html",retrict:"E",link:function(scope){scope.widget=OtusSurveyItemPaletteWidgetFactory.create(scope.$parent.widget)}}}angular.module("editor.ui").directive("otusSurveyItemPalette",directive),directive.$inject=["OtusSurveyItemPaletteWidgetFactory"]}(),function(){"use strict";function OtusSurveyItemPaletteWidgetFactory(AddSurveyItemEventFactory){function create(parentWidget){return new OtusQuestionPaletteWidget(parentWidget,AddSurveyItemEventFactory)}var self=this;return self.create=create,self}function OtusQuestionPaletteWidget(parentWidget,AddSurveyItemEventFactory){function addFileUploadQuestion(){AddSurveyItemEventFactory.create().execute("FileUploadQuestion")}function addAutocompleteQuestion(){AddSurveyItemEventFactory.create().execute("AutocompleteQuestion")}function addCalendarQuestion(){AddSurveyItemEventFactory.create().execute("CalendarQuestion")}function addIntegerQuestion(){AddSurveyItemEventFactory.create().execute("IntegerQuestion")}function addDecimalQuestion(){AddSurveyItemEventFactory.create().execute("DecimalQuestion")}function addSingleSelectionQuestion(){AddSurveyItemEventFactory.create().execute("SingleSelectionQuestion")}function addTextQuestion(){AddSurveyItemEventFactory.create().execute("TextQuestion")}function addTimeQuestion(){AddSurveyItemEventFactory.create().execute("TimeQuestion")}function addEmailQuestion(){AddSurveyItemEventFactory.create().execute("EmailQuestion")}function addTextItem(){AddSurveyItemEventFactory.create().execute("TextItem")}function addImageItem(){AddSurveyItemEventFactory.create().execute("ImageItem")}function addPhoneQuestion(){AddSurveyItemEventFactory.create().execute("PhoneQuestion")}function addCheckboxQuestion(){AddSurveyItemEventFactory.create().execute("CheckboxQuestion")}function addGridTextQuestion(){AddSurveyItemEventFactory.create().execute("GridTextQuestion")}function addGridIntegerQuestion(){AddSurveyItemEventFactory.create().execute("GridIntegerQuestion")}var self=this;self.className=self.constructor.name,self.parent=parentWidget,self.addCalendarQuestion=addCalendarQuestion,self.addIntegerQuestion=addIntegerQuestion,self.addDecimalQuestion=addDecimalQuestion,self.addSingleSelectionQuestion=addSingleSelectionQuestion,self.addTextQuestion=addTextQuestion,self.addTimeQuestion=addTimeQuestion,self.addEmailQuestion=addEmailQuestion,self.addTextItem=addTextItem,self.addImageItem=addImageItem,self.addPhoneQuestion=addPhoneQuestion,self.addCheckboxQuestion=addCheckboxQuestion,self.addAutocompleteQuestion=addAutocompleteQuestion,self.addFileUploadQuestion=addFileUploadQuestion,self.addGridTextQuestion=addGridTextQuestion,self.addGridIntegerQuestion=addGridIntegerQuestion}angular.module("editor.ui").factory("OtusSurveyItemPaletteWidgetFactory",OtusSurveyItemPaletteWidgetFactory),OtusSurveyItemPaletteWidgetFactory.$inject=["AddSurveyItemEventFactory"]}(),function(){"use strict";function Controller(){var self=this;self.$onInit=function(){self.name=self.identity.name,self.acronym=self.identity.acronym}}angular.module("editor.ui").component("otusSurveyTemplateHeader",{
templateUrl:"app/editor/ui/survey-template-header/survey-template-header-template.html",controller:Controller,bindings:{identity:"<"}})}(),function(){"use strict";function OtusFillingRulesWidgetFactory(){function create(validator){return validatorsTemplates[validator]}var self=this;self.create=create;var validatorsTemplates={alphanumeric:"<otus:alphanumeric-validator></otus:alphanumeric-validator>",distinct:"<otus:distinct-validator></otus:distinct-validator>",futureDate:"<otus:future-date-validator></otus:future-date-validator>",in:"<otus:in-validator></otus:in-validator>",lowerLimit:"<otus:lower-limit-validator></otus:lower-limit-validator>",lowerCase:"<otus:lower-case-validator></otus:lower-case-validator>",mandatory:"<otus:mandatory-validator></otus:mandatory-validator>",maxDate:"<otus:max-date-validator></otus:max-date-validator>",maxLength:"<otus:max-length-validator></otus:max-length-validator>",maxTime:"<otus:max-time-validator></otus:max-time-validator>",minDate:"<otus:min-date-validator></otus:min-date-validator>",minLength:"<otus:min-length-validator></otus:min-length-validator>",minTime:"<otus:min-time-validator></otus:min-time-validator>",parameter:"<otus:parameter-validator></otus:parameter-validator>",pastDate:"<otus:past-date-validator></otus:past-date-validator>",precision:"<otus:precision-validator></otus:precision-validator>",rangeDate:"<otus:range-date-validator></otus:range-date-validator>",scale:"<otus:scale-validator></otus:scale-validator>",upperCase:"<otus:upper-case-validator></otus:upper-case-validator>",upperLimit:"<otus:upper-limit-validator></otus:upper-limit-validator>",minSelected:"<otus:min-selected-validator></otus:min-selected-validator>",maxSelected:"<otus:max-selected-validator></otus:max-selected-validator>",quantity:"<otus:quantity-validator></otus:quantity-validator>"};return self}angular.module("editor.ui").factory("OtusFillingRulesWidgetFactory",OtusFillingRulesWidgetFactory)}(),function(){"use strict";function SurveyLoaderService(ModelFacadeService){function newSurvey(name,acronym,version){return ModelFacadeService.getSurveyFactory().create(name,acronym)}function loadSurvey(surveyTemplate){return ModelFacadeService.getSurveyFactory().fromJsonObject(surveyTemplate)}var self=this;self.newSurvey=newSurvey,self.loadSurvey=loadSurvey}angular.module("editor.workspace").service("SurveyLoaderService",SurveyLoaderService),SurveyLoaderService.$inject=["ModelFacadeService"]}(),function(){"use strict";function WorkspaceFactory(InSessionDatabaseFactory){function create(workSession){return new Workspace(workSession,InSessionDatabaseFactory.create())}var self=this;return self.create=create,self}function Workspace(workSession,inSessionDatabase){function importProject(projectToImport){Object.defineProperty(self,"project",{value:projectToImport,writable:!1})}function attachWorkeSession(workSession){self.sessions[workSession.owner.username]=workSession}function loadProjectConfiguration(){}var self=this;self.importProject=importProject,self.attachWorkeSession=attachWorkeSession,self.loadProjectConfiguration=loadProjectConfiguration,function(){self.isdb=inSessionDatabase,self.sessions={workspaceOwner:workSession}}()}angular.module("editor.workspace").factory("WorkspaceFactory",WorkspaceFactory),WorkspaceFactory.$inject=["InSessionDatabaseFactory"]}(),function(){"use strict";function WorkspaceService(WorkspaceFactory,SurveyProjectFactory,SurveyLoaderService,CrossSessionDatabaseService,SurveyExportService){function initializeWorkspace(ownerWorkSession){self.workspace=WorkspaceFactory.create(ownerWorkSession),questionIdCounter=-1,notifyObservers({type:"NEW_PROJECT"})}function startNewWork(initializationData){var survey=SurveyLoaderService.newSurvey(initializationData.name,initializationData.acronym.toUpperCase(),initializationData.version);importProject(SurveyProjectFactory.create(survey,self.workspace.sessions.workspaceOwner))}function loadWork(surveyTemplate){var survey=SurveyLoaderService.loadSurvey(surveyTemplate);importProject(SurveyProjectFactory.create(survey,self.workspace.sessions.workspaceOwner))}function closeWork(){saveWork(),self.workspace.project.close("now"),questionIdCounter=-1,observers=[],self.workspace=void 0}function saveWork(){CrossSessionDatabaseService.saveSurveyTemplateRevision(self.workspace.project.survey,self.workspace.sessions.workspaceOwner)}function exportWork(){return SurveyExportService.exportSurvey(JSON.stringify(self.workspace.project.survey.toJSON()))}function getQuestionId(){return++questionIdCounter}function getSurvey(){return self.workspace.project.survey}function importProject(project){project.survey.SurveyItemManager.getItemListSize()&&_setLastTemplateIdValue(project),self.workspace.importProject(project),self.workspace.loadProjectConfiguration()}function _setLastTemplateIdValue(project){var projectAcronym=project.survey.identity.acronym,lastItemTemplateID=project.survey.SurveyItemManager.getLastItem().templateID,lastID=project.survey.SurveyItemManager.getLastItem().templateID.slice(projectAcronym.length,lastItemTemplateID.length);project.survey.SurveyItemManager.setIncrementalIDValue(lastID)}function notifyObservers(update){observers.forEach(function(observer){observer.update(update)})}function registerObserver(observer){observers.push(observer)}var self=this,questionIdCounter=-1,observers=[];self.initializeWorkspace=initializeWorkspace,self.startNewWork=startNewWork,self.loadWork=loadWork,self.closeWork=closeWork,self.saveWork=saveWork,self.getQuestionId=getQuestionId,self.exportWork=exportWork,self.getSurvey=getSurvey,self.registerObserver=registerObserver}angular.module("editor.workspace").service("WorkspaceService",WorkspaceService),WorkspaceService.$inject=["WorkspaceFactory","SurveyProjectFactory","SurveyLoaderService","CrossSessionDatabaseService","SurveyExportService"]}(),function(){"use strict";function surveyTemplateExport(WorkspaceService){return{restrict:"A",link:function(scope,element){element.on("click",function(){var downloadElement=document.createElement("a");downloadElement.setAttribute("href",WorkspaceService.exportWork()),downloadElement.setAttribute("download","surveyTemplate.json"),downloadElement.setAttribute("target","_blank"),downloadElement.click()})}}}angular.module("editor.workspace").directive("surveyTemplateExport",surveyTemplateExport),surveyTemplateExport.$inject=["WorkspaceService"]}(),function(){"use strict";function SurveyExportService(){function exportSurvey(JsonTemplate){return"data:text/json;charset=utf-8,"+encodeURIComponent(JsonTemplate)}this.exportSurvey=exportSurvey}angular.module("editor.workspace").service("SurveyExportService",SurveyExportService)}(),function(){"use strict";function SurveyProjectFactory(){function create(survey,author){return new SurveyProject(survey,author)}var self=this;return self.create=create,self}function SurveyProject(survey,author){function addContributor(contributor){contributors.push(contributor)}function removeContributor(contributor){var indexToRemove=contributors.indexOf(contributor);contributors=contributors.slice(indexToRemove,1)}function listContributors(){return contributors}function close(lastSaveDateTime){Object.defineProperty(self,"lastSaveDateTime",{value:lastSaveDateTime,writable:!1})}var self=this;self.configuration={};var contributors=[];Object.defineProperty(this,"survey",{value:survey,writable:!1}),Object.defineProperty(this,"creationDateTime",{value:(new Date).toISOString(),writable:!1}),Object.defineProperty(this,"author",{value:author,writable:!1}),self.addContributor=addContributor,self.removeContributor=removeContributor,self.listContributors=listContributors,self.close=close}angular.module("editor.workspace").factory("SurveyProjectFactory",SurveyProjectFactory)}(),function(){"use strict";function service(moduleScope,DataService,UiEventsService,ModuleEventService){function activate(survey){deactivate(),DataService.activate(survey),UiEventsService.activate(),ModuleEventService.activate(),moduleScope.emit(moduleScope.NBEVENTS.INSPECTOR_MODE_ON)}function deactivate(){moduleScope.emit(moduleScope.NBEVENTS.INSPECTOR_MODE_OFF),DataService.deactivate(),ModuleEventService.deactivate(),UiEventsService.deactivate()}var self=this;self.activate=activate,self.deactivate=deactivate}angular.module("otusjs.studio.navigationBuilder.navigationInspector").service("otusjs.studio.navigationBuilder.navigationInspector.NavigationInspectorService",service),service.$inject=["otusjs.studio.navigationBuilder.NavigationBuilderScopeService","otusjs.studio.navigationBuilder.navigationInspector.DataService","otusjs.studio.navigationBuilder.navigationInspector.UiEventsService","otusjs.studio.navigationBuilder.navigationInspector.ModuleEventService"]}(),function(){"use strict";function service(moduleScope){function activate(survey){_survey=survey}function deactivate(){_survey=null}function selectNode(node){_selectedNode?(moduleScope.emit(moduleScope.NBEVENTS.NAVIGATION_UNSELECTED,_selectedNode),node&&node.id!==_selectedNode.id?(_selectedNode=node,moduleScope.emit(moduleScope.NBEVENTS.NAVIGATION_SELECTED,_selectedNode)):_selectedNode=null):(_selectedNode=node,moduleScope.emit(moduleScope.NBEVENTS.NAVIGATION_SELECTED,_selectedNode))}function selectedNode(){return _selectedNode}var self=this,_survey=null,_selectedNode=null;self.activate=activate,self.deactivate=deactivate,self.selectNode=selectNode,self.selectedNode=selectedNode}angular.module("otusjs.studio.navigationBuilder.navigationInspector").service("otusjs.studio.navigationBuilder.navigationInspector.DataService",service),service.$inject=["otusjs.studio.navigationBuilder.NavigationBuilderScopeService"]}(),function(){"use strict";function service(moduleScope,GraphLayerService,InstructorService){function activate(){_registerEventListener(moduleScope.NBEVENTS.INSPECTOR_MODE_ON,_onRouteModeOn),_registerEventListener(moduleScope.NBEVENTS.INSPECTOR_MODE_OFF,_onRouteModeOff),_registerEventListener(moduleScope.NBEVENTS.NAVIGATION_SELECTED,_onNavigationSelected),_registerEventListener(moduleScope.NBEVENTS.NAVIGATION_UNSELECTED,_onNavigationUnselected)}function deactivate(){_unregisterEventListeners()}function _registerEventListener(event,listener){var eventReg=moduleScope.onEvent(event,listener);_events.push(eventReg)}function _unregisterEventListeners(){_events.forEach(function(eventReg){eventReg()})}function _onRouteModeOn(event,node){InstructorService.showMessenger(moduleScope.NBMESSAGES.NAVIGATION_INSPECTOR.SELECT_NAVIGATION)}function _onRouteModeOff(event,node){GraphLayerService.clearVisualChanges(),GraphLayerService.applyVisualChanges(),InstructorService.clearMessenger(),moduleScope.emit(moduleScope.NBEVENTS.RELOAD_MAP_DATA)}function _onNavigationSelected(event,node){GraphLayerService.lockUnrelated(node),GraphLayerService.showInputs(node),GraphLayerService.showOutputs(node),GraphLayerService.setNodeAsInspected(node),GraphLayerService.applyVisualChanges()}function _onNavigationUnselected(event,node){GraphLayerService.clearVisualChanges(),GraphLayerService.applyVisualChanges(),moduleScope.emit(moduleScope.NBEVENTS.RELOAD_MAP_DATA)}var self=this,_events=[];self.activate=activate,self.deactivate=deactivate}angular.module("otusjs.studio.navigationBuilder.navigationInspector").service("otusjs.studio.navigationBuilder.navigationInspector.ModuleEventService",service),service.$inject=["otusjs.studio.navigationBuilder.NavigationBuilderScopeService","otusjs.studio.navigationBuilder.GraphLayerService","otusjs.studio.navigationBuilder.messenger.InstructorService"]}(),function(){"use strict";function service(moduleScope,DataService,GraphLayerService){function activate(){GraphLayerService.eventService.onClickNode(_selectRouteNode)}function deactivate(){GraphLayerService.eventService.clearAllEventListeners()}function _selectRouteNode(event){DataService.selectNode(event.data.node)}var self=this;self.activate=activate,self.deactivate=deactivate}angular.module("otusjs.studio.navigationBuilder.navigationInspector").service("otusjs.studio.navigationBuilder.navigationInspector.UiEventsService",service),service.$inject=["otusjs.studio.navigationBuilder.NavigationBuilderScopeService","otusjs.studio.navigationBuilder.navigationInspector.DataService","otusjs.studio.navigationBuilder.GraphLayerService"]}(),function(){"use strict";function component(moduleScope,GraphLayerService,NavigationBuilderService){function onInit(){self.toolsCtrl=new ToolsController(NavigationBuilderService),moduleScope.onEvent(moduleScope.NBEVENTS.MAP_CONTAINER_READY,_renderMap)}function _renderMap(){var nodes=NavigationBuilderService.nodes(),edges=NavigationBuilderService.edges();GraphLayerService.initialize(),GraphLayerService.loadData(nodes,edges),GraphLayerService.render()}var self=this;self.$onInit=onInit}function ToolsController(NavigationBuilderService){function click(){self.isOpen=!self.isOpen}function addRoute(){NavigationBuilderService.activateRouteCreatorMode()}function inspect(){NavigationBuilderService.activateNavigationInspectorMode()}var self=this;!function(){self.isOpen=!1}(),self.click=click,self.addRoute=addRoute,self.inspect=inspect}angular.module("otusjs.studio.navigationBuilder").component("otusNavigationMap",{templateUrl:"app/navigation-builder/map/component/map-template.html",controller:component}),component.$inject=["otusjs.studio.navigationBuilder.NavigationBuilderScopeService","otusjs.studio.navigationBuilder.GraphLayerService","otusjs.studio.navigationBuilder.NavigationBuilderService"]}(),function(){"use strict";function service(){function setMapView(mapView){_mapView=mapView,_initializeEventListeners()}function clearAllEventListeners(){_clickNodeListeners=[],_overNodeListeners=[],_clickEdgeListeners=[],_overEdgeListeners=[]}function onClickNode(listener){_clickNodeListeners=[],_clickNodeListeners.push(listener)}function onOverNode(listener){_overNodeListeners=[],_overNodeListeners.push(listener)}function onClickEdge(listener){_clickEdgeListeners=[],_clickEdgeListeners.push(listener)}function onOverEdge(listener){_overEdgeListeners=[],_overEdgeListeners.push(listener)}function _initializeEventListeners(){_mapView.bind(CLICK_NODE,function(event){event.data.node.isDisabled||_clickNodeListeners.forEach(function(listener){listener(event)})}),_mapView.bind(OVER_NODE,function(event){_overNodeListeners.forEach(function(listener){listener(event)})}),_mapView.bind(CLICK_EDGE,function(event){_clickEdgeListeners.forEach(function(listener){listener(event)})}),_mapView.bind(OVER_EDGE,function(event){_overEdgeListeners.forEach(function(listener){listener(event)})})}var self=this,CLICK_NODE="clickNode",OVER_NODE="overNode",CLICK_EDGE="clickEdge",OVER_EDGE="overEdge",_mapView=null,_clickNodeListeners=[],_overNodeListeners=[],_clickEdgeListeners=[],_overEdgeListeners=[];self.setMapView=setMapView,self.onClickNode=onClickNode,self.onOverNode=onOverNode,self.onClickEdge=onClickEdge,self.onOverEdge=onOverEdge,self.clearAllEventListeners=clearAllEventListeners}angular.module("otusjs.studio.navigationBuilder").service("otusjs.studio.navigationBuilder.GraphLayerEventService",service)}(),function(){"use strict";function factory(){function create(mapViewContainer){return new GraphLayer(mapViewContainer)}var self=this;return self.create=create,self}function GraphLayer(mapViewContainer){function mapView(){return _mapView}function loadData(nodes,edges){_mapView.graph.clear(),_mapView.graph.read({nodes:nodes,edges:edges})}function render(){_mapView.refresh()}function updateNodeStyleBefore(style,nodeLimiter){_mapView.graph.updateNodeStyleBefore(style,nodeLimiter)}function updateNodeStyle(style,node){_mapView.graph.updateNodeStyle(style,node)}function updateNodesStyle(style,node){_mapView.graph.updateNodesStyle(style,node)}function updateAllNodesStyle(style){_mapView.graph.updateAllNodesStyle(style)}function updateAllEdgesStyle(style){_mapView.graph.updateAllEdgesStyle(style)}function updateOutputs(style,referenceNode){_mapView.graph.updateOutputs(style,referenceNode)}function updateInputs(style,referenceNode){_mapView.graph.updateInputs(style,referenceNode)}function _updateNodeStyleBefore(style,nodeLimiter){this.nodesArray.every(function(node){if(node.id!==nodeLimiter.id)return node.color=style.color,node.isDisabled=style.isDisabled,!0})}function _updateNodeStyle(style,nodeToUpdate){this.nodesArray.some(function(node){if(node.id===nodeToUpdate.id)return node.color=style.color,node.isDisabled=style.isDisabled,!0})}function _updateNodesStyle(style,nodes){this.nodesArray.some(function(node){if(nodes.some(function(nodeOrigin,index,nodes){if(node.id===nodeOrigin)return node.color=style.color,node.isDisabled=style.isDisabled,nodes.splice(index,1),!0}),!nodes.length)return!0})}function _updateAllNodesStyle(style){this.nodesArray.forEach(function(node){node.color=style.color,node.isDisabled=style.isDisabled})}function _updateAllEdgesStyle(style){this.edgesArray.forEach(function(edge){edge.color=style.color})}function _updateInputs(style,referenceNode){var neighbors=this.inNeighborsIndex[referenceNode.id],neighbor=null;for(neighbor in neighbors)this.nodesArray.some(function(node){if(node.id===neighbor)return node.color=style.color,!0}),this.edgesArray.some(function(edge){if(edge.source===neighbor&&edge.target===referenceNode.id)return edge.color=style.color,!1})}function _updateOutputs(style,referenceNode){var neighbors=this.outNeighborsIndex[referenceNode.id],neighbor=null;for(neighbor in neighbors)this.nodesArray.some(function(node){if(node.id===neighbor)return node.color=style.color,!0});this.edgesArray.forEach(function(edge){edge.source===referenceNode.id&&(edge.color=style.color)})}function _onAddNode(node){node.isOrphan&&updateNodeStyle({color:"#571616"},node)}function _onAddEdge(edge){var source=this.nodesArray.filter(function(node){return node.id===edge.source})[0],target=this.nodesArray.filter(function(node){return node.id===edge.target})[0];source.connectOut(target,edge.isDefault)}var self=this,_mapView={};!function(){sigma.classes.graph.hasMethod("updateNodeStyleBefore")||(sigma.classes.graph.addMethod("updateNodeStyleBefore",_updateNodeStyleBefore),sigma.classes.graph.addMethod("updateNodeStyle",_updateNodeStyle),sigma.classes.graph.addMethod("updateNodesStyle",_updateNodesStyle),sigma.classes.graph.addMethod("updateAllNodesStyle",_updateAllNodesStyle),sigma.classes.graph.addMethod("updateAllEdgesStyle",_updateAllEdgesStyle),sigma.classes.graph.addMethod("updateOutputs",_updateOutputs),sigma.classes.graph.addMethod("updateInputs",_updateInputs),sigma.classes.graph.attach("addNode","onAddNode",_onAddNode),sigma.classes.graph.attach("addEdge","onAddEdge",_onAddEdge)),$("#map-view").empty(),_mapView=new sigma({renderer:{container:mapViewContainer,type:"canvas"}})}(),self.mapView=mapView,self.loadData=loadData,self.render=render,self.updateNodeStyleBefore=updateNodeStyleBefore,self.updateNodeStyle=updateNodeStyle,self.updateNodesStyle=updateNodesStyle,self.updateAllNodesStyle=updateAllNodesStyle,self.updateAllEdgesStyle=updateAllEdgesStyle,self.updateOutputs=updateOutputs,self.updateInputs=updateInputs}angular.module("otusjs.studio.navigationBuilder").factory("otusjs.studio.navigationBuilder.GraphLayerFactory",factory)}(),function(){"use strict";function service(GraphLayerFactory,GraphLayerEventService){function initialize(){_graphLayer=GraphLayerFactory.create("map-view"),self.loadData=function(nodes,edges){var orderedNodes=[].concat(nodes);orderedNodes.push(orderedNodes.splice(1,1)[0]),orderedNodes.map(function(node,index){node.x=index}),_graphLayer.loadData(orderedNodes,edges)},self.render=_graphLayer.render,GraphLayerEventService.setMapView(_graphLayer.mapView())}function lockPreviousNodeOf(node){var style={color:"#CCC",isDisabled:!0};_graphLayer.updateNodeStyleBefore(style,node)}function releasePreviousNodesOf(node){var style={color:"#313131",isDisabled:!1};_graphLayer.updateNodeStyleBefore(style,node)}function setNodeAsTrailhead(node){var style={color:"#3D855B"};_graphLayer.updateNodeStyle(style,node)}function setNodeAsInspected(node){var style={color:"#FFD22E"};_graphLayer.updateNodeStyle(style,node)}function setNodeAsTrailend(node){var style={color:"#1B5BD1"};_graphLayer.updateNodeStyle(style,node)}function setNodesAsOrphans(nodes){var style={color:"#571616"};_graphLayer.updateNodesStyle(style,nodes)}function clearNode(node){var style={color:"#313131",isDisabled:!1};_graphLayer.updateNodeStyle(style,node)}function clearVisualChanges(){var style={color:"#313131",isDisabled:!1};_graphLayer.updateAllNodesStyle(style),_graphLayer.updateAllEdgesStyle(style)}function applyVisualChanges(){_graphLayer.render()}function showOutputs(node){var style={color:"#FF3232"};_graphLayer.updateOutputs(style,node)}function showInputs(node){var style={color:"#249C26"};_graphLayer.updateInputs(style,node)}function lockUnrelated(node){var style={color:"#CCC"};_graphLayer.updateAllNodesStyle(style),_graphLayer.updateAllEdgesStyle(style)}var self=this,_graphLayer={};self.eventService=GraphLayerEventService,self.initialize=initialize,self.lockPreviousNodeOf=lockPreviousNodeOf,self.releasePreviousNodesOf=releasePreviousNodesOf,self.setNodeAsTrailhead=setNodeAsTrailhead,self.setNodeAsTrailend=setNodeAsTrailend,self.setNodeAsInspected=setNodeAsInspected,self.setNodesAsOrphans=setNodesAsOrphans,self.clearNode=clearNode,self.applyVisualChanges=applyVisualChanges,self.clearVisualChanges=clearVisualChanges,self.showOutputs=showOutputs,self.showInputs=showInputs,self.lockUnrelated=lockUnrelated}angular.module("otusjs.studio.navigationBuilder").service("otusjs.studio.navigationBuilder.GraphLayerService",service),service.$inject=["otusjs.studio.navigationBuilder.GraphLayerFactory","otusjs.studio.navigationBuilder.GraphLayerEventService"]}(),function(){"use strict";function factory(){function create(options){return new Edge(options)}function createForDefaultPath(options){return options.isDefault=!0,new Edge(options)}function createForAlterantivePath(options){return options.isDefault=!1,options.isFromOrphan||(options.type="curvedArrow"),new Edge(options)}var self=this;return self.create=create,self.createForDefaultPath=createForDefaultPath,self.createForAlterantivePath=createForAlterantivePath,self}function Edge(options){var self=this;self.id=options.source+"_"+options.target,self.source=options.source,self.target=options.target,self.color=options.color,self.type=options.type,self.isDefault=options.isDefault}angular.module("otusjs.studio.navigationBuilder").factory("otusjs.studio.navigationBuilder.EdgeFactory",factory)}(),function(){"use strict";function factory(NodeFactory,EdgeFactory){function create(data){return new Map(data)}var self=this;return Inject.NodeFactory=NodeFactory,Inject.EdgeFactory=EdgeFactory,self.create=create,self}function Map(data){function nodes(ids){if(ids){var result=[];return _nodes.some(function(node){ids.some(function(id,index){if(node.id===id)return result.push(node),ids.splice(index,1),!0})}),result}return _nodes}function edges(){return _edges}function addNode(node){_nodeExists(node.id)||(node.x=_nodes.length,_nodes.push(node))}function addEdge(edge){_nodeExists(edge.source)&&_nodeExists(edge.target)&&_edges.push(edge)}function createNode(options){var node=Inject.NodeFactory.create(options);return addNode(node),node}function createNodeForDefaultPath(options){var node=Inject.NodeFactory.createForDefaultPath(options);return addNode(node),node}function createNodeForAlterantivePath(options){var node=Inject.NodeFactory.createForAlterantivePath(options);return addNode(node),node}function createEdge(options,isDefault){return Inject.EdgeFactory.create(options,isDefault)}function createEdgeForDefaultPath(options){var edge=Inject.EdgeFactory.createForDefaultPath(options);return addEdge(edge),edge}function createEdgeForAlterantivePath(options){var edge=Inject.EdgeFactory.createForAlterantivePath(options);return addEdge(edge),edge}function getNavigation(node){var result=_nodes.filter(function(nodeToCompare){return nodeToCompare.id===node.id});return result.length?result[0].navigation:void 0}function _nodeExists(nodeID){return!!_nodes.filter(function(node){return node.id===nodeID}).length}var self=this,_nodes=[],_edges=[];self.addNode=addNode,self.addEdge=addEdge,self.nodes=nodes,self.edges=edges,self.createNode=createNode,self.createNodeForDefaultPath=createNodeForDefaultPath,self.createNodeForAlterantivePath=createNodeForAlterantivePath,self.createEdge=createEdge,self.createEdgeForDefaultPath=createEdgeForDefaultPath,self.createEdgeForAlterantivePath=createEdgeForAlterantivePath,self.getNavigation=getNavigation}angular.module("otusjs.studio.navigationBuilder").factory("otusjs.studio.navigationBuilder.MapFactory",factory),factory.$inject=["otusjs.studio.navigationBuilder.NodeFactory","otusjs.studio.navigationBuilder.EdgeFactory"];var Inject={NodeFactory:{},EdgeFactory:{}}}(),function(){"use strict";function factory(){function create(options){var node,initialNodes=["BEGIN NODE","END NODE"];return initialNodes.indexOf(options.id)>-1?node=_createInitialNode(options):(options.color=options.isOrphan?"#571616":"#616161",node=new Node(options)),node}function _createInitialNode(options){return options.color="#A30",options.y=0,options.label="BEGIN NODE"===options.id?"Início":"Fim",options.isDisabled="BEGIN NODE"===options.id,new Node(options)}function createForDefaultPath(options){return options.y=0,options.color=options.isOrphan?"#571616":"#448AFF",options.isDefault=!0,new Node(options)}function createForAlterantivePath(options){return options.color=options.isOrphan?"#571616":"#616161",options.isDefault=!1,new Node(options)}var self=this;return self.create=create,self.createForDefaultPath=createForDefaultPath,self.createForAlterantivePath=createForAlterantivePath,self}function Node(options){function connectIn(newNeighbor,isDefaultConnection){this.factor=newNeighbor.outNeighbors.length,this.inNeighbors.push(newNeighbor),this.isDefault||(this.isDefault=newNeighbor.isDefault&&isDefaultConnection),this.updatePosition(newNeighbor)}function connectOut(newNeighbor,isDefaultConnection){this.outNeighbors.push(newNeighbor),isDefaultConnection&&(this.defaultNextNode=newNeighbor),newNeighbor.connectIn(this,isDefaultConnection)}function updatePosition(inNeighbor){var myDefaultParentY,defaultRouteCount=0;if(this.inNeighbors.forEach(function(neighbor){neighbor.isMyDefaultNext(this)&&(myDefaultParentY||(myDefaultParentY=neighbor.y),++defaultRouteCount)},this),options.isMyRootOrphan)this.y=1;else if(this.isDefault)this.y=0;else if(defaultRouteCount>0)this.y=myDefaultParentY;else{var inCount=this.inNeighbors.length;this.y=inCount/(inCount%2?2:1)*-1}}function isMyDefaultNext(node){return this.defaultNextNode&&this.defaultNextNode.id===node.id}this.defaultNextNode=null,this.inNeighbors=[],this.outNeighbors=[],this.isDisabled=options.isDisabled||!1,this.index=options.index,this.id=options.id,this.label=options.label,this.x=options.x||0,this.y=function(){return options.isOrphan||options.isMyRootOrphan?1:options.y||0}(),this.size=options.size||"10",this.color=options.color||"#000",this.isDefault=function(){return 0===options.index}(),this.isOrphan=options.isOrphan||!1,this.connectIn=connectIn,this.connectOut=connectOut,this.updatePosition=updatePosition,this.isMyDefaultNext=isMyDefaultNext}angular.module("otusjs.studio.navigationBuilder").factory("otusjs.studio.navigationBuilder.NodeFactory",factory)}(),function(){"use strict";function component($scope,scopeService){function onInit(){scopeService.onEvent(scopeService.NBEVENTS.SHOW_MESSENGER,function(event,message){self.isVisible=!0,self.message=message}),scopeService.onEvent(scopeService.NBEVENTS.HIDE_MESSENGER,function(event){self.isVisible=!1})}var self=this;self.message={},self.isVisible=!1,self.$onInit=onInit}angular.module("otusjs.studio.navigationBuilder.messenger").component("otusMessengerInstructor",{templateUrl:"app/navigation-builder/messenger/instructor/instructor-template.html",controller:component}),component.$inject=["$scope","otusjs.studio.navigationBuilder.NavigationBuilderScopeService"]}(),function(){"use strict";function service(scopeService){function showMessenger(message){scopeService.broadcast(scopeService.NBEVENTS.SHOW_MESSENGER,message)}function clearMessenger(){scopeService.broadcast(scopeService.NBEVENTS.HIDE_MESSENGER)}var self=this;self.showMessenger=showMessenger,self.clearMessenger=clearMessenger}angular.module("otusjs.studio.navigationBuilder.messenger").service("otusjs.studio.navigationBuilder.messenger.InstructorService",service),service.$inject=["otusjs.studio.navigationBuilder.NavigationBuilderScopeService"]}(),function(){"use strict";function service(moduleScope,DataService,ModuleEventService,UiEventsService){function activate(survey){DataService.activate(survey),UiEventsService.activate(),ModuleEventService.activate(),moduleScope.emit(moduleScope.NBEVENTS.ROUTE_MODE_ON)}function deactivate(){moduleScope.emit(moduleScope.NBEVENTS.ROUTE_MODE_OFF),DataService.deactivate(),ModuleEventService.deactivate(),UiEventsService.deactivate()}function createCondition(){DataService.createCondition()}function isNewRoute(){return _isNewRoute}function deleteCondition(index){DataService.deleteCondition(index)}function saveRouteBuilding(){DataService.apply(),moduleScope.emit(moduleScope.NBEVENTS.ROUTE_BUILD_SAVED)}function deleteRoute(){DataService.deleteRoute(),moduleScope.emit(moduleScope.NBEVENTS.ROUTE_DELETED)}function selectCondition(index){DataService.selectCondition(index)}function selectedCondition(){return DataService.selectedCondition()}function selectedRoute(){return DataService.selectedRoute()}function startRouteBuilding(origin,destination){DataService.routeExists(origin,destination)?(DataService.useCurrentRouteData(),_isNewRoute=!1):(DataService.initializeRouteData(),DataService.createCondition(),_isNewRoute=!0),DataService.selectCondition(0)}function cancelRouteBuilding(){moduleScope.emit(moduleScope.NBEVENTS.ROUTE_BUILD_CANCELED)}function createRule(when,operator,answer,isCustom){"CheckboxQuestion"==when.type&&answer instanceof Object&&!answer.isMetadata?(isCustom=!0,answer=answer.option.customOptionID,DataService.createRule(when,operator,answer,isCustom)):DataService.createRule(when,operator,answer,isCustom)}function deleteRule(ruleIndex){DataService.deleteRule(ruleIndex)}function getAnswerListForRule(question){return DataService.listAvailableAnswer(question)}function getOperatorListForRule(itemType){return DataService.listAvailableOperator(itemType)}function getWhenListForRule(){return DataService.listAvailableWhen()}function updateRule(ruleIndex,when,operator,answer,isCustom){DataService.updateRule(ruleIndex,when,operator,answer,isCustom)}var _isNewRoute,self=this;self.activate=activate,self.deactivate=deactivate,self.createCondition=createCondition,self.deleteCondition=deleteCondition,self.isNewRoute=isNewRoute,self.saveRouteBuilding=saveRouteBuilding,self.selectCondition=selectCondition,self.selectedCondition=selectedCondition,self.selectedRoute=selectedRoute,self.startRouteBuilding=startRouteBuilding,self.cancelRouteBuilding=cancelRouteBuilding,self.deleteRoute=deleteRoute,self.createRule=createRule,self.deleteRule=deleteRule,self.getAnswerListForRule=getAnswerListForRule,self.getOperatorListForRule=getOperatorListForRule,self.getWhenListForRule=getWhenListForRule,self.updateRule=updateRule}angular.module("otusjs.studio.navigationBuilder.routeBuilder").service("otusjs.studio.navigationBuilder.routeBuilder.RouteBuilderService",service),service.$inject=["otusjs.studio.navigationBuilder.NavigationBuilderScopeService","otusjs.studio.navigationBuilder.routeBuilder.DataService","otusjs.studio.navigationBuilder.routeBuilder.ModuleEventService","otusjs.studio.navigationBuilder.routeBuilder.UiEventsService"]}(),function(){"use strict";function service(moduleScope,RuleWhenBuilderService,RuleOperatorBuilderService,RuleAnswerBuilderService){function activate(survey){_survey=survey,window.survey=_survey}function deactivate(){
_survey=null,_originNode=null,_destinationNode=null,_routeData=null,_selectedNavigation=null,_selectedCondition=null}function hasDestinationNode(){return _nodeExists(_destinationNode)}function hasOriginNode(){return _nodeExists(_originNode)}function selectNode(node){_areSameNode(_originNode,node)?(_originNode=null,moduleScope.emit(moduleScope.NBEVENTS.ORIGIN_NODE_UNSELECTED,node)):_areSameNode(_destinationNode,node)?(_destinationNode=null,moduleScope.emit(moduleScope.NBEVENTS.DESTINATION_NODE_UNSELECTED,node)):hasOriginNode()?(_destinationNode=node,moduleScope.emit(moduleScope.NBEVENTS.DESTINATION_NODE_SELECTED,selectedNode())):(_originNode=node,moduleScope.emit(moduleScope.NBEVENTS.ORIGIN_NODE_SELECTED,node))}function selectedEdges(){return null}function selectedNode(){return[_originNode,_destinationNode]}function _areSameNode(originalNode,nodeToCompare){return!(!_nodeExists(originalNode)||originalNode.id!==nodeToCompare.id)}function _nodeExists(node){return!!node}function apply(){_survey.NavigationManager.selectNavigationByOrigin(_originNode.id),_survey.NavigationManager.applyRoute(_routeData)}function createCondition(){var newConditionData={};newConditionData.name="ROUTE_CONDITION_"+_routeData.conditions.length,newConditionData.rules=[],_routeData.conditions.push(newConditionData)}function deleteCondition(index){_routeData.conditions.splice(index,1),selectCondition(0)}function deleteRoute(){_survey.NavigationManager.selectNavigationByOrigin(_originNode.id),_survey.NavigationManager.deleteRoute(_routeData)}function initializeRouteData(){selectNavigation(_originNode.id),_routeData={},_routeData.origin=_originNode.id,_routeData.destination=_destinationNode.id,_routeData.conditions=[]}function selectCondition(index){if(!_routeData.conditions.length)return!1;_selectedCondition=_routeData.conditions[index]}function selectRoute(){return _routeData}function selectedCondition(){return _selectedCondition}function selectedRoute(){return _routeData}function isSimpleNavigation(origin){return 1===selectNavigation(origin).listRoutes().length}function selectNavigation(origin){return _selectedNavigation=_survey.NavigationManager.selectNavigationByOrigin(origin)}function routeExists(origin,destination){selectNavigation(origin.id);var routeData={};return routeData.origin=origin.id,routeData.destination=destination.id,_selectedNavigation.hasRoute(routeData)}function useCurrentRouteData(){selectNavigation(_originNode.id);var routeQuery={name:_originNode.id+"_"+_destinationNode.id};_routeData=_selectedNavigation.getRouteByName(routeQuery.name).toJSON()}function createRule(when,operator,answer,isCustom){var ruleData={};ruleData.when=when,ruleData.isMetadata=answer.isMetadata||!1,ruleData.operator=operator,ruleData.isCustom=isCustom,ruleData.answer=isCustom?answer:answer.option.value,_selectedCondition.rules.push(ruleData)}function deleteRule(ruleIndex){_selectedCondition.rules.splice(ruleIndex,1)}function listAvailableAnswer(item){return RuleAnswerBuilderService.build(item)}function listAvailableOperator(itemType){return RuleOperatorBuilderService.build(itemType)}function listAvailableWhen(){return _survey.NavigationManager.getAvaiableRuleCriterionTargets(_originNode.id).map(RuleWhenBuilderService.build)}function updateRule(ruleIndex,when,operator,answer,isCustom){var ruleData=_selectedCondition.rules[ruleIndex];ruleData.when=when,ruleData.operator=operator,isCustom||"string"==typeof answer?(ruleData.answer=answer,ruleData.isMetadata=!1,ruleData.isCustom=!0):(ruleData.answer=answer.option.value,ruleData.isMetadata=answer.isMetadata,ruleData.isCustom=!1)}var self=this,_survey=null,_originNode=null,_destinationNode=null,_routeData=null,_selectedNavigation=null,_selectedCondition=null;self.activate=activate,self.deactivate=deactivate,self.hasDestinationNode=hasDestinationNode,self.hasOriginNode=hasOriginNode,self.selectNode=selectNode,self.selectedEdges=selectedEdges,self.selectedNode=selectedNode,self.apply=apply,self.createCondition=createCondition,self.deleteCondition=deleteCondition,self.deleteRoute=deleteRoute,self.initializeRouteData=initializeRouteData,self.isSimpleNavigation=isSimpleNavigation,self.routeExists=routeExists,self.selectCondition=selectCondition,self.selectRoute=selectRoute,self.selectedCondition=selectedCondition,self.selectedRoute=selectedRoute,self.useCurrentRouteData=useCurrentRouteData,self.createRule=createRule,self.deleteRule=deleteRule,self.listAvailableAnswer=listAvailableAnswer,self.listAvailableOperator=listAvailableOperator,self.listAvailableWhen=listAvailableWhen,self.updateRule=updateRule}angular.module("otusjs.studio.navigationBuilder.routeBuilder").service("otusjs.studio.navigationBuilder.routeBuilder.DataService",service),service.$inject=["otusjs.studio.navigationBuilder.NavigationBuilderScopeService","otusjs.studio.navigationBuilder.routeBuilder.RuleWhenBuilderService","otusjs.studio.navigationBuilder.routeBuilder.RuleOperatorBuilderService","otusjs.studio.navigationBuilder.routeBuilder.RuleAnswerBuilderService"]}(),function(){"use strict";function service(){}angular.module("otusjs.studio.navigationBuilder.routeBuilder").service("otusjs.studio.navigationBuilder.routeBuilder.MessageService",service)}(),function(){"use strict";function service(moduleScope,GraphLayerService,InstructorService,RouteDialogService){function activate(){_registerEventListener(moduleScope.NBEVENTS.ROUTE_MODE_ON,_onRouteModeOn),_registerEventListener(moduleScope.NBEVENTS.ROUTE_MODE_OFF,_onRouteModeOff),_registerEventListener(moduleScope.NBEVENTS.ORIGIN_NODE_SELECTED,_onOriginNodeSelected),_registerEventListener(moduleScope.NBEVENTS.ORIGIN_NODE_UNSELECTED,_onOriginNodeUnselected),_registerEventListener(moduleScope.NBEVENTS.DESTINATION_NODE_SELECTED,_onDestinationNodeSelected),_registerEventListener(moduleScope.NBEVENTS.DESTINATION_NODE_UNSELECTED,_onDestinationNodeUnselected),_registerEventListener(moduleScope.NBEVENTS.ROUTE_DELETED,_onRouteDeleted),_registerEventListener(moduleScope.NBEVENTS.ROUTE_BUILD_SAVED,_onRouteBuildSaved),_registerEventListener(moduleScope.NBEVENTS.ROUTE_BUILD_CANCELED,_onRouteBuildCanceled)}function deactivate(){_unregisterEventListeners()}function _registerEventListener(event,listener){var eventReg=moduleScope.onEvent(event,listener);_events.push(eventReg)}function _unregisterEventListeners(){_events.forEach(function(eventReg){eventReg()})}function _onRouteModeOn(event,node){InstructorService.showMessenger(moduleScope.NBMESSAGES.ROUTE_BUILDER.SELECT_ORIGIN)}function _onRouteModeOff(event,node){GraphLayerService.clearVisualChanges(),GraphLayerService.applyVisualChanges(),InstructorService.clearMessenger(),deactivate(),moduleScope.emit(moduleScope.NBEVENTS.RELOAD_MAP_DATA)}function _onOriginNodeSelected(event,node){GraphLayerService.lockPreviousNodeOf(node),GraphLayerService.setNodeAsTrailhead(node),GraphLayerService.applyVisualChanges(),InstructorService.showMessenger(moduleScope.NBMESSAGES.ROUTE_BUILDER.SELECT_DESTINATION),moduleScope.apply()}function _onOriginNodeUnselected(event,node){GraphLayerService.releasePreviousNodesOf(node),GraphLayerService.clearNode(node),GraphLayerService.applyVisualChanges(),InstructorService.showMessenger(moduleScope.NBMESSAGES.ROUTE_BUILDER.SELECT_ORIGIN),moduleScope.apply(),moduleScope.emit(moduleScope.NBEVENTS.RELOAD_MAP_DATA)}function _onDestinationNodeSelected(event,node){GraphLayerService.setNodeAsTrailend(node),GraphLayerService.applyVisualChanges(),InstructorService.clearMessenger(),RouteDialogService.showDialog(node[0],node[1])}function _onDestinationNodeUnselected(event,node){GraphLayerService.clearNode(node),GraphLayerService.applyVisualChanges(),InstructorService.showMessenger(moduleScope.NBMESSAGES.ROUTE_BUILDER.SELECT_DESTINATION),moduleScope.emit(moduleScope.NBEVENTS.RELOAD_MAP_DATA)}function _onRouteDeleted(event){RouteDialogService.closeDialog(),moduleScope.emit(moduleScope.NBEVENTS.ROUTE_MODE_OFF),moduleScope.emit(moduleScope.NBEVENTS.NAVIGATION_UPDATED)}function _onRouteBuildSaved(event){RouteDialogService.closeDialog(),moduleScope.emit(moduleScope.NBEVENTS.ROUTE_MODE_OFF),moduleScope.emit(moduleScope.NBEVENTS.NAVIGATION_UPDATED)}function _onRouteBuildCanceled(event){RouteDialogService.closeDialog(),moduleScope.emit(moduleScope.NBEVENTS.ROUTE_MODE_OFF)}var self=this,_events=[];self.activate=activate,self.deactivate=deactivate}angular.module("otusjs.studio.navigationBuilder.routeBuilder").service("otusjs.studio.navigationBuilder.routeBuilder.ModuleEventService",service),service.$inject=["otusjs.studio.navigationBuilder.NavigationBuilderScopeService","otusjs.studio.navigationBuilder.GraphLayerService","otusjs.studio.navigationBuilder.messenger.InstructorService","otusjs.studio.navigationBuilder.routeBuilder.RouteDialogService"]}(),function(){"use strict";function service(){function build(item){var answers=[];return"SingleSelectionQuestion"!==item.objectType&&"CheckboxQuestion"!==item.objectType?answers=answers.concat(_getCustomAnswer()):item.options?answers=answers.concat(item.options.map(getAnswerOption)):item.options&&(answers=answers.concat(item.options.map(getAnswerOption))),item.metadata&&item.metadata.options&&(answers=answers.concat(item.metadata.options.map(getMetadataOption))),answers}function _getCustomAnswer(){return[{isMetadata:!1,option:{label:{ptBR:{plainText:""},value:null}}}]}function buildCustomAnswer(when,ruleData,answerList){if("CalendarQuestion"===when.type){var date=new Date(ruleData.answer);date.getDate(),date.getMonth(),date.getFullYear()}else if("CheckboxQuestion"===when.type)return _filterAnswerCheckboxQuestion(ruleData,answerList);return{isMetadata:!1,option:{label:{ptBR:{plainText:ruleData.answer},value:null}}}}function _filterAnswerCheckboxQuestion(ruleData,answerList){var resultFilter=answerList.filter(function(element){if(element.option.customOptionID==ruleData.answer)return element});return{isMetadata:!1,option:{label:{ptBR:{plainText:resultFilter.length>0?resultFilter[0].option.label.ptBR.plainText:ruleData.answer},value:null}}}}function getAnswerOption(option){return{isMetadata:!1,option:option}}function getMetadataOption(option){return{isMetadata:!0,option:option}}var self=this;self.build=build,self.buildCustomAnswer=buildCustomAnswer}angular.module("otusjs.studio.navigationBuilder").service("otusjs.studio.navigationBuilder.routeBuilder.RuleAnswerBuilderService",service)}(),function(){"use strict";function Factory(){function createNew(){return new RuleData}function createFromRuleModel(){return new RuleData}var self=this;return self.createNew=createNew,self.createFromRuleModel=createFromRuleModel,self}function RuleData(){}angular.module("otusjs.studio.navigationBuilder").factory("otusjs.studio.navigationBuilder.RuleDataFactory",Factory)}(),function(){"use strict";function service(){function build(itemType){return _isTextItem(itemType)?_operatorMap.text:_isNumberItem(itemType)?_operatorMap.number:_isDateItem(itemType)?_operatorMap.date:_isTimeItem(itemType)?_operatorMap.time:_isSingleChoiceItem(itemType)?_operatorMap.singleChoice:_isMultipleChoiceItem(itemType)?_operatorMap.multipleChoice:[]}function _isTextItem(itemType){return"TextQuestion"===itemType||"EmailQuestion"===itemType||"PhoneQuestion"===itemType||"AutocompleteQuestion"===itemType}function _isNumberItem(itemType){return"IntegerQuestion"===itemType||"DecimalQuestion"===itemType}function _isDateItem(itemType){return"CalendarQuestion"===itemType}function _isTimeItem(itemType){return"TimeQuestion"===itemType}function _isSingleChoiceItem(itemType){return"SingleSelectionQuestion"===itemType||"FileUploadQuestion"===itemType||"GridTextQuestion"===itemType||"GridIntegerQuestion"===itemType}function _isMultipleChoiceItem(itemType){return"CheckboxQuestion"===itemType}var self=this,_operatorMap={};!function(){_operatorMap={};var _notEqual={};_notEqual.type="notEqual",_notEqual.label={},_notEqual.label.ptBR={},_notEqual.label.ptBR.plainText="Diferente de";var _equal={};_equal.type="equal",_equal.label={},_equal.label.ptBR={},_equal.label.ptBR.plainText="Igual a";var _contains={};_contains.type="contains",_contains.label={},_contains.label.ptBR={},_contains.label.ptBR.plainText="Contém";var _in={};_in.type="in",_in.label={},_in.label.ptBR={},_in.label.ptBR.plainText="Está dentro do intervalo";var _between={};_between.type="between",_between.label={},_between.label.ptBR={},_between.label.ptBR.plainText="Está entre os valores";var _greater={};_greater.type="greater",_greater.label={},_greater.label.ptBR={},_greater.label.ptBR.plainText="É maior que";var _greaterEqual={};_greaterEqual.type="greaterEqual",_greaterEqual.label={},_greaterEqual.label.ptBR={},_greaterEqual.label.ptBR.plainText="É maior ou igual a";var _lower={};_lower.type="lower",_lower.label={},_lower.label.ptBR={},_lower.label.ptBR.plainText="É menor que";var _lowerEqual={};_lowerEqual.type="lowerEqual",_lowerEqual.label={},_lowerEqual.label.ptBR={},_lowerEqual.label.ptBR.plainText="É menor ou igual a";var _quantity={};_quantity.type="quantity",_quantity.label={},_quantity.label.ptBR={},_quantity.label.ptBR.plainText="Quantidade selecionada igual a";var _minSelected={};_minSelected.type="minSelected",_minSelected.label={},_minSelected.label.ptBR={},_minSelected.label.ptBR.plainText="Quantidade mínima selecionada de";var _maxSelected={};_maxSelected.type="maxSelected",_maxSelected.label={},_maxSelected.label.ptBR={},_maxSelected.label.ptBR.plainText="Quantidade máxima selecionada de",_operatorMap.singleChoice=[_notEqual,_equal],_operatorMap.text=Array.prototype.concat(_operatorMap.singleChoice,[_contains]),_operatorMap.number=Array.prototype.concat(_operatorMap.singleChoice,[_in,_between,_greater,_greaterEqual,_lower,_lowerEqual]),_operatorMap.date=_operatorMap.number,_operatorMap.time=_operatorMap.date,_operatorMap.multipleChoice=Array.prototype.concat(_operatorMap.text,[_quantity,_minSelected,_maxSelected])}(),self.build=build}angular.module("otusjs.studio.navigationBuilder").service("otusjs.studio.navigationBuilder.routeBuilder.RuleOperatorBuilderService",service)}(),function(){"use strict";function service(){function build(item){var builded={};return builded.type=item.objectType,builded.icon=_mapping[item.objectType],builded.templateID=item.templateID,builded.customID=item.customID,builded.label=item.label,builded.item=item,builded}var self=this,_mapping={};self.build=build,function(){_mapping.CalendarQuestion={},_mapping.CalendarQuestion.image="date_range",_mapping.CalendarQuestion.tooltip="Data",_mapping.IntegerQuestion={},_mapping.IntegerQuestion.image="looks_one",_mapping.IntegerQuestion.tooltip="Número Inteiro",_mapping.DecimalQuestion={},_mapping.DecimalQuestion.image="exposure_zero",_mapping.DecimalQuestion.tooltip="Número Decimal",_mapping.SingleSelectionQuestion={},_mapping.SingleSelectionQuestion.image="radio_button_checked",_mapping.SingleSelectionQuestion.tooltip="Seleção Única",_mapping.CheckboxQuestion={},_mapping.CheckboxQuestion.image="check_box",_mapping.CheckboxQuestion.tooltip="Checkbox",_mapping.TextQuestion={},_mapping.TextQuestion.image="text_format",_mapping.TextQuestion.tooltip="Texto",_mapping.EmailQuestion={},_mapping.EmailQuestion.image="email",_mapping.EmailQuestion.tooltip="Email",_mapping.TimeQuestion={},_mapping.TimeQuestion.image="access_time",_mapping.TimeQuestion.tooltip="Hora",_mapping.PhoneQuestion={},_mapping.PhoneQuestion.image="phone",_mapping.PhoneQuestion.tooltip="Telefone",_mapping.AutocompleteQuestion={},_mapping.AutocompleteQuestion.image="youtube_searched_for",_mapping.AutocompleteQuestion.tooltip="Auto Completar",_mapping.FileUploadQuestion={},_mapping.FileUploadQuestion.image="attach_file",_mapping.FileUploadQuestion.tooltip="Upload de Arquivo",_mapping.TextItem={},_mapping.TextItem.image="message",_mapping.TextItem.tooltip="Texto",_mapping.ImageItem={},_mapping.ImageItem.image="image",_mapping.ImageItem.tooltip="Imagem",_mapping.GridTextQuestion={},_mapping.GridTextQuestion.image="grid_on",_mapping.GridTextQuestion.tooltip="Grade de Texto",_mapping.GridIntegerQuestion={},_mapping.GridIntegerQuestion.image="grid_on",_mapping.GridIntegerQuestion.tooltip="Grade de Número"}()}angular.module("otusjs.studio.navigationBuilder").service("otusjs.studio.navigationBuilder.routeBuilder.RuleWhenBuilderService",service)}(),function(){"use strict";function service(moduleScope,GraphLayerService,DataService){function activate(){GraphLayerService.eventService.onClickNode(_selectNode),GraphLayerService.eventService.onOverNode(_focusNode),GraphLayerService.eventService.onClickEdge(_selectRoute),GraphLayerService.eventService.onOverEdge(_focusEdge)}function deactivate(){GraphLayerService.eventService.clearAllEventListeners()}function _selectNode(event){DataService.selectNode(event.data.node)}function _focusNode(event){}function _selectRoute(event){var map=moduleScope.get("map");map.nodes([event.data.edge.source]),event.data.edge.source;DataService.selectNode()}function _focusEdge(event){console.log(event.data.edge)}var self=this;self.activate=activate,self.deactivate=deactivate}angular.module("otusjs.studio.navigationBuilder.routeBuilder").service("otusjs.studio.navigationBuilder.routeBuilder.UiEventsService",service),service.$inject=["otusjs.studio.navigationBuilder.NavigationBuilderScopeService","otusjs.studio.navigationBuilder.GraphLayerService","otusjs.studio.navigationBuilder.routeBuilder.DataService"]}(),function(){"use strict";function service($mdDialog,moduleScope){function showDialog(originNode,destinationNode){_dialogSettings.locals={origin:originNode,destination:destinationNode,moduleScope:moduleScope},$mdDialog.show(_dialogSettings)}function closeDialog(){$mdDialog.hide()}function _setupDialogConfiguration(){_dialogSettings.templateUrl="app/navigation-builder/route/dialog/route-dialog-template.html",_dialogSettings.controller=DialogController,_dialogSettings.controllerAs="ctrl",_dialogSettings.escapeToClose=!1,_dialogSettings.fullscreen=!0,_dialogSettings.hasBackdrop=!0}var self=this,_dialogSettings={};self.showDialog=showDialog,self.closeDialog=closeDialog,function(){_setupDialogConfiguration()}()}function DialogController($mdDialog,origin,destination,moduleScope){function cancel(response){$mdDialog.hide(response)}function confirm(response){$mdDialog.hide(response)}var self=this;self.origin=origin,self.destination=destination,self.cancel=cancel,self.confirm=confirm}angular.module("otusjs.studio.navigationBuilder.routeBuilder").service("otusjs.studio.navigationBuilder.routeBuilder.RouteDialogService",service),service.$inject=["$mdDialog","otusjs.studio.navigationBuilder.NavigationBuilderScopeService"]}(),function(){"use strict";function component(RouteBuilderService){function onInit(){_childs={},_initializeLabels(),RouteBuilderService.startRouteBuilding(self.originNode,self.destinationNode),self.isNewRoute=RouteBuilderService.isNewRoute(),self.selectedRoute=RouteBuilderService.selectedRoute(),self.conditions=RouteBuilderService.selectedRoute().conditions,self.conditions.forEach(function(condition){_childs[condition.name]=[]}),readyToSave()}function cancel(){RouteBuilderService.cancelRouteBuilding()}function save(){RouteBuilderService.saveRouteBuilding()}function deleteRoute(){RouteBuilderService.deleteRoute()}function createCondition(){RouteBuilderService.createCondition(),_childs[self.conditions[self.conditions.length-1].name]=[]}function deleteCondition(index,condition){delete _childs[condition.name],RouteBuilderService.deleteCondition(index)}function selectCondition(index){RouteBuilderService.selectCondition(index)}function readyToSave(){return!!self.selectedRoute.isDefault||(self.selectedRoute.conditions.length||createCondition(),self.selectedRoute.conditions.every(function(condition){return condition.rules.length>0}))}function _initializeLabels(){self.label={dialog:{title:"Criar nova Rota"},button:{cancel:"Cancelar",save:"Salvar Rota",createCondition:"Criar condição de rota",deleteRoute:"Excluir esta rota"},origin:"Origem",destination:"Destino",originNode:self.originNode.label,destinationNode:self.destinationNode.label,conditionTitle:"Regras de condição",isDefaultRoute:"Rota padrão",message:{emptyConditions:"Você ainda não criou condições de rota. Clicando em CRIAR CONDIÇÃO DE ROTA."}}}function childRules(condition){return _childs[condition.name]}var self=this,_childs={};self.selectedRoute=[],self.conditions=[],self.$onInit=onInit,self.cancel=cancel,self.save=save,self.deleteRoute=deleteRoute,self.createCondition=createCondition,self.selectCondition=selectCondition,self.deleteCondition=deleteCondition,self.readyToSave=readyToSave,self.childRules=childRules,self.deleteRule=function(ruleEditor){var condition=RouteBuilderService.selectedCondition();_childs[condition.name].indexOf(ruleEditor);condition.rules.forEach(function(rule,index){_childs[condition.name][index].ruleData.index=index}),RouteBuilderService.deleteRule(ruleEditor.ruleData.index),_childs[condition.name].splice(ruleEditor.ruleData.index,1)}}angular.module("otusjs.studio.navigationBuilder.routeBuilder").component("otusRouteEditor",{templateUrl:"app/navigation-builder/route/editor/route-editor.html",controller:component,bindings:{originNode:"<",destinationNode:"<",onConfirm:"&"}}),component.$inject=["otusjs.studio.navigationBuilder.routeBuilder.RouteBuilderService"]}(),function(){"use strict";function component(RouteBuilderService,RuleAnswerBuilderService){function onInit(){_initializeWhenList(),self.isDisable=!0,self.isAnswerDisable=!0,self.showSaveRuleButton=!0,self.readyToSave=_readyToSave()}function answers(filterValue){if(filterValue){return self.answerList.filter(function(answer){return-1!=answer.option.label.ptBR.plainText.search(filterValue)||-1!=self.selectedWhen.templateID.search(filterValue)}).filter(_filter)}return self.answerList.filter(_filter)}function _filter(element,index){return"SingleSelectionQuestion"==self.selectedWhen.type||"CheckboxQuestion"==self.selectedWhen.type||index>0}function answerInputChange(){self.answerSearchText&&("SingleSelectionQuestion"==self.selectedWhen.type?(isCustomAnswer=!1,self.readyToSave=!1):(isCustomAnswer=!0,self.selectedAnswer=self.answerSearchText,self.readyToSave=_readyToSave()))}function answerChange(answer){isCustomAnswer||(isCustomAnswer=!1,self.selectedAnswer=answer),self.readyToSave=_readyToSave()}function whens(filterValue){if(filterValue){return self.whenList.filter(function(when){return-1!=when.label.ptBR.plainText.search(filterValue)||-1!=when.templateID.search(filterValue)})}return self.whenList}function whenChange(when){self.selectedWhen=when,self.operatorList=[],self.answerList=[],self.selectedWhen?(self.operatorList=_returnFilteredOperatorList(self.selectedWhen.type),self.answerList=RouteBuilderService.getAnswerListForRule(self.selectedWhen.item),self.isDisable=!1):self.isDisable=!0,self.readyToSave=_readyToSave()}function _returnFilteredOperatorList(when){return RouteBuilderService.getOperatorListForRule(when).filter(function(element,index){if("Intervalo de valores"!==element.label.ptBR.plainText&&"Está dentro do intervalo"!==element.label.ptBR.plainText&&"Está entre os valores"!==element.label.ptBR.plainText)return!0})}function _initializeWhenList(){self.whenList=[],self.whenList=RouteBuilderService.getWhenListForRule()}function operatorChange(operator){self.selectedOperator=operator,self.readyToSave=_readyToSave()}function saveRule(){RouteBuilderService.selectCondition(self.conditionIndex),_readyToSave()&&RouteBuilderService.createRule(self.selectedWhen,self.selectedOperator,self.selectedAnswer,isCustomAnswer),isCustomAnswer=!1,self.whenSearchText="",self.operatorSearchText="",self.answerSearchText=""}function _readyToSave(){return!!(_resolveRuleWhen()&&_resolveRuleOperator()&&_resolveRuleAnswer())}function _resolveRuleWhen(){return!!self.selectedWhen}function _resolveRuleOperator(){return!!self.selectedOperator}function _resolveRuleAnswer(){return!(!isCustomAnswer&&!self.selectedAnswer)}var isCustomAnswer,self=this;self.$onInit=onInit,self.answers=answers,self.answerChange=answerChange,self.answerInputChange=answerInputChange,self.operatorChange=operatorChange,self.whens=whens,self.whenChange=whenChange,self.saveRule=saveRule}angular.module("otusjs.studio.navigationBuilder.routeBuilder").component("otusRuleCreator",{templateUrl:"app/navigation-builder/route/editor/rule-creator-template.html",controller:component,bindings:{condition:"<",conditionIndex:"<"}}),component.$inject=["otusjs.studio.navigationBuilder.routeBuilder.RouteBuilderService","otusjs.studio.navigationBuilder.routeBuilder.RuleAnswerBuilderService"]}(),function(){"use strict";function component($element,RouteBuilderService,RuleAnswerBuilderService){function onInit(){self.isDisable=!1,self.isAnswerDisable=!1,self.showDeleteRuleButton=!0,_initializeWhenList(),_applyRuleDataWhen(),_applyRuleDataOperator(),_applyRuleDataAnswer(),self.$element=$element,self.ruleData.index=self.otusRouteEditor.childRules(self.condition).length,self.otusRouteEditor.childRules(self.condition).push(self)}function _applyRuleDataWhen(){var templateID=self.ruleData.when.templateID||self.ruleData.when;self.whenList.some(function(when){if(when.templateID===templateID)return self.selectedWhen=when,!0})}function _applyRuleDataOperator(){self.operatorList=RouteBuilderService.getOperatorListForRule(self.selectedWhen.type);var type=self.ruleData.operator.type||self.ruleData.operator;self.operatorList.some(function(operator){if(operator.type===type)return self.selectedOperator=operator,!0})}function _applyRuleDataAnswer(){self.answerList=RouteBuilderService.getAnswerListForRule(self.selectedWhen.item),self.ruleData.isCustom?self.selectedAnswer=RuleAnswerBuilderService.buildCustomAnswer(self.selectedWhen,self.ruleData,self.answerList):self.selectedAnswer=self.answerList.filter(function(answer){return answer.option.value===self.ruleData.answer&&answer.isMetadata===self.ruleData.isMetadata})[0]}function answers(filterValue){if(filterValue){return self.answerList.filter(function(answer){return-1!=answer.option.label.ptBR.plainText.search(filterValue)||-1!=self.selectedWhen.templateID.search(filterValue)}).filter(_filter)}return self.answerList.filter(_filter)}function _filter(element,index){if(self.selectedWhen)return"SingleSelectionQuestion"==self.selectedWhen.type||"CheckboxQuestion"==self.selectedWhen.type||index>0}function answerInputChange(){self.answerSearchText&&("SingleSelectionQuestion"==self.selectedWhen.type?(_isCustomAnswer=!1,self.readyToSave=!1):(_isCustomAnswer=!0,self.selectedAnswer=self.answerSearchText,updateRule(),self.readyToSave=_readyToSave()))}function answerChange(answer){_isCustomAnswer&&answer||(_isCustomAnswer=!1,self.selectedAnswer=answer,updateRule()),self.readyToSave=_readyToSave()}function whens(filterValue){if(filterValue){return self.whenList.filter(function(when){return-1!=when.label.ptBR.plainText.search(filterValue)||-1!=when.templateID.search(filterValue)})}return self.whenList}function operatorChange(operator){self.selectedOperator=operator,self.readyToSave=_readyToSave(),updateRule()}function whenChange(when){self.selectedWhen=when,self.answerSearchText="",self.operatorSearchText="",self.selectedWhen?(self.operatorList=_returnFilteredOperatorList(self.selectedWhen.type),self.answerList=RouteBuilderService.getAnswerListForRule(self.selectedWhen.item),self.isDisable=!1):self.isDisable=!0,self.readyToSave=_readyToSave(),updateRule()}function _returnFilteredOperatorList(when){return RouteBuilderService.getOperatorListForRule(when).filter(function(element,index){if("Intervalo de valores"!==element.label.ptBR.plainText&&"Está dentro do intervalo"!==element.label.ptBR.plainText&&"Está entre os valores"!==element.label.ptBR.plainText)return!0})}function updateRule(){RouteBuilderService.selectCondition(self.conditionIndex),self.ruleData&&self.selectedAnswer&&RouteBuilderService.updateRule(self.ruleData.index,self.selectedWhen,self.selectedOperator,self.selectedAnswer,_isCustomAnswer)}function deleteRule(){RouteBuilderService.selectCondition(self.conditionIndex),self.onUpdate({ruleEditor:self})}function _initializeWhenList(){self.whenList=[],self.whenList=RouteBuilderService.getWhenListForRule()}function _readyToSave(){return!!(_resolveRuleWhen()&&_resolveRuleOperator()&&_resolveRuleAnswer())}function _resolveRuleWhen(){return!!self.selectedWhen}function _resolveRuleOperator(){return!!self.selectedOperator}function _resolveRuleAnswer(){return!(!_isCustomAnswer&&!self.selectedAnswer)}var _isCustomAnswer,self=this;self.$onInit=onInit,self.answers=answers,self.answerChange=answerChange,self.answerInputChange=answerInputChange,self.operatorChange=operatorChange,self.whens=whens,self.whenChange=whenChange,self.updateRule=updateRule,self.deleteRule=deleteRule}angular.module("otusjs.studio.navigationBuilder.routeBuilder").component("otusRuleEditor",{templateUrl:"app/navigation-builder/route/editor/rule-editor-template.html",controller:component,bindings:{ruleData:"<",condition:"<",conditionIndex:"<",onUpdate:"&"},require:{otusRouteEditor:"^otusRouteEditor"}}),component.$inject=["$element","otusjs.studio.navigationBuilder.routeBuilder.RouteBuilderService","otusjs.studio.navigationBuilder.routeBuilder.RuleAnswerBuilderService"]}(),function(){"use strict";function service(){var self=this;self.backgroundColor="#448aff",self.textColor="#737373"}angular.module("otus.textEdition").service("otus.textEdition.ColorContext",service)}(),function(){"use strict";function controller(ColorContext,$mdDialog){function cancel(){$mdDialog.cancel()}function select(){ColorContext.backgroundColor=self.currentBackgroundColor,ColorContext.textColor=self.currentTextColor,$mdDialog.hide()}var self=this;self.select=select,self.cancel=cancel,function(){self.currentBackgroundColor=ColorContext.backgroundColor,self.currentTextColor=ColorContext.textColor}()}angular.module("otus.textEdition").controller("otus.textEdition.ColorController",controller),controller.$inject=["otus.textEdition.ColorContext","$mdDialog"]}(),function(){"use strict";function Controller(){function changeState(){self.isToShow=!self.isToShow,self.template.icon=self.isToShow?"expand_less":"expand_more"}var self=this;self.changeState=changeState,self.$onInit=function(){self.css={},self.template={},self.event={},self.isToShow=!1,self.template.icon="expand_more"}}angular.module("ui.components").component("itemContainer",{templateUrl:"app/shared/ui-components/item-container/item-container-template.html",controller:Controller,transclude:{headerSlot:"itemContainerHeader",bodySlot:"itemContainerBody"}}),Controller.$inject=[]}(),function(){"use strict";function SurveyTemplateController($element,$scope,SelectedSurveyTemplatesManagementService){function _select(){self.isSelected=!0,mdCard.addClass("selected-template"),SelectedSurveyTemplatesManagementService.selectSurveyTemplate(self.surveyTemplate)}function _remove(){self.isSelected=!1,mdCard.removeClass("selected-template"),SelectedSurveyTemplatesManagementService.removeSurveyTemplate(self.surveyTemplate)}function _scopeApply(){$scope.$apply()}var mdCard,self=this;self.isSelected=!1,self.$onDestroy=function(){self.isSelected&&SelectedSurveyTemplatesManagementService.removeSurveyTemplate(self.surveyTemplate)},$element.on("click",function(){mdCard=$element.children(),self.isSelected?_remove():_select(),_scopeApply()})}angular.module("surveyTemplates").component("surveyTemplate",{templateUrl:"app/dashboard/survey-templates/components/survey-template/survey-template.html",controller:SurveyTemplateController,bindings:{surveyTemplate:"<"}}),SurveyTemplateController.$inject=["$element","$scope","SelectedSurveyTemplatesManagementService"]}(),function(){"use strict";function SurveyTemplateControllerList(SurveyTemplateManagerService){function getSurveyTemplatesList(){return SurveyTemplateManagerService.surveyTemplates}var self=this;self.getSurveyTemplatesList=getSurveyTemplatesList,self.$onInit=function(){SurveyTemplateManagerService.initializeSurveyTemplateList()}}
angular.module("surveyTemplates").component("surveyTemplatesList",{templateUrl:"app/dashboard/survey-templates/components/survey-templates-list/survey-templates-list.html",controller:SurveyTemplateControllerList}),SurveyTemplateControllerList.$inject=["SurveyTemplateManagerService"]}(),function(){"use strict";function NewSurveyFormDialogService($mdDialog){function showDialog(){return $mdDialog.show(self.dialogSettings).then(forwardSuccessfulExecution,forwardUnsuccessfulExecution),{onConfirm:function(callback){self.callback=callback}}}function forwardSuccessfulExecution(response){"create"==response.action&&self.callback&&self.callback(response.data)}function forwardUnsuccessfulExecution(error){}var self=this;self.showDialog=showDialog,function(){self.dialogSettings={parent:angular.element(document.body),templateUrl:"app/dashboard/survey-templates/dialog/new-survey-form/new-survey-form-dialog.html",controller:DialogController,controllerAs:"controller",openFrom:"#system-toolbar",closeTo:{bottom:0}}}()}function DialogController($mdDialog){function cancel(response){$mdDialog.hide(response)}function createSurveyForm(response){$mdDialog.hide(response)}var self=this;self.cancel=cancel,self.createSurveyForm=createSurveyForm}angular.module("studio.dashboard").service("NewSurveyFormDialogService",NewSurveyFormDialogService),NewSurveyFormDialogService.$inject=["$mdDialog"]}(),function(){"use strict";function SurveyTemplatesToolbarController(SurveyTemplateManagerService,SelectedSurveyTemplatesManagementService,$mdToast,DashboardStateService,$window){function deleteSelectedSurveyTemplate(){SelectedSurveyTemplatesManagementService.selectedSurveyTemplates.forEach(function(template){SurveyTemplateManagerService.deleteSurveyTemplate(template)}),$mdToast.show($mdToast.simple().textContent("Template(s) removido(s) com sucesso!"))}function openEditorForSelectedSurveyTemplate(){var selectedSurveyTemplate=_getSelectedSurveyTemplate();$window.sessionStorage.setItem("surveyTemplate_OID",selectedSurveyTemplate.oid),DashboardStateService.goToEditorWithSurveyTemplate(selectedSurveyTemplate)}function _getSelectedSurveyTemplate(){return SelectedSurveyTemplatesManagementService.selectedSurveyTemplates[0].template}var self=this;self.SelectedSurveyTemplatesManagementService=SelectedSurveyTemplatesManagementService,self.deleteSelectedSurveyTemplate=deleteSelectedSurveyTemplate,self.openEditorForSelectedSurveyTemplate=openEditorForSelectedSurveyTemplate}angular.module("surveyTemplates").component("surveyTemplatesToolbar",{templateUrl:"app/dashboard/survey-templates/components/survey-templates-toolbar/survey-templates-toolbar-template.html",controller:SurveyTemplatesToolbarController}),SurveyTemplatesToolbarController.$inject=["SurveyTemplateManagerService","SelectedSurveyTemplatesManagementService","$mdToast","DashboardStateService","$window"]}(),function(){"use strict";function AddDataSourceEventFactory(WorkspaceService){function create(){return new AddDataSourceEvent(WorkspaceService)}var self=this;return self.create=create,self}function AddDataSourceEvent(WorkspaceService){function execute(item,name){WorkspaceService.workspace.isdb.userEdits.store(self),WorkspaceService.getSurvey().getDataSource(name).performBind(item.templateID),WorkspaceService.saveWork()}var self=this;self.execute=execute}angular.module("editor.core").factory("AddDataSourceEventFactory",AddDataSourceEventFactory),AddDataSourceEventFactory.$inject=["WorkspaceService"]}(),function(){"use strict";function RemoveDataSourceEventFactory(WorkspaceService){function create(){return new RemoveDataSourceEvent(WorkspaceService)}var self=this;return self.create=create,self}function RemoveDataSourceEvent(WorkspaceService){function execute(item,name){WorkspaceService.workspace.isdb.userEdits.store(self),WorkspaceService.getSurvey().getDataSource(name).removeBind(item.templateID),WorkspaceService.saveWork()}var self=this;self.execute=execute}angular.module("editor.core").factory("RemoveDataSourceEventFactory",RemoveDataSourceEventFactory),RemoveDataSourceEventFactory.$inject=["WorkspaceService"]}(),function(){"use strict";function AddFileUploadEventFactory(WorkspaceService){function create(){return new AddFileUploadEvent(WorkspaceService)}var self=this;return self.create=create,self}function AddFileUploadEvent(WorkspaceService){function execute(item,name){WorkspaceService.workspace.isdb.userEdits.store(self),WorkspaceService.getSurvey().getFileUpload(name).performBind(item.templateID),WorkspaceService.saveWork()}var self=this;self.execute=execute}angular.module("editor.core").factory("AddFileUploadEventFactory",AddFileUploadEventFactory),AddFileUploadEventFactory.$inject=["WorkspaceService"]}(),function(){"use strict";function RemoveFileUploadEventFactory(WorkspaceService){function create(){return new RemoveFileUploadEvent(WorkspaceService)}var self=this;return self.create=create,self}function RemoveFileUploadEvent(WorkspaceService){function execute(item,name){WorkspaceService.workspace.isdb.userEdits.store(self),WorkspaceService.getSurvey().getFileUpload(name).removeBind(item.templateID),WorkspaceService.saveWork()}var self=this;self.execute=execute}angular.module("editor.core").factory("RemoveFileUploadEventFactory",RemoveFileUploadEventFactory),RemoveFileUploadEventFactory.$inject=["WorkspaceService"]}(),function(){"use strict";function Controller(){function onInit(){var validTooltipDirections=["top","bottom","left","right"];self.css={},self.template={},self.event={},self.template.ariaLabel=self.ariaLabel||self.label,self.template.label=self.label,self.template.tooltip=self.tooltip||self.label,self.template.tooltipDirection=void 0!==self.tooltipDirection&&-1!==validTooltipDirections.indexOf(self.tooltipDirection)?self.tooltipDirection:"top",self.template.leftIcon=self.iconButton||self.leftIcon,self.template.rightIcon=self.rightIcon,self.template.hasLeftIcon=void 0!==self.template.leftIcon,self.template.hasRightIcon=void 0===self.iconButton&&void 0!==self.template.rightIcon,self.css.iconButton=void 0!==self.iconButton?"md-icon-button":"",self.event.click=self.click}var self=this;self.$onInit=onInit}angular.module("editor.ui").component("otusButton",{templateUrl:"app/editor/ui/base/button/button.html",controller:Controller,bindings:{click:"&",label:"@",tooltip:"@",leftIcon:"@",tooltipDirection:"@",rightIcon:"@",ariaLabel:"@",iconButton:"@"}})}(),function(){"use strict";function Controller($element,CustomValueService){function onInit(){_checkFunction=self.checkFunction,_option=self.option}function postLink(){$element.children()[0].innerText=_option.customValue,$element.on("focusout",_execute)}function _execute(event){CustomValueService.execute(event,_option,_checkFunction)}var _checkFunction,_option;self=this,self.$onInit=onInit,self.$postLink=postLink}angular.module("editor.ui").component("otusCustomValue",{templateUrl:"app/editor/ui/base/custom-value/custom-value.html",controller:Controller,bindings:{option:"<",checkFunction:"&"}}),Controller.$inject=["$element","CustomValueService"]}(),function(){"use strict";function EditableCustomIDService(WorkspaceService,UpdateQuestionEventFactory,$mdToast){function isEmpty(customizedID){return""===customizedID}function removeAllBlankSpaces(customizedID){return customizedID.replace(/\s/g,"")}function restoreScreenID(event,editableID_Object){event.target.innerText=editableID_Object.getCustomizedID()}function hasChanges(customizedID,editableID_Object){return customizedID!==editableID_Object.getCustomizedID()}function execute(event,editableID_Object){var customizedID=removeAllBlankSpaces(event.target.innerText);customizedID===editableID_Object.getCustomizedID()||isEmpty(customizedID)?restoreScreenID(event,editableID_Object):hasChanges(customizedID,editableID_Object)&&(_checkIfIsAvailable(customizedID)?(editableID_Object.updateCustomizedID(customizedID),UpdateQuestionEventFactory.create().execute(self),restoreScreenID(event,editableID_Object)):($mdToast.show($mdToast.simple().textContent("O ID inserido já está em uso.")),restoreScreenID(event,editableID_Object)))}function _checkIfIsAvailable(customizedID){return!!WorkspaceService.getSurvey().isAvailableCustomID(customizedID)}var self=this;self.isEmpty=isEmpty,self.removeAllBlankSpaces=removeAllBlankSpaces,self.restoreScreenID=restoreScreenID,self.hasChanges=hasChanges,self.execute=execute}angular.module("editor.ui").service("EditableCustomIDService",EditableCustomIDService),EditableCustomIDService.$inject=["WorkspaceService","UpdateQuestionEventFactory","$mdToast"]}(),function(){"use strict";function EditableID($element,EditableIDFactory,EditableCustomIDService){function onInit(){_editableID=EditableIDFactory.create(self.item),$element.children()[0].innerText=_editableID.getCustomizedID()}self=this;var _editableID;self.$onInit=onInit,$element.on("focusout",function(event){EditableCustomIDService.execute(event,_editableID)})}angular.module("editor.ui").component("editableId",{templateUrl:"app/editor/ui/base/editable-id/editable-id.html",controller:EditableID,bindings:{item:"<"}}),EditableID.$inject=["$element","EditableIDFactory","EditableCustomIDService"]}(),function(){"use strict";function EditableIDFactory(UpdateSurveyItemCustomID,WorkspaceService){function create(object){return new EditableIDComponent(object,UpdateSurveyItemCustomID,WorkspaceService)}var self=this;return self.create=create,self}function EditableIDComponent(object,UpdateSurveyItemCustomID,WorkspaceService){function getAutoGeneratedID(){return"CheckboxAnswerOption"===_object.objectType?_object.optionID:_object.templateID}function getCustomizedID(){return"CheckboxAnswerOption"===_object.objectType?_object.customOptionID:_object.customID}function getLastValidID(){return _lastValidID}function updateCustomizedID(customizedID){_lastValidID=customizedID,"CheckboxAnswerOption"===_object.objectType?_object.setCustomOptionID(customizedID):UpdateSurveyItemCustomID.execute(_object,customizedID,WorkspaceService.getSurvey())}var _lastValidID,self=this,_object=object;self.getCustomizedID=getCustomizedID,self.getAutoGeneratedID=getAutoGeneratedID,self.getLastValidID=getLastValidID,self.updateCustomizedID=updateCustomizedID}angular.module("editor.ui").factory("EditableIDFactory",EditableIDFactory),EditableIDFactory.$inject=["UpdateSurveyItemCustomID","WorkspaceService"]}(),function(){"use strict";function Controller($element,ExtractionValueService){function onInit(){_checkFunction=self.checkFunction,_option=self.option}function postLink(){$element.children()[0].innerText=_option.extractionValue,$element.on("focusout",_execute)}function _execute(event){ExtractionValueService.execute(event,_option,_checkFunction)}var _checkFunction,_option;self=this,self.$onInit=onInit,self.$postLink=postLink}angular.module("editor.ui").component("otusExtractionValue",{templateUrl:"app/editor/ui/base/extraction-value/extraction-value.html",controller:Controller,bindings:{option:"<",checkFunction:"&"}}),Controller.$inject=["$element","otusjs.studio.editor.ui.ExtractionValueService"]}(),function(){"use strict";function Service(UpdateQuestionEventFactory,$mdToast){function execute(event,option,checkFunction){var newValue=removeAllBlankSpaces(event.target.innerText);newValue===option.extractionValue.toString()||isEmpty(newValue)?updateView(event,option):hasChanges(newValue,option)&&(checkFunction({$event:{newValue:newValue}})?(option.setExtractionValue(newValue),UpdateQuestionEventFactory.create().execute(self),updateView(event,option)):($mdToast.show($mdToast.simple().textContent("O valor não pode ser repetido.")),updateView(event,option)))}function isEmpty(newValue){return""===newValue}function removeAllBlankSpaces(newValue){return newValue.replace(/\s/g,"")}function updateView(event,option){event.target.innerText=option.extractionValue}function hasChanges(newValue,option){return newValue!==option.extractionValue}var self=this;self.execute=execute}angular.module("editor.ui").service("otusjs.studio.editor.ui.ExtractionValueService",Service),Service.$inject=["UpdateQuestionEventFactory","$mdToast"]}(),function(){"use strict";function directive(OtusTextEditorWidgetFactory){return{scope:{placeholder:"@",label:"=",ariaLabel:"@",leftIcon:"@",ngModel:"="},templateUrl:"app/editor/ui/base/text-editor/text-editor.html",retrict:"E",link:function(scope,element){scope.widget=OtusTextEditorWidgetFactory.create(scope,element)}}}angular.module("editor.ui").directive("otusTextEditor",directive),directive.$inject=["OtusTextEditorWidgetFactory"]}(),function(){"use strict";function OtusTextEditorWidgetFactory(UpdateQuestionEventFactory){function create(scope,element){return new OtusTextEditorWidget(scope,element,UpdateQuestionEventFactory)}var self=this;return self.create=create,self}function OtusTextEditorWidget(scope,element,UpdateQuestionEventFactory){function getClassName(){return"OtusTextEditorWidget"}function getUUID(){return scope.uuid}function getLabel(){return self.ngModel.ptBR.formattedText}function getElement(){return element}function getParent(){return scope.$parent.widget}function getItem(){return getParent().getItem()}function _saveLabel(){self.ngModel.ptBR.formattedText=event.target.innerHTML,self.ngModel.ptBR.plainText=event.target.innerText}function _loadLabel(){self.getElement().children()[0].innerHTML=self.getLabel()}var self=this;self.input=angular.element(element.children()[0]),self.ngModel=scope.ngModel,self.placeholder=scope.placeholder,self.getClassName=getClassName,self.getUUID=getUUID,self.getElement=getElement,self.getParent=getParent,self.getItem=getItem,self.getLabel=getLabel,function(){self.ngModel&&_loadLabel()}(),element.on("focusout",function(event){_saveLabel(),UpdateQuestionEventFactory.create().execute(self)})}angular.module("editor.ui").factory("OtusTextEditorWidgetFactory",OtusTextEditorWidgetFactory),OtusTextEditorWidgetFactory.$inject=["UpdateQuestionEventFactory"]}(),function(){"use strict";function Controller(WorkspaceService){function onInit(){}function addOption(){self.metadata.createOption(),_save()}function removeLastOption(){self.metadata.removeLastOption(),_save()}function isAvailableExtractionValue($event){return self.metadata.isAvailableExtractionValue($event.newValue)}function _save(){WorkspaceService.saveWork()}var self=this;self.$onInit=onInit,self.addOption=addOption,self.removeLastOption=removeLastOption,self.isAvailableExtractionValue=isAvailableExtractionValue}angular.module("editor.ui").component("otusMetadataGroup",{templateUrl:"app/editor/ui/metadata/group/metadata-group-template.html",controller:Controller,bindings:{metadata:"<"}}),Controller.$inject=["WorkspaceService"]}(),function(){"use strict";function Controller(AddFillingRulesEventFactory,RemoveFillingRulesEventFactory,UpdateFillingRulesEventFactory){function onInit(){self.item.isQuestion()&&(void 0==self.item.fillingRules.options.accept?self.data=!1:(self.data=self.item.fillingRules.options.accept.data.reference,updateData()))}function updateData(){self.data?(AddFillingRulesEventFactory.create().execute(self.item,whoAmI),_getRuleType().data.reference=self.data,UpdateFillingRulesEventFactory.create().execute()):RemoveFillingRulesEventFactory.create().execute(self,whoAmI)}function _getRuleType(){return self.item.fillingRules.options.accept}function getItem(){return self.item}var self=this,whoAmI="accept";self.data,self.$onInit=onInit,self.updateData=updateData,self.getItem=getItem}angular.module("editor.ui").component("otusAcceptAnswer",{templateUrl:"app/editor/ui/rule/accept-answer/accept-answer.html",controller:Controller,bindings:{item:"<"}}),Controller.$inject=["AddFillingRulesEventFactory","RemoveFillingRulesEventFactory","UpdateFillingRulesEventFactory"]}(),function(){"use strict";function Controller(SurveyItemMapFactory){function getTemplate(){return SurveyItemMapFactory[self.item.objectType]}var self=this;self.getTemplate=getTemplate}angular.module("editor.ui").component("miscItem",{templateUrl:"app/editor/ui/survey-item/misc/misc-item-template.html",controller:Controller,bindings:{item:"<"}}),Controller.$inject=["SurveyItemMapFactory"]}(),function(){"use strict";function Controller(SurveyItemMapFactory){function onInit(){}function getTemplate(){return SurveyItemMapFactory[self.item.objectType]}var self=this;self.$onInit=onInit,self.getTemplate=getTemplate}angular.module("editor.ui").component("otusQuestionItem",{templateUrl:"app/editor/ui/survey-item/question/question-template.html",controller:Controller,bindings:{item:"<"}}),Controller.$inject=["SurveyItemMapFactory"]}(),function(){"use strict";function otusItemIcon(){return{scope:{item:"@item"},templateUrl:"app/editor/ui/survey-item-editor/item-icon/otus-item-icon-template.html",retrict:"E",link:function(scope,element,attrs){scope.type=getItemIcon(scope.item)}}}function getItemIcon(objectType){return{CalendarQuestion:{icon:"date_range",tooltip:"Data"},IntegerQuestion:{icon:"looks_one",tooltip:"Número Inteiro"},DecimalQuestion:{icon:"exposure_zero",tooltip:"Número Decimal"},SingleSelectionQuestion:{icon:"radio_button_checked",tooltip:"Seleção Única"},CheckboxQuestion:{icon:"check_box",tooltip:"Checkbox"},TextQuestion:{icon:"text_format",tooltip:"Texto"},EmailQuestion:{icon:"email",tooltip:"Email"},TimeQuestion:{icon:"access_time",tooltip:"Hora"},PhoneQuestion:{icon:"phone",tooltip:"Telefone"},AutocompleteQuestion:{icon:"youtube_searched_for",tooltip:"Autocompletar"},FileUploadQuestion:{icon:"attach_file",tooltip:"Upload de Arquivo"},GridTextQuestion:{icon:"filter_none",tooltip:"Questão Grade de Texto"},GridIntegerQuestion:{icon:"filter_1",tooltip:"Questão Grade de Número"},TextItem:{icon:"message",tooltip:"Texto"},ImageItem:{icon:"image",tooltip:"Imagem"}}[objectType]}angular.module("editor.ui").directive("otusItemIcon",otusItemIcon),otusItemIcon.$inject=[]}(),function(){"use strict";function Controller($scope,$element,SurveyItemSettingsWidgetFactory,UUIDService){var self=this;self.$onInit=function(){$scope.uuid=UUIDService.generateUUID(),$scope.widget=SurveyItemSettingsWidgetFactory.create($scope,$element,self.item)}}angular.module("editor.ui").component("otusSurveyItemSettings",{templateUrl:"app/editor/ui/survey-item-editor/survey-item-settings/survey-item-settings.html",controller:Controller,bindings:{item:"<"}}),Controller.$inject=["$scope","$element","SurveyItemSettingsWidgetFactory","UUIDService"]}(),function(){"use strict";function SurveyItemSettingsWidgetFactory(){function create(scope,element,item){return new SurveyItemSettingsWidget(scope,element,item)}var self=this;return self.create=create,self}function SurveyItemSettingsWidget(scope,element,item){function getUUID(){return scope.uuid}function getElement(){return element}function getParent(){return scope.$parent.$parent.$parent.widget}function getItem(){return item}function validationButton(){self.ngClass.open=!self.ngClass.open,self.showValidationEditor=!self.showValidationEditor}var self=this;self.className="SurveyItemSettingsWidget",self.ngClass={},self.ngClass.open=!1,self.showNavigationEditor=!1,self.showValidationEditor=!1,self.getUUID=getUUID,self.getElement=getElement,self.getParent=getParent,self.getItem=getItem,self.validationButton=validationButton}angular.module("editor.ui").factory("SurveyItemSettingsWidgetFactory",SurveyItemSettingsWidgetFactory)}(),function(){"use strict";function otusFillingRulesEditor(FillingRulesEditorWidgetFactory){return{scope:{},restrict:"E",templateUrl:"app/editor/ui/validation/editor/validation-editor.html",link:function(scope,element){scope.widget=FillingRulesEditorWidgetFactory.create(scope,element)}}}angular.module("editor.ui").directive("otusFillingRulesEditor",otusFillingRulesEditor),otusFillingRulesEditor.$inject=["FillingRulesEditorWidgetFactory"]}(),function(){"use strict";function FillingRulesEditorWidgetFactory(AddFillingRulesEventFactory,RemoveFillingRulesEventFactory,OtusFillingRulesWidgetFactory,$compile,UpdateFillingRulesEventFactory){function create(scope,element){return new FillingRulesEditorWidget(scope,element,AddFillingRulesEventFactory,RemoveFillingRulesEventFactory,OtusFillingRulesWidgetFactory,$compile,UpdateFillingRulesEventFactory)}var self=this;return self.create=create,self}function FillingRulesEditorWidget(scope,element,AddFillingRulesEventFactory,RemoveFillingRulesEventFactory,OtusFillingRulesWidgetFactory,$compile,UpdateFillingRulesEventFactory){function showListFeeder(){return getItem().validators()}function getElement(){return element}function getParent(){return scope.$parent.widget}function getItem(){return getParent().getItem()}function _loadOptions(){Object.keys(self.getItem().fillingRules.options).forEach(function(validatorToLoad){appendFillingRules(validatorToLoad)}),void 0===self.getItem().fillingRules.options.mandatory&&addValidator("mandatory")}function addValidator(validator){AddFillingRulesEventFactory.create().execute(getItem(),validator),appendFillingRules(validator)}function appendFillingRules(validator){var template=OtusFillingRulesWidgetFactory.create(validator),validatorsColumn=element.find("#validators-column"),validatorTemplate=$compile(template)(scope);validatorsColumn.append(validatorTemplate),_removeOfShowList(validator)}function _removeOfShowList(validator){"accept"!==validator&&"mandatory"!==validator&&showList.splice(showList.indexOf(validator),1)}function deleteValidator(validator){showList.push(validator),RemoveFillingRulesEventFactory.create().execute(self,validator)}function updateFillingRules(){UpdateFillingRulesEventFactory.create().execute()}function checkIfShow(fillingRule){return showList.indexOf(fillingRule)>-1}function menuDisabler(){return!(showList.length>0)}var showList,self=this;self.ngModel=scope.ngModel,self.getElement=getElement,self.getParent=getParent,self.getItem=getItem,self.addValidator=addValidator,self.checkIfShow=checkIfShow,self.deleteValidator=deleteValidator,self.updateFillingRules=updateFillingRules,self.menuDisabler=menuDisabler,function(){showList=showListFeeder(),_loadOptions()}()}angular.module("editor.ui").factory("FillingRulesEditorWidgetFactory",FillingRulesEditorWidgetFactory),FillingRulesEditorWidgetFactory.$inject=["AddFillingRulesEventFactory","RemoveFillingRulesEventFactory","OtusFillingRulesWidgetFactory","$compile","UpdateFillingRulesEventFactory"]}(),function(){"use strict";function service($mdDialog){function showDialog(message){_dialogSettings.locals={message:message},$mdDialog.show(_dialogSettings)}var self=this,_dialogSettings={};!function(){_dialogSettings.templateUrl="app/navigation-builder/messenger/dialog/text/text-dialog-template.html",_dialogSettings.controller=DialogController,_dialogSettings.controllerAs="ctrl",_dialogSettings.escapeToClose=!1,_dialogSettings.fullscreen=!1,_dialogSettings.hasBackdrop=!1}(),self.showDialog=showDialog}function DialogController($mdDialog,message){function cancel(response){$mdDialog.hide(response)}function confirm(response){$mdDialog.hide(response)}var self=this;self.message=message,self.cancel=cancel,self.confirm=confirm}angular.module("otusjs.studio.navigationBuilder").service("otusjs.studio.navigationBuilder.TextDialogService",service),service.$inject=["$mdDialog"]}(),function(){"use strict";function service($mdPanel){function showDialog(message){_dialogSettings.locals={message:message},_panelRef=$mdPanel.create(_dialogSettings),_panelRef.open().finally(function(){_panelRef=void 0})}var self=this,_dialogSettings={},_panelRef=null;!function(){var panelPosition=$mdPanel.newPanelPosition().absolute().center();_dialogSettings.attachTo=angular.element(document.body),_dialogSettings.controller=DialogController,_dialogSettings.controllerAs="ctrl",_dialogSettings.position=panelPosition,_dialogSettings.templateUrl="app/navigation-builder/messenger/dialog/text/text-panel-template.html"}(),self.showDialog=showDialog}function DialogController(message){function cancel(response){$mdDialog.hide(response)}function confirm(response){$mdDialog.hide(response)}var self=this;self.message=message,self.cancel=cancel,self.confirm=confirm}angular.module("otusjs.studio.navigationBuilder").service("otusjs.studio.navigationBuilder.TextPanelService",service),service.$inject=["$mdPanel"]}(),function(){"use strict";angular.module("editor.ui").component("imageItem",{templateUrl:"app/editor/ui/survey-item/misc/image/image-item-template.html",bindings:{item:"<"}})}(),function(){"use strict";angular.module("editor.ui").component("textItem",{templateUrl:"app/editor/ui/survey-item/misc/text/text-item-template.html",bindings:{item:"<"}})}(),function(){"use strict";function Controller(AddDataSourceEventFactory,RemoveDataSourceEventFactory,$q){function onInit(){self.autoCompleteSettings={selectedItem:null,searchText:""}}function addDataSource(dataSourceName){AddDataSourceEventFactory.create().execute(self.item,dataSourceName)}function removeDataSource(dataSourceName){RemoveDataSourceEventFactory.create().execute(self.item,dataSourceName)}function dummyQuery(typedText){var deferred=$q.defer();return deferred.resolve(_stateList),deferred.promise}var self=this;self.$onInit=onInit,self.addDataSource=addDataSource,self.removeDataSource=removeDataSource,self.dummyQuery=dummyQuery;var _stateList=["Acre","Alagoas","Amapá","Amazonas","Bahia","Ceará","Distrito Federal","Espírito Santo","Goiás","Maranhão","Mato Grosso","Mato Grosso do Sul","Minas Gerais","Pará","Paraíba","Paraná","Pernambuco","Piauí","Rio de Janeiro","Rio Grande do Norte","Rio Grande do Sul","Rondônia","Roraima","Santa Catarina ","São Paulo","Sergipe","Aracaju ","Tocantins"]}angular.module("editor.ui").component("autocompleteQuestion",{templateUrl:"app/editor/ui/survey-item/question/autocomplete/autocomplete-question-template.html",controller:Controller,bindings:{item:"<"}}),Controller.$inject=["AddDataSourceEventFactory","RemoveDataSourceEventFactory","$q"]}(),function(){"use strict";angular.module("editor.ui").component("calendarQuestion",{templateUrl:"app/editor/ui/survey-item/question/calendar/calendar-question-template.html"})}(),function(){"use strict";function Controller(WorkspaceService,AlphabetSuffixIDGenerator){function onInit(){}function addOption(){self.item.createOption(_generateOptionId()),_save()}function removeLastOption(){self.item.removeLastOption(),_save()}function _save(){WorkspaceService.saveWork()}function _generateOptionId(){var checkboxID,quantity=self.item.options.length;do{checkboxID=self.item.customID+AlphabetSuffixIDGenerator.generateSuffixByOptionsLength(quantity++)}while(!WorkspaceService.getSurvey().isAvailableCustomID(checkboxID));return checkboxID}var self=this;self.$onInit=onInit,self.addOption=addOption,self.removeLastOption=removeLastOption}angular.module("editor.ui").component("checkboxQuestion",{templateUrl:"app/editor/ui/survey-item/question/checkbox/checkbox-question-template.html",controller:Controller,bindings:{item:"<"}}),Controller.$inject=["WorkspaceService","otusjs.model.utils.AlphabetSuffixIDGenerator"]}(),function(){"use strict";angular.module("editor.ui").component("decimalQuestion",{templateUrl:"app/editor/ui/survey-item/question/decimal/decimal-question-template.html",bindings:{item:"<"}})}(),function(){"use strict";angular.module("editor.ui").directive("uiDecimal",function(){return{link:function($scope,element,attrs,ngModelCtrl){function shouldPrintChar(event){var keycode=(angular.element(event.currentTarget),event.which);return isNumberKey(keycode)||isValidKey(keycode)}function formatedInteger(event){var element=angular.element(event.currentTarget),keycode=event.which;0===element.val().length?lastValidValue="":isNumberKey(keycode)||isValidKey(keycode)?lastValidValue=element.val():isValidKey(keycode)||element.val(lastValidValue)}function isNumberKey(keycode){return keycode>=48&&keycode<=57||keycode>=96&&keycode<=105}function isValidKey(keycode){var minusKey=109===keycode,commaKey=188===keycode,dotKey=190===keycode,numpadDot=194===keycode,decimalPoint=110===keycode,shiftKey=16===keycode,backspaceKey=8===keycode,homeKey=36===keycode,endKey=35===keycode,deleteKey=46===keycode,controlKey=17===keycode,leftKey=37===keycode,rightKey=39===keycode;return minusKey||commaKey||dotKey||numpadDot||decimalPoint||shiftKey||backspaceKey||homeKey||endKey||deleteKey||controlKey||leftKey||rightKey}var lastValidValue;element.on("keydown",shouldPrintChar),element.on("keyup",formatedInteger)}}})}(),function(){"use strict";angular.module("editor.ui").component("emailQuestion",{templateUrl:"app/editor/ui/survey-item/question/email/email-question-template.html"})}(),function(){"use strict";function directive(FileUploadQuestionWidgetFactory){return{scope:{},templateUrl:"app/editor/ui/survey-item/question/fileUpload/file-upload-question.html",retrict:"E",link:function(scope,element){scope.widget=FileUploadQuestionWidgetFactory.create(scope,element),_chooseFile(scope,element)}}}function _chooseFile(scope,element){scope.fileName="Selecione o arquivo utilizando o botão para realizar o upload";var button=angular.element(element[0].querySelector("button#uploadButton")),input=angular.element(element[0].querySelector("input#fileInput"));input.length&&button.length&&button.bind("click",function(){input[0].click()}),input.bind("change",function(e){scope.$apply(function(){var files=e.target.files;files[0]?scope.fileName=files[0].name:scope.fileName=null})})}angular.module("editor.ui").directive("fileUploadQuestion",directive)}(),function(){"use strict";function FileUploadQuestionWidgetFactory(AddFileUploadEventFactory,RemoveFileUploadEventFactory,$q){function create(scope,element){return new FileUploadQuestionWidget(scope,element,AddFileUploadEventFactory,RemoveFileUploadEventFactory,$q)}var self=this;return self.create=create,self}function FileUploadQuestionWidget(scope,element,AddFileUploadEventFactory,RemoveFileUploadEventFactory,$q){function getClassName(){return"FileUploadQuestionWidget"}function getUUID(){return scope.uuid}function getElement(){return element}function getParent(){return scope.$parent.widget}function getItem(){return getParent().getItem()}function getTemplate(){return"<file-upload-question></file-upload-question>"}var self=this;self.fileName="Selecione o arquivo utilizando o botão para realizar o upload",self.getClassName=getClassName,self.getUUID=getUUID,self.getElement=getElement,self.getParent=getParent,self.getItem=getItem,self.getTemplate=getTemplate}angular.module("editor.ui").factory("FileUploadQuestionWidgetFactory",FileUploadQuestionWidgetFactory),FileUploadQuestionWidgetFactory.$inject=["AddFileUploadEventFactory","RemoveFileUploadEventFactory","$q"]}(),function(){"use strict";function Controller($scope,$element,UpdateQuestionEventFactory){function onInit(){}function addGridLine(){self.item.createLine(),self.save()}function removeGridLine(gridLineIndex){self.item.removeLine(gridLineIndex),self.save()}function save(){UpdateQuestionEventFactory.create().execute(self)}var self=this;self.$onInit=onInit,self.addGridLine=addGridLine,self.removeGridLine=removeGridLine,self.save=save}angular.module("editor.ui").component("gridIntegerQuestion",{controller:Controller,templateUrl:"app/editor/ui/survey-item/question/grid-integer-question/grid-integer-question-template.html",bindings:{item:"<"}}),Controller.$inject=["$scope","$element","UpdateQuestionEventFactory"]}(),function(){"use strict";function Controller($scope,$element,UpdateQuestionEventFactory){function onInit(){}function addGridLine(){self.item.createLine(),self.save()}function removeGridLine(gridLineIndex){self.item.removeLine(gridLineIndex),self.save()}function save(){UpdateQuestionEventFactory.create().execute(self)}var self=this;self.$onInit=onInit,self.addGridLine=addGridLine,self.removeGridLine=removeGridLine,self.save=save}angular.module("editor.ui").component("gridTextQuestion",{controller:Controller,templateUrl:"app/editor/ui/survey-item/question/grid-text-question/grid-text-question-template.html",bindings:{item:"<"}}),Controller.$inject=["$scope","$element","UpdateQuestionEventFactory"]}(),function(){"use strict"
;angular.module("editor.ui").component("integerQuestion",{templateUrl:"app/editor/ui/survey-item/question/integer/integer-question-template.html",bindings:{item:"<"}})}(),function(){"use strict";angular.module("editor.ui").directive("uiInteger",function(){return{link:function($scope,element,attrs,ngModelCtrl){function shouldPrintChar(event){var keycode=(angular.element(event.currentTarget),event.which);return isNumberKey(keycode)||isValidKey(keycode)}function formatedInteger(event){var element=angular.element(event.currentTarget),keycode=event.which;0===element.val().length?lastValidValue="":isNumberKey(keycode)||isValidKey(keycode)?lastValidValue=element.val():isValidKey(keycode)||element.val(lastValidValue)}function isNumberKey(keycode){return keycode>=48&&keycode<=57||keycode>=96&&keycode<=105}function isValidKey(keycode){var minusKey=109===keycode,shiftKey=16===keycode,backspaceKey=8===keycode,homeKey=36===keycode,endKey=35===keycode,deleteKey=46===keycode,controlKey=17===keycode,leftKey=37===keycode,rightKey=39===keycode;return minusKey||shiftKey||backspaceKey||homeKey||endKey||deleteKey||controlKey||leftKey||rightKey}var lastValidValue;element.on("keydown",shouldPrintChar),element.on("keyup",formatedInteger)}}})}(),function(){"use strict";angular.module("editor.ui").component("phoneQuestion",{templateUrl:"app/editor/ui/survey-item/question/phone/phone-question-template.html"})}(),function(){"use strict";function Controller(WorkspaceService){function onInit(){}function addOption(){self.item.createOption(),_save()}function removeLastOption(){self.item.removeLastOption(),_save()}function isAvailableExtractionValue($event){return self.item.isAvailableExtractionValue($event.newValue)}function _save(){WorkspaceService.saveWork()}var self=this;self.$onInit=onInit,self.addOption=addOption,self.removeLastOption=removeLastOption,self.isAvailableExtractionValue=isAvailableExtractionValue}angular.module("editor.ui").component("singleSelectionQuestion",{templateUrl:"app/editor/ui/survey-item/question/single-selection/single-selection-question-template.html",controller:Controller,bindings:{item:"<"}}),Controller.$inject=["WorkspaceService"]}(),function(){"use strict";angular.module("editor.ui").component("textQuestion",{templateUrl:"app/editor/ui/survey-item/question/text/text-question-template.html"})}(),function(){"use strict";angular.module("editor.ui").component("timeQuestion",{controller:"TimeQuestionController as $ctrl",templateUrl:"app/editor/ui/survey-item/question/time/time-question-template.html",bindings:{item:"<"}})}(),function(){"use strict";function Controller(AddOptionItemEventFactory,UpdateOptionItemEventFactory,RemoveOptionItemEventFactory){function onInit(){self.item=self.getItem(),self.button=!0,self.disabledButton="disabledButton",self.item.isQuestion()&&(void 0==self.item.options?self.questionOptions=!1:(self.questionOptions=self.item.options,self.button=getDisabledButton(),self.button||updateOption(self.disabledButton,!self.button)))}function updateOption(name,value){self.button?RemoveOptionItemEventFactory.create().execute(self.item,name):(AddOptionItemEventFactory.create().execute(self.item,name,value),getItem().options.data=self.questionOptions.data,UpdateOptionItemEventFactory.create().execute())}function getItem(){return self.item}function getDisabledButton(){if(void 0!==self.item.options)return void 0===self.item.options.data.disabledButton}var self=this;self.$onInit=onInit,self.updateOption=updateOption,self.getItem=getItem,self.getDisabledButton=getDisabledButton}angular.module("editor.ui").controller("TimeQuestionController",Controller),Controller.$inject=["AddOptionItemEventFactory","UpdateOptionItemEventFactory","RemoveOptionItemEventFactory"]}(),function(){"use strict";function otusAlphanumericValidator(AlphanumericValidatorWidgetFactory){return{scope:{},restrict:"E",templateUrl:"app/editor/ui/validation/require/alphanumeric/alphanumeric-validator.html",link:function(scope,element){scope.widget=AlphanumericValidatorWidgetFactory.create(scope,element)}}}angular.module("editor.ui").directive("otusAlphanumericValidator",otusAlphanumericValidator),otusAlphanumericValidator.$inject=["AlphanumericValidatorWidgetFactory"]}(),function(){"use strict";function AlphanumericValidatorWidgetFactory(){function create(scope,element){return new AlphanumericValidator(scope,element)}var self=this;return self.create=create,self}function AlphanumericValidator(scope,element){function updateData(){getRuleType().data.reference=self.data,scope.$parent.widget.updateFillingRules()}function getRuleType(){return parent.fillingRules.options[whoAmI]}function deleteValidator(){scope.$parent.widget.deleteValidator(whoAmI),element.remove(),scope.$destroy()}var self=this,whoAmI="alphanumeric";self.data=!0,self.updateData=updateData,self.deleteValidator=deleteValidator;var parent=scope.$parent.widget.getItem();!function(){var avaiableRules=parent.fillingRules.options;avaiableRules.hasOwnProperty(whoAmI)&&(self.data=avaiableRules[whoAmI].data.reference,self.canBeIgnored=avaiableRules[whoAmI].data.canBeIgnored)}()}angular.module("editor.ui").factory("AlphanumericValidatorWidgetFactory",AlphanumericValidatorWidgetFactory)}(),function(){"use strict";function otusDistinctValidator(DistinctValidatorWidgetFactory){return{scope:{},restrict:"E",templateUrl:"app/editor/ui/validation/require/distinct/distinct-validator.html",link:function(scope,element){scope.widget=DistinctValidatorWidgetFactory.create(scope,element)}}}angular.module("editor.ui").directive("otusDistinctValidator",otusDistinctValidator),otusDistinctValidator.$inject=["DistinctValidatorWidgetFactory"]}(),function(){"use strict";function DistinctValidatorWidgetFactory(){function create(scope,element){return new DistinctValidator(scope,element)}var self=this;return self.create=create,self}function DistinctValidator(scope,element){function updateData(){getRuleType().data.reference=self.data,scope.$parent.widget.updateFillingRules()}function getRuleType(){return question.fillingRules.options[whoAmI]}function deleteValidator(){scope.$parent.widget.deleteValidator(whoAmI),element.remove(),scope.$destroy()}var self=this,whoAmI="distinct";self.data,self.updateData=updateData,self.deleteValidator=deleteValidator;var question=scope.$parent.widget.getItem();!function(){self.data=question.fillingRules.options[whoAmI].data.reference,self.canBeIgnored=question.fillingRules.options[whoAmI].data.canBeIgnored}()}angular.module("editor.ui").factory("DistinctValidatorWidgetFactory",DistinctValidatorWidgetFactory)}(),function(){"use strict";function otusFutureDateValidator(FutureDateValidatorWidgetFactory){return{scope:{},restrict:"E",templateUrl:"app/editor/ui/validation/require/future-date/future-date-validator.html",link:function(scope,element){scope.widget=FutureDateValidatorWidgetFactory.create(scope,element)}}}angular.module("editor.ui").directive("otusFutureDateValidator",otusFutureDateValidator),otusFutureDateValidator.$inject=["FutureDateValidatorWidgetFactory"]}(),function(){"use strict";function FutureDateValidatorWidgetFactory(){function create(scope,element){return new FutureDateValidator(scope,element)}var self=this;return self.create=create,self}function FutureDateValidator(scope,element){function updateData(){getRuleType().data.reference=self.data,scope.$parent.widget.updateFillingRules()}function getRuleType(){return question.fillingRules.options[whoAmI]}function deleteValidator(){scope.$parent.widget.deleteValidator(whoAmI),element.remove(),scope.$destroy()}var self=this,whoAmI="futureDate";self.updateData=updateData,self.deleteValidator=deleteValidator;var question=scope.$parent.widget.getItem();!function(){question.fillingRules.options.hasOwnProperty(whoAmI)&&(self.data=question.fillingRules.options[whoAmI].data.reference,self.canBeIgnored=question.fillingRules.options[whoAmI].data.canBeIgnored,self.updateData())}()}angular.module("editor.ui").factory("FutureDateValidatorWidgetFactory",FutureDateValidatorWidgetFactory)}(),function(){"use strict";function otusInValidator(InValidatorWidgetFactory){return{scope:{},restrict:"E",templateUrl:"app/editor/ui/validation/require/in/in-validator.html",link:function(scope,element){scope.widget=InValidatorWidgetFactory.create(scope,element)}}}angular.module("editor.ui").directive("otusInValidator",otusInValidator),otusInValidator.$inject=["InValidatorWidgetFactory"]}(),function(){"use strict";function InValidatorWidgetFactory(){function create(scope,element){return new InValidator(scope,element)}var self=this;return self.create=create,self}function InValidator(scope,element){function updateData(){getRuleType().data.reference=self.data,scope.$parent.widget.updateFillingRules()}function getRuleType(){return question.fillingRules.options[whoAmI]}function deleteValidator(){scope.$parent.widget.deleteValidator(whoAmI),element.remove(),scope.$destroy()}var self=this,whoAmI="in";self.data={initial:null,end:null},self.updateData=updateData,self.deleteValidator=deleteValidator;var question=scope.$parent.widget.getItem();!function(){self.data=question.fillingRules.options[whoAmI].data.reference,self.canBeIgnored=question.fillingRules.options[whoAmI].data.canBeIgnored}()}angular.module("editor.ui").factory("InValidatorWidgetFactory",InValidatorWidgetFactory)}(),function(){"use strict";function otusLowerCaseValidator(LowerCaseValidatorWidgetFactory){return{scope:{},restrict:"E",templateUrl:"app/editor/ui/validation/require/lower-case/lower-case-validator.html",link:function(scope,element){scope.widget=LowerCaseValidatorWidgetFactory.create(scope,element)}}}angular.module("editor.ui").directive("otusLowerCaseValidator",otusLowerCaseValidator),otusLowerCaseValidator.$inject=["LowerCaseValidatorWidgetFactory"]}(),function(){"use strict";function LowerCaseValidatorWidgetFactory(){function create(scope,element){return new LowerCaseValidator(scope,element)}var self=this;return self.create=create,self}function LowerCaseValidator(scope,element){function updateData(){getRuleType().data.reference=self.data,scope.$parent.widget.updateFillingRules()}function getRuleType(){return question.fillingRules.options[whoAmI]}function deleteValidator(){scope.$parent.widget.deleteValidator(whoAmI),element.remove(),scope.$destroy()}var self=this,whoAmI="lowerCase";self.data=!0,self.updateData=updateData,self.deleteValidator=deleteValidator;var question=scope.$parent.widget.getItem();!function(){self.data=question.fillingRules.options[whoAmI].data.reference,self.canBeIgnored=question.fillingRules.options[whoAmI].data.canBeIgnored}()}angular.module("editor.ui").factory("LowerCaseValidatorWidgetFactory",LowerCaseValidatorWidgetFactory)}(),function(){"use strict";function otusLowerLimitValidator(LowerLimitValidatorWidgetFactory){return{scope:{},restrict:"E",templateUrl:"app/editor/ui/validation/require/lower-limit/lower-limit-validator.html",link:function(scope,element){scope.widget=LowerLimitValidatorWidgetFactory.create(scope,element)}}}angular.module("editor.ui").directive("otusLowerLimitValidator",otusLowerLimitValidator),otusLowerLimitValidator.$inject=["LowerLimitValidatorWidgetFactory"]}(),function(){"use strict";function LowerLimitValidatorWidgetFactory(){function create(scope,element){return new LowerLimitValidator(scope,element)}var self=this;return self.create=create,self}function LowerLimitValidator(scope,element){function updateData(){getRuleType().data.reference=self.data,getRuleType().data.canBeIgnored=self.canBeIgnored,scope.$parent.widget.updateFillingRules()}function getRuleType(){return question.fillingRules.options[whoAmI]}function deleteValidator(){scope.$parent.widget.deleteValidator(whoAmI),element.remove(),scope.$destroy()}var self=this,whoAmI="lowerLimit";self.data=null,self.canBeIgnored=null,self.updateData=updateData,self.deleteValidator=deleteValidator;var question=scope.$parent.widget.getItem();!function(){self.data=question.fillingRules.options[whoAmI].data.reference,self.canBeIgnored=question.fillingRules.options[whoAmI].data.canBeIgnored}()}angular.module("editor.ui").factory("LowerLimitValidatorWidgetFactory",LowerLimitValidatorWidgetFactory)}(),function(){"use strict";function otusMandatoryValidator(MandatoryValidatorWidgetFactory){return{scope:{},restrict:"E",templateUrl:"app/editor/ui/validation/require/mandatory/mandatory-validator.html",link:function(scope,element){scope.widget=MandatoryValidatorWidgetFactory.create(scope,element)}}}angular.module("editor.ui").directive("otusMandatoryValidator",otusMandatoryValidator),otusMandatoryValidator.$inject=["MandatoryValidatorWidgetFactory"]}(),function(){"use strict";function MandatoryValidatorWidgetFactory(){function create(scope,element){return new MandatoryValidator(scope,element)}var self=this;return self.create=create,self}function MandatoryValidator(scope,element){function updateData(){getRuleType().data.reference=self.data,scope.$parent.widget.updateFillingRules()}function getRuleType(){return question.fillingRules.options[whoAmI]}var self=this,whoAmI="mandatory";self.data,self.updateData=updateData;var question=scope.$parent.widget.getItem();!function(){self.data=question.fillingRules.options[whoAmI].data.reference,self.canBeIgnored=question.fillingRules.options[whoAmI].data.canBeIgnored}()}angular.module("editor.ui").factory("MandatoryValidatorWidgetFactory",MandatoryValidatorWidgetFactory)}(),function(){"use strict";function otusMaxDateValidator(MaxDateValidatorWidgetFactory){return{scope:{},restrict:"E",templateUrl:"app/editor/ui/validation/require/max-date/max-date-validator.html",link:function(scope,element){scope.widget=MaxDateValidatorWidgetFactory.create(scope,element)}}}angular.module("editor.ui").directive("otusMaxDateValidator",otusMaxDateValidator),otusMaxDateValidator.$inject=["MaxDateValidatorWidgetFactory"]}(),function(){"use strict";function MaxDateValidatorWidgetFactory(ImmutableDate){function create(scope,element){return new MaxDateValidator(scope,element,ImmutableDate)}var self=this;return self.create=create,self}function MaxDateValidator(scope,element,ImmutableDate){function updateData(){getRuleType().data.reference=self.data.toJSON(),scope.$parent.widget.updateFillingRules()}function getRuleType(){return question.fillingRules.options[whoAmI]}function deleteValidator(){scope.$parent.widget.deleteValidator(whoAmI),element.remove(),scope.$destroy()}var self=this,whoAmI="maxDate";self.data="",self.updateData=updateData,self.deleteValidator=deleteValidator;var question=scope.$parent.widget.getItem();!function(){self.data=new ImmutableDate(question.fillingRules.options[whoAmI].data.reference.value),self.canBeIgnored=question.fillingRules.options[whoAmI].data.canBeIgnored,updateData()}()}angular.module("editor.ui").factory("MaxDateValidatorWidgetFactory",MaxDateValidatorWidgetFactory),MaxDateValidatorWidgetFactory.$inject=["otusjs.utils.ImmutableDate"]}(),function(){"use strict";function otusMaxLengthValidator(MaxLengthValidatorWidgetFactory){return{scope:{},restrict:"E",templateUrl:"app/editor/ui/validation/require/max-length/max-length-validator.html",link:function(scope,element){scope.widget=MaxLengthValidatorWidgetFactory.create(scope,element)}}}angular.module("editor.ui").directive("otusMaxLengthValidator",otusMaxLengthValidator),otusMaxLengthValidator.$inject=["MaxLengthValidatorWidgetFactory"]}(),function(){"use strict";function MaxLengthValidatorWidgetFactory(){function create(scope,element){return new MaxLengthValidator(scope,element)}var self=this;return self.create=create,self}function MaxLengthValidator(scope,element){function updateData(){getRuleType().data.reference=self.data,scope.$parent.widget.updateFillingRules()}function getRuleType(){return question.fillingRules.options[whoAmI]}function deleteValidator(){scope.$parent.widget.deleteValidator(whoAmI),element.remove(),scope.$destroy()}var self=this,whoAmI="maxLength";self.data=null,self.updateData=updateData,self.deleteValidator=deleteValidator;var question=scope.$parent.widget.getItem();!function(){self.data=question.fillingRules.options[whoAmI].data.reference,self.canBeIgnored=question.fillingRules.options[whoAmI].data.canBeIgnored}()}angular.module("editor.ui").factory("MaxLengthValidatorWidgetFactory",MaxLengthValidatorWidgetFactory)}(),function(){"use strict";function Directive(MaxSelectedValidatorWidgetFactory){return{scope:{},restrict:"E",templateUrl:"app/editor/ui/validation/require/max-selected/max-selected-validator.html",link:function(scope,element){scope.widget=MaxSelectedValidatorWidgetFactory.create(scope,element)}}}angular.module("editor.ui").directive("otusMaxSelectedValidator",Directive),Directive.$inject=["otusjs.studio.editor.ui.validation.MaxSelectedValidatorWidgetFactory"]}(),function(){"use strict";function Factory(){function create(scope,element){return new MaxSelectedValidator(scope,element)}var self=this;return self.create=create,self}function MaxSelectedValidator(scope,element){function updateData(){getRuleType().data.reference=self.data,scope.$parent.widget.updateFillingRules()}function getRuleType(){return question.fillingRules.options[whoAmI]}function deleteValidator(){scope.$parent.widget.deleteValidator(whoAmI),element.remove(),scope.$destroy()}var self=this,whoAmI="maxSelected";self.data=null,self.updateData=updateData,self.deleteValidator=deleteValidator;var question=scope.$parent.widget.getItem();!function(){self.data=question.fillingRules.options[whoAmI].data.reference,self.canBeIgnored=question.fillingRules.options[whoAmI].data.canBeIgnored}()}angular.module("editor.ui").factory("otusjs.studio.editor.ui.validation.MaxSelectedValidatorWidgetFactory",Factory)}(),function(){"use strict";function otusMaxTimeValidator(MaxTimeValidatorWidgetFactory){return{scope:{},restrict:"E",templateUrl:"app/editor/ui/validation/require/max-time/max-time-validator.html",link:function(scope,element){scope.widget=MaxTimeValidatorWidgetFactory.create(scope,element)}}}angular.module("editor.ui").directive("otusMaxTimeValidator",otusMaxTimeValidator),otusMaxTimeValidator.$inject=["MaxTimeValidatorWidgetFactory"]}(),function(){"use strict";function MaxTimeValidatorWidgetFactory(ImmutableDate){function create(scope,element){return new MaxTimeValidator(scope,element,ImmutableDate)}var self=this;return self.create=create,self}function MaxTimeValidator(scope,element,ImmutableDate){function updateData(){self.data&&(getRuleType().data.reference=self.data.toJSON(),scope.$parent.widget.updateFillingRules())}function getRuleType(){return question.fillingRules.options[whoAmI]}function deleteValidator(){scope.$parent.widget.deleteValidator(whoAmI),element.remove(),scope.$destroy()}var self=this,whoAmI="maxTime";self.data="",self.updateData=updateData,self.deleteValidator=deleteValidator;var question=scope.$parent.widget.getItem();!function(){var referenceValue=question.fillingRules.options[whoAmI].data.reference.value;self.canBeIgnored=question.fillingRules.options[whoAmI].data.canBeIgnored,""!==referenceValue?self.data=new ImmutableDate(referenceValue):(self.data=new ImmutableDate,self.data.resetTime(),self.data.setHours(1)),self.data.resetDate(),self.updateData()}()}angular.module("editor.ui").factory("MaxTimeValidatorWidgetFactory",MaxTimeValidatorWidgetFactory),MaxTimeValidatorWidgetFactory.$inject=["otusjs.utils.ImmutableDate"]}(),function(){"use strict";function otusMinDateValidator(MinDateValidatorWidgetFactory){return{scope:{},restrict:"E",templateUrl:"app/editor/ui/validation/require/min-date/min-date-validator.html",link:function(scope,element){scope.widget=MinDateValidatorWidgetFactory.create(scope,element)}}}angular.module("editor.ui").directive("otusMinDateValidator",otusMinDateValidator),otusMinDateValidator.$inject=["MinDateValidatorWidgetFactory"]}(),function(){"use strict";function MinDateValidatorWidgetFactory(ImmutableDate){function create(scope,element){return new MinDateValidator(scope,element,ImmutableDate)}var self=this;return self.create=create,self}function MinDateValidator(scope,element,ImmutableDate){function updateData(){getRuleType().data.reference=self.data.toJSON(),scope.$parent.widget.updateFillingRules()}function getRuleType(){return question.fillingRules.options[whoAmI]}function deleteValidator(){scope.$parent.widget.deleteValidator(whoAmI),element.remove(),scope.$destroy()}var self=this,whoAmI="minDate";self.data="",self.updateData=updateData,self.deleteValidator=deleteValidator;var question=scope.$parent.widget.getItem();!function(){var avaiableRules=question.fillingRules.options;self.data=new ImmutableDate(avaiableRules[whoAmI].data.reference.value),self.canBeIgnored=question.fillingRules.options[whoAmI].data.canBeIgnored,self.updateData()}()}angular.module("editor.ui").factory("MinDateValidatorWidgetFactory",MinDateValidatorWidgetFactory),MinDateValidatorWidgetFactory.$inject=["otusjs.utils.ImmutableDate"]}(),function(){"use strict";function otusMinLengthValidator(MinLengthValidatorWidgetFactory){return{scope:{},restrict:"E",templateUrl:"app/editor/ui/validation/require/min-length/min-length-validator.html",link:function(scope,element){scope.widget=MinLengthValidatorWidgetFactory.create(scope,element)}}}angular.module("editor.ui").directive("otusMinLengthValidator",otusMinLengthValidator),otusMinLengthValidator.$inject=["MinLengthValidatorWidgetFactory"]}(),function(){"use strict";function MinLengthValidatorWidgetFactory(){function create(scope,element){return new MinLengthValidator(scope,element)}var self=this;return self.create=create,self}function MinLengthValidator(scope,element){function updateData(){getRuleType().data.reference=self.data,scope.$parent.widget.updateFillingRules()}function getRuleType(){return question.fillingRules.options[whoAmI]}function deleteValidator(){scope.$parent.widget.deleteValidator(whoAmI),element.remove(),scope.$destroy()}var self=this,whoAmI="minLength";self.data=null,self.updateData=updateData,self.deleteValidator=deleteValidator;var question=scope.$parent.widget.getItem();!function(){self.data=question.fillingRules.options[whoAmI].data.reference,self.canBeIgnored=question.fillingRules.options[whoAmI].data.canBeIgnored}()}angular.module("editor.ui").factory("MinLengthValidatorWidgetFactory",MinLengthValidatorWidgetFactory)}(),function(){"use strict";function Directive(MinSelectedValidatorWidgetFactory){return{scope:{},restrict:"E",templateUrl:"app/editor/ui/validation/require/min-selected/min-selected-validator.html",link:function(scope,element){scope.widget=MinSelectedValidatorWidgetFactory.create(scope,element)}}}angular.module("editor.ui").directive("otusMinSelectedValidator",Directive),Directive.$inject=["otusjs.studio.editor.ui.validation.MinSelectedValidatorWidgetFactory"]}(),function(){"use strict";function Factory(){function create(scope,element){return new MinSelectedValidator(scope,element)}var self=this;return self.create=create,self}function MinSelectedValidator(scope,element){function updateData(){getRuleType().data.reference=self.data,scope.$parent.widget.updateFillingRules()}function getRuleType(){return question.fillingRules.options[whoAmI]}function deleteValidator(){scope.$parent.widget.deleteValidator(whoAmI),element.remove(),scope.$destroy()}var self=this,whoAmI="minSelected";self.data=null,self.updateData=updateData,self.deleteValidator=deleteValidator;var question=scope.$parent.widget.getItem();!function(){self.data=question.fillingRules.options[whoAmI].data.reference,self.canBeIgnored=question.fillingRules.options[whoAmI].data.canBeIgnored}()}angular.module("editor.ui").factory("otusjs.studio.editor.ui.validation.MinSelectedValidatorWidgetFactory",Factory)}(),function(){"use strict";function otusMinTimeValidator(MinTimeValidatorWidgetFactory){return{scope:{},restrict:"E",templateUrl:"app/editor/ui/validation/require/min-time/min-time-validator.html",link:function(scope,element){scope.widget=MinTimeValidatorWidgetFactory.create(scope,element)}}}angular.module("editor.ui").directive("otusMinTimeValidator",otusMinTimeValidator),otusMinTimeValidator.$inject=["MinTimeValidatorWidgetFactory"]}(),function(){"use strict";function MinTimeValidatorWidgetFactory(ImmutableDate){function create(scope,element){return new MinTimeValidator(scope,element,ImmutableDate)}var self=this;return self.create=create,self}function MinTimeValidator(scope,element,ImmutableDate){function updateData(){self.data&&(getRuleType().data.reference=self.data.toJSON(),scope.$parent.widget.updateFillingRules())}function getRuleType(){return question.fillingRules.options[whoAmI]}function deleteValidator(){scope.$parent.widget.deleteValidator(whoAmI),element.remove(),scope.$destroy()}var self=this,whoAmI="minTime";self.data="",self.updateData=updateData,self.deleteValidator=deleteValidator;var question=scope.$parent.widget.getItem();!function(){var referenceValue=question.fillingRules.options[whoAmI].data.reference.value;self.canBeIgnored=question.fillingRules.options[whoAmI].data.canBeIgnored,""!==referenceValue?self.data=new ImmutableDate(referenceValue):(self.data=new ImmutableDate,self.data.resetTime(),self.data.setHours(1)),self.data.resetDate(),self.updateData()}()}angular.module("editor.ui").factory("MinTimeValidatorWidgetFactory",MinTimeValidatorWidgetFactory),MinTimeValidatorWidgetFactory.$inject=["otusjs.utils.ImmutableDate"]}(),function(){"use strict";function otusParameterValidator(ParameterValidatorWidgetFactory){return{scope:{},restrict:"E",templateUrl:"app/editor/ui/validation/require/parameter/parameter-validator.html",link:function(scope,element){scope.widget=ParameterValidatorWidgetFactory.create(scope,element)}}}angular.module("editor.ui").directive("otusParameterValidator",otusParameterValidator),otusParameterValidator.$inject=["ParameterValidatorWidgetFactory"]}(),function(){"use strict";function ParameterValidatorWidgetFactory(){function create(scope,element){return new ParameterValidator(scope,element)}var self=this;return self.create=create,self}function ParameterValidator(scope,element){function updateData(){getRuleType().data.reference=self.data,scope.$parent.widget.updateFillingRules()}function getRuleType(){return question.fillingRules.options[whoAmI]}function deleteValidator(){scope.$parent.widget.deleteValidator(whoAmI),element.remove(),scope.$destroy()}var self=this,whoAmI="parameter";self.data="",self.updateData=updateData,self.deleteValidator=deleteValidator;var question=scope.$parent.widget.getItem();!function(){var avaiableRules=question.fillingRules.options;avaiableRules.hasOwnProperty(whoAmI)&&(self.data=avaiableRules[whoAmI].data.reference,self.canBeIgnored=avaiableRules[whoAmI].data.canBeIgnored)}()}angular.module("editor.ui").factory("ParameterValidatorWidgetFactory",ParameterValidatorWidgetFactory)}(),function(){"use strict";function otusPastDateValidator(PastDateValidatorWidgetFactory){return{scope:{},restrict:"E",templateUrl:"app/editor/ui/validation/require/past-date/past-date-validator.html",link:function(scope,element){scope.widget=PastDateValidatorWidgetFactory.create(scope,element)}}}angular.module("editor.ui").directive("otusPastDateValidator",otusPastDateValidator),otusPastDateValidator.$inject=["PastDateValidatorWidgetFactory"]}(),function(){"use strict";function PastDateValidatorWidgetFactory(){function create(scope,element){return new PastDateValidator(scope,element)}var self=this;return self.create=create,self}function PastDateValidator(scope,element){function updateData(){getRuleType().data.reference=self.data,scope.$parent.widget.updateFillingRules()}function getRuleType(){return question.fillingRules.options[whoAmI]}function deleteValidator(){scope.$parent.widget.deleteValidator(whoAmI),element.remove(),scope.$destroy()}var self=this,whoAmI="pastDate";self.updateData=updateData,self.deleteValidator=deleteValidator;var question=scope.$parent.widget.getItem();!function(){question.fillingRules.options,self.data=question.fillingRules.options[whoAmI].data.reference,self.canBeIgnored=question.fillingRules.options[whoAmI].data.canBeIgnored,self.updateData()}()}angular.module("editor.ui").factory("PastDateValidatorWidgetFactory",PastDateValidatorWidgetFactory)}(),function(){"use strict";function otusPrecisionValidator(PrecisionValidatorWidgetFactory){return{scope:{},restrict:"E",templateUrl:"app/editor/ui/validation/require/precision/precision-validator.html",link:function(scope,element){scope.widget=PrecisionValidatorWidgetFactory.create(scope,element)}}}angular.module("editor.ui").directive("otusPrecisionValidator",otusPrecisionValidator),otusPrecisionValidator.$inject=["PrecisionValidatorWidgetFactory"]}(),function(){"use strict";function PrecisionValidatorWidgetFactory(){function create(scope,element){return new PrecisionValidator(scope,element)}var self=this;return self.create=create,self}function PrecisionValidator(scope,element){function updateData(){getRuleType().data.reference=self.data,scope.$parent.widget.updateFillingRules()}function getRuleType(){return question.fillingRules.options[whoAmI]}function deleteValidator(){scope.$parent.widget.deleteValidator(whoAmI),element.remove(),scope.$destroy()}var self=this,whoAmI="precision";self.data=null,self.updateData=updateData,self.deleteValidator=deleteValidator;var question=scope.$parent.widget.getItem();!function(){self.data=question.fillingRules.options[whoAmI].data.reference,self.canBeIgnored=question.fillingRules.options[whoAmI].data.canBeIgnored}()}angular.module("editor.ui").factory("PrecisionValidatorWidgetFactory",PrecisionValidatorWidgetFactory)}(),function(){"use strict";function Directive(QuantityValidatorWidgetFactory){return{scope:{},restrict:"E",templateUrl:"app/editor/ui/validation/require/quantity/quantity-validator.html",link:function(scope,element){scope.widget=QuantityValidatorWidgetFactory.create(scope,element)}}}angular.module("editor.ui").directive("otusQuantityValidator",Directive),Directive.$inject=["otusjs.studio.editor.ui.validation.QuantityValidatorWidgetFactory"]}(),function(){"use strict";function Factory(){function create(scope,element){return new QuantityValidator(scope,element)}var self=this;return self.create=create,self}function QuantityValidator(scope,element){function updateData(){getRuleType().data.reference=self.data,scope.$parent.widget.updateFillingRules()}function getRuleType(){return question.fillingRules.options[whoAmI]}function deleteValidator(){scope.$parent.widget.deleteValidator(whoAmI),element.remove(),scope.$destroy()}var self=this,whoAmI="quantity";self.data=null,self.updateData=updateData,self.deleteValidator=deleteValidator;var question=scope.$parent.widget.getItem();!function(){self.data=question.fillingRules.options[whoAmI].data.reference,self.canBeIgnored=question.fillingRules.options[whoAmI].data.canBeIgnored}()}angular.module("editor.ui").factory("otusjs.studio.editor.ui.validation.QuantityValidatorWidgetFactory",Factory)}(),function(){"use strict";function otusRangeDateValidator(RangeDateValidatorWidgetFactory){return{scope:{},restrict:"E",templateUrl:"app/editor/ui/validation/require/range-date/range-date-validator.html",link:function(scope,element){scope.widget=RangeDateValidatorWidgetFactory.create(scope,element)}}}angular.module("editor.ui").directive("otusRangeDateValidator",otusRangeDateValidator),otusRangeDateValidator.$inject=["RangeDateValidatorWidgetFactory"]}(),function(){"use strict";function RangeDateValidatorWidgetFactory(ImmutableDate){function create(scope,element){return new RangeDateValidator(scope,element,ImmutableDate)}var self=this;return self.create=create,self}function RangeDateValidator(scope,element,ImmutableDate){function updateData(){getRuleType().data.reference.initial=self.data.initial.toJSON(),getRuleType().data.reference.end=self.data.end.toJSON(),scope.$parent.widget.updateFillingRules()}function getRuleType(){return question.fillingRules.options[whoAmI]}function deleteValidator(){scope.$parent.widget.deleteValidator(whoAmI),element.remove(),scope.$destroy()}var self=this,whoAmI="rangeDate";self.data={initial:"",end:""},
self.updateData=updateData,self.deleteValidator=deleteValidator;var question=scope.$parent.widget.getItem();!function(){var avaiableRules=question.fillingRules.options,reference=avaiableRules[whoAmI].data.reference;self.data.initial=new ImmutableDate(reference.initial.value),self.data.end=new ImmutableDate(reference.end.value),self.canBeIgnored=question.fillingRules.options[whoAmI].data.canBeIgnored,self.updateData()}()}angular.module("editor.ui").factory("RangeDateValidatorWidgetFactory",RangeDateValidatorWidgetFactory),RangeDateValidatorWidgetFactory.$inject=["otusjs.utils.ImmutableDate"]}(),function(){"use strict";function otusScaleValidator(ScaleValidatorWidgetFactory){return{scope:{},restrict:"E",templateUrl:"app/editor/ui/validation/require/scale/scale-validator.html",link:function(scope,element){scope.widget=ScaleValidatorWidgetFactory.create(scope,element)}}}angular.module("editor.ui").directive("otusScaleValidator",otusScaleValidator),otusScaleValidator.$inject=["ScaleValidatorWidgetFactory"]}(),function(){"use strict";function ScaleValidatorWidgetFactory(){function create(scope,element){return new ScaleValidator(scope,element)}var self=this;return self.create=create,self}function ScaleValidator(scope,element){function updateData(){getRuleType().data.reference=self.data,scope.$parent.widget.updateFillingRules()}function getRuleType(){return question.fillingRules.options[whoAmI]}function deleteValidator(){scope.$parent.widget.deleteValidator(whoAmI),element.remove(),scope.$destroy()}var self=this,whoAmI="scale";self.data=null,self.updateData=updateData,self.deleteValidator=deleteValidator;var question=scope.$parent.widget.getItem();!function(){var avaiableRules=question.fillingRules.options;self.data=avaiableRules[whoAmI].data.reference,self.canBeIgnored=avaiableRules[whoAmI].data.canBeIgnored}()}angular.module("editor.ui").factory("ScaleValidatorWidgetFactory",ScaleValidatorWidgetFactory)}(),function(){"use strict";function otusSpecialsValidator(SpecialsValidatorWidgetFactory){return{scope:{},restrict:"E",templateUrl:"app/editor/ui/validation/require/specials/specials-validator.html",link:function(scope,element){scope.widget=SpecialsValidatorWidgetFactory.create(scope,element)}}}angular.module("editor.ui").directive("otusSpecialsValidator",otusSpecialsValidator),otusSpecialsValidator.$inject=["SpecialsValidatorWidgetFactory"]}(),function(){"use strict";function SpecialsValidatorWidgetFactory(){function create(scope,element){return new SpecialsValidator(scope,element)}var self=this;return self.create=create,self}function SpecialsValidator(scope,element){function updateData(){getRuleType().data.reference=self.data,scope.$parent.widget.updateFillingRules()}function getRuleType(){return question.fillingRules.options[whoAmI]}function deleteValidator(){scope.$parent.widget.deleteValidator(whoAmI),element.remove(),scope.$destroy()}var self=this,whoAmI="specials";self.data=!0,self.updateData=updateData,self.deleteValidator=deleteValidator;var question=scope.$parent.widget.getItem();!function(){var avaiableRules=question.fillingRules.options;self.data=avaiableRules[whoAmI].data.reference,self.canBeIgnored=avaiableRules[whoAmI].data.canBeIgnored}()}angular.module("editor.ui").factory("SpecialsValidatorWidgetFactory",SpecialsValidatorWidgetFactory)}(),function(){"use strict";function otusUpperCaseValidator(UpperCaseValidatorWidgetFactory){return{scope:{},restrict:"E",templateUrl:"app/editor/ui/validation/require/upper-case/upper-case-validator.html",link:function(scope,element){scope.widget=UpperCaseValidatorWidgetFactory.create(scope,element)}}}angular.module("editor.ui").directive("otusUpperCaseValidator",otusUpperCaseValidator),otusUpperCaseValidator.$inject=["UpperCaseValidatorWidgetFactory"]}(),function(){"use strict";function UpperCaseValidatorWidgetFactory(){function create(scope,element){return new UpperCaseValidator(scope,element)}var self=this;return self.create=create,self}function UpperCaseValidator(scope,element){function updateData(){getRuleType().data.reference=self.data,scope.$parent.widget.updateFillingRules()}function getRuleType(){return question.fillingRules.options[whoAmI]}function deleteValidator(){scope.$parent.widget.deleteValidator(whoAmI),element.remove(),scope.$destroy()}var self=this,whoAmI="upperCase";self.data=!0,self.updateData=updateData,self.deleteValidator=deleteValidator;var question=scope.$parent.widget.getItem();!function(){var avaiableRules=question.fillingRules.options;self.data=avaiableRules[whoAmI].data.reference,self.canBeIgnored=avaiableRules[whoAmI].data.canBeIgnored}()}angular.module("editor.ui").factory("UpperCaseValidatorWidgetFactory",UpperCaseValidatorWidgetFactory)}(),function(){"use strict";function otusUpperLimitValidator(UpperLimitValidatorWidgetFactory){return{scope:{},restrict:"E",templateUrl:"app/editor/ui/validation/require/upper-limit/upper-limit-validator.html",link:function(scope,element){scope.widget=UpperLimitValidatorWidgetFactory.create(scope,element)}}}angular.module("editor.ui").directive("otusUpperLimitValidator",otusUpperLimitValidator),otusUpperLimitValidator.$inject=["UpperLimitValidatorWidgetFactory"]}();!function(){"use strict";function UpperLimitValidatorWidgetFactory(){function create(scope,element){return new UpperLimitValidator(scope,element)}var self=this;return self.create=create,self}function UpperLimitValidator(scope,element){function updateData(){getRuleType().data.reference=self.data,scope.$parent.widget.updateFillingRules()}function getRuleType(){return question.fillingRules.options[whoAmI]}function deleteValidator(){scope.$parent.widget.deleteValidator(whoAmI),element.remove(),scope.$destroy()}var self=this,whoAmI="upperLimit";self.data=null,self.updateData=updateData,self.deleteValidator=deleteValidator;var question=scope.$parent.widget.getItem();!function(){var avaiableRules=question.fillingRules.options;self.data=avaiableRules[whoAmI].data.reference,self.canBeIgnored=avaiableRules[whoAmI].data.canBeIgnored}()}angular.module("editor.ui").factory("UpperLimitValidatorWidgetFactory",UpperLimitValidatorWidgetFactory)}(),function(){"use strict";function Controller(){this.$onInit=function(){}}angular.module("editor.ui").component("gridInteger",{controller:Controller,templateUrl:"app/editor/ui/survey-item/question/grid-integer-question/grid-integer/grid-integer-template.html",bindings:{gridInteger:"<"}}),Controller.$inject=[]}(),function(){"use strict";function Controller(WorkspaceService,AlphabetSuffixIDGenerator){function onInit(){_questionID=self.parentCtrl.item.customID}function addGridInteger(){self.gridLine.addGridInteger(_generateGridIntegerID()),self.parentCtrl.save()}function removeLastGridInteger(){self.gridLine.removeLastGridInteger(),self.parentCtrl.save()}function removeGridLine(index){self.parentCtrl.removeGridLine(index)}function isEmpty(){return!(self.gridLine.getGridIntegerListSize()>0)}function _generateGridIntegerID(){var gridID,quantity=self.gridLine.getGridIntegerListSize();do{gridID=_questionID+AlphabetSuffixIDGenerator.generateSuffixByOptionsLength(quantity++)}while(!WorkspaceService.getSurvey().isAvailableCustomID(gridID));return gridID}var _questionID,self=this;self.$onInit=onInit,self.addGridInteger=addGridInteger,self.removeLastGridInteger=removeLastGridInteger,self.removeGridLine=removeGridLine,self.isEmpty=isEmpty}angular.module("editor.ui").component("gridIntegerLine",{controller:Controller,templateUrl:"app/editor/ui/survey-item/question/grid-integer-question/grid-integer-line/grid-integer-line-template.html",bindings:{gridLine:"<"},require:{parentCtrl:"^gridIntegerQuestion"}}),Controller.$inject=["WorkspaceService","otusjs.model.utils.AlphabetSuffixIDGenerator"]}(),function(){"use strict";function Controller(WorkspaceService,AlphabetSuffixIDGenerator){function onInit(){_questionID=self.parentCtrl.item.customID}function addGridText(){self.gridLine.addGridText(_generateGridTextID()),self.parentCtrl.save()}function removeLastGridText(){self.gridLine.removeLastGridText(),self.parentCtrl.save()}function removeGridLine(index){self.parentCtrl.removeGridLine(index)}function isEmpty(){return!(self.gridLine.getGridTextListSize()>0)}function _generateGridTextID(){var gridID,quantity=self.gridLine.getGridTextListSize();do{gridID=_questionID+AlphabetSuffixIDGenerator.generateSuffixByOptionsLength(quantity++)}while(!WorkspaceService.getSurvey().isAvailableCustomID(gridID));return gridID}var _questionID,self=this;self.$onInit=onInit,self.addGridText=addGridText,self.removeLastGridText=removeLastGridText,self.removeGridLine=removeGridLine,self.isEmpty=isEmpty}angular.module("editor.ui").component("gridLine",{controller:Controller,templateUrl:"app/editor/ui/survey-item/question/grid-text-question/grid-line/grid-line-template.html",bindings:{gridLine:"<"},require:{parentCtrl:"^gridTextQuestion"}}),Controller.$inject=["WorkspaceService","otusjs.model.utils.AlphabetSuffixIDGenerator"]}(),function(){"use strict";function Controller(){this.$onInit=function(){}}angular.module("editor.ui").component("gridText",{controller:Controller,templateUrl:"app/editor/ui/survey-item/question/grid-text-question/grid-text/grid-text-component.html",bindings:{gridText:"<"}}),Controller.$inject=[]}();